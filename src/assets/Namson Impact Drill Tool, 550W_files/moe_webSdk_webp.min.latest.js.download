/*! For license information please see sdk.webp.js.LICENSE.txt */
(()=>{var e={33:(e,t,r)=>{var n,i,a=r(814),o=r(471),s=0,c=0;e.exports=function(e,t,r){var l=t&&r||0,u=t||[],d=(e=e||{}).node||n,E=(r=void 0!==e.clockseq?e.clockseq:i,null!=d&&null!=r||(E=a(),null==d&&(d=n=[1|E[0],E[1],E[2],E[3],E[4],E[5]]),null==r&&(r=i=16383&(E[6]<<8|E[7]))),void 0!==e.msecs?e.msecs:(new Date).getTime()),g=void 0!==e.nsecs?e.nsecs:c+1,h=E-s+(g-c)/1e4;if(h<0&&void 0===e.clockseq&&(r=r+1&16383),1e4<=(g=(h<0||s<E)&&void 0===e.nsecs?0:g))throw new Error("uuid.v1(): Can't create more than 10M uuids/sec");s=E,i=r,h=(1e4*(268435455&(E+=122192928e5))+(c=g))%4294967296,u[l++]=h>>>24&255,u[l++]=h>>>16&255,u[l++]=h>>>8&255,u[l++]=255&h,u[l++]=(e=E/4294967296*1e4&268435455)>>>8&255,u[l++]=255&e,u[l++]=e>>>24&15|16,u[l++]=e>>>16&255,u[l++]=r>>>8|128,u[l++]=255&r;for(var p=0;p<6;++p)u[l+p]=d[p];return t||o(u)}},372:(e,t,r)=>{e.exports=function(e,t,r){if("number"!=typeof t)throw new Error("second argument must be a Number");let i,a,o,s,c,l,u=!0;function d(e){function t(){r&&r(e,i),r=null}u?n(t):t()}function E(t,r,n){if(i[t]=n,r&&(c=!0),0==--o||r)d(r);else if(!c&&l<a){let t;s?(t=s[l],l+=1,e[t](function(e,r){E(t,e,r)})):(t=l,l+=1,e[t](function(e,r){E(t,e,r)}))}}o=a=(Array.isArray(e)?(i=[],e):(s=Object.keys(e),i={},s)).length,l=t,o?s?s.some(function(r,n){return e[r](function(e,t){E(r,e,t)}),n===t-1}):e.some(function(e,r){return e(function(e,t){E(r,e,t)}),r===t-1}):d(null),u=!1};let n=r(596)},414:(e,t,r)=>{var n=r(33),i=r=r(550);i.v1=n,i.v4=r,e.exports=i},471:e=>{for(var t=[],r=0;r<256;++r)t[r]=(r+256).toString(16).substr(1);e.exports=function(e,r){r=r||0;var n=t;return[n[e[r++]],n[e[r++]],n[e[r++]],n[e[r++]],"-",n[e[r++]],n[e[r++]],"-",n[e[r++]],n[e[r++]],"-",n[e[r++]],n[e[r++]],"-",n[e[r++]],n[e[r++]],n[e[r++]],n[e[r++]],n[e[r++]],n[e[+r]]].join("")}},550:(e,t,r)=>{var n=r(814),i=r(471);e.exports=function(e,t,r){var a=t&&r||0,o=("string"==typeof e&&(t="binary"===e?new Array(16):null,e=null),(e=e||{}).random||(e.rng||n)());if(o[6]=15&o[6]|64,o[8]=63&o[8]|128,t)for(var s=0;s<16;++s)t[a+s]=o[s];return t||i(o)}},596:(e,t,r)=>{let n;e.exports="function"==typeof queueMicrotask?queueMicrotask.bind("undefined"!=typeof window?window:r.g):e=>(n=n||Promise.resolve()).then(e).catch(e=>setTimeout(()=>{throw e},0))},790:(e,t,r)=>{e.exports=function e(t,r,n){function i(o,s){if(!r[o]){if(!t[o]){if(a)return a(o,!0);var c=new Error("Cannot find module '"+o+"'");throw c.code="MODULE_NOT_FOUND",c}c=r[o]={exports:{}},t[o][0].call(c.exports,function(e){return i(t[o][1][e]||e)},c,c.exports,e,t,r,n)}return r[o].exports}for(var a=void 0,o=0;o<n.length;o++)i(n[o]);return i}({1:[function(e,t,n){(function(e){var r,n,i,a,o=e.MutationObserver||e.WebKitMutationObserver,s=o?(r=0,o=new o(l),n=e.document.createTextNode(""),o.observe(n,{characterData:!0}),function(){n.data=r=++r%2}):e.setImmediate||void 0===e.MessageChannel?"document"in e&&"onreadystatechange"in e.document.createElement("script")?function(){var t=e.document.createElement("script");t.onreadystatechange=function(){l(),t.onreadystatechange=null,t.parentNode.removeChild(t),t=null},e.document.documentElement.appendChild(t)}:function(){setTimeout(l,0)}:((i=new e.MessageChannel).port1.onmessage=l,function(){i.port2.postMessage(0)}),c=[];function l(){a=!0;for(var e,t,r=c.length;r;){for(t=c,c=[],e=-1;++e<r;)t[e]();r=c.length}a=!1}t.exports=function(e){1!==c.push(e)||a||s()}}).call(this,void 0!==r.g?r.g:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],2:[function(e,t,r){var n=e(1);function i(){}var a={},o=["REJECTED"],s=["FULFILLED"],c=["PENDING"];function l(e){if("function"!=typeof e)throw new TypeError("resolver must be a function");this.state=c,this.queue=[],this.outcome=void 0,e!==i&&g(this,e)}function u(e,t,r){this.promise=e,"function"==typeof t&&(this.onFulfilled=t,this.callFulfilled=this.otherCallFulfilled),"function"==typeof r&&(this.onRejected=r,this.callRejected=this.otherCallRejected)}function d(e,t,r){n(function(){var n;try{n=t(r)}catch(n){return a.reject(e,n)}n===e?a.reject(e,new TypeError("Cannot resolve promise with itself")):a.resolve(e,n)})}function E(e){var t=e&&e.then;if(e&&("object"==typeof e||"function"==typeof e)&&"function"==typeof t)return function(){t.apply(e,arguments)}}function g(e,t){var r=!1;function n(t){r||(r=!0,a.reject(e,t))}function i(t){r||(r=!0,a.resolve(e,t))}var o=h(function(){t(i,n)});"error"===o.status&&n(o.value)}function h(e,t){var r={};try{r.value=e(t),r.status="success"}catch(e){r.status="error",r.value=e}return r}(t.exports=l).prototype.catch=function(e){return this.then(null,e)},l.prototype.then=function(e,t){var r;return"function"!=typeof e&&this.state===s||"function"!=typeof t&&this.state===o?this:(r=new this.constructor(i),this.state!==c?d(r,this.state===s?e:t,this.outcome):this.queue.push(new u(r,e,t)),r)},u.prototype.callFulfilled=function(e){a.resolve(this.promise,e)},u.prototype.otherCallFulfilled=function(e){d(this.promise,this.onFulfilled,e)},u.prototype.callRejected=function(e){a.reject(this.promise,e)},u.prototype.otherCallRejected=function(e){d(this.promise,this.onRejected,e)},a.resolve=function(e,t){var r=h(E,t);if("error"===r.status)return a.reject(e,r.value);if(r=r.value)g(e,r);else{e.state=s,e.outcome=t;for(var n=-1,i=e.queue.length;++n<i;)e.queue[n].callFulfilled(t)}return e},a.reject=function(e,t){e.state=o,e.outcome=t;for(var r=-1,n=e.queue.length;++r<n;)e.queue[r].callRejected(t);return e},l.resolve=function(e){return e instanceof this?e:a.resolve(new this(i),e)},l.reject=function(e){var t=new this(i);return a.reject(t,e)},l.all=function(e){var t=this;if("[object Array]"!==Object.prototype.toString.call(e))return this.reject(new TypeError("must be an array"));var r=e.length,n=!1;if(!r)return this.resolve([]);for(var o=new Array(r),s=0,c=-1,l=new this(i);++c<r;)((e,i)=>{t.resolve(e).then(function(e){o[i]=e,++s!==r||n||(n=!0,a.resolve(l,o))},function(e){n||(n=!0,a.reject(l,e))})})(e[c],c);return l},l.race=function(e){var t=this;if("[object Array]"!==Object.prototype.toString.call(e))return this.reject(new TypeError("must be an array"));var r=e.length,n=!1;if(!r)return this.resolve([]);for(var o=-1,s=new this(i);++o<r;)(e=>{t.resolve(e).then(function(e){n||(n=!0,a.resolve(s,e))},function(e){n||(n=!0,a.reject(s,e))})})(e[o]);return s}},{1:1}],3:[function(e,t,n){(function(t){"function"!=typeof t.Promise&&(t.Promise=e(2))}).call(this,void 0!==r.g?r.g:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{2:2}],4:[function(e,t,r){var n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},i=(()=>{try{return"undefined"!=typeof indexedDB?indexedDB:"undefined"!=typeof webkitIndexedDB?webkitIndexedDB:"undefined"!=typeof mozIndexedDB?mozIndexedDB:"undefined"!=typeof OIndexedDB?OIndexedDB:"undefined"!=typeof msIndexedDB?msIndexedDB:void 0}catch(e){}})();function a(e,t){e=e||[],t=t||{};try{return new Blob(e,t)}catch(i){if("TypeError"!==i.name)throw i;for(var r=new("undefined"!=typeof BlobBuilder?BlobBuilder:"undefined"!=typeof MSBlobBuilder?MSBlobBuilder:"undefined"!=typeof MozBlobBuilder?MozBlobBuilder:WebKitBlobBuilder),n=0;n<e.length;n+=1)r.append(e[n]);return r.getBlob(t.type)}}"undefined"==typeof Promise&&e(3);var o=Promise;function s(e,t){t&&e.then(function(e){t(null,e)},function(e){t(e)})}function c(e,t,r){"function"==typeof t&&e.then(t),"function"==typeof r&&e.catch(r)}function l(e){return"string"!=typeof e&&(console.warn(e+" used as a key, but it is not a string."),e=String(e)),e}function u(){if(arguments.length&&"function"==typeof arguments[arguments.length-1])return arguments[arguments.length-1]}var d="local-forage-detect-blob-support",E=void 0,g={},h=Object.prototype.toString,p="readonly",v="readwrite";function f(e){return"boolean"==typeof E?o.resolve(E):(t=e,new o(function(e){var r=t.transaction(d,v),n=a([""]);r.objectStore(d).put(n,"key"),r.onabort=function(t){t.preventDefault(),t.stopPropagation(),e(!1)},r.oncomplete=function(){var t=navigator.userAgent.match(/Chrome\/(\d+)/),r=navigator.userAgent.match(/Edge\//);e(r||!t||43<=parseInt(t[1],10))}}).catch(function(){return!1}).then(function(e){return E=e}));var t}function _(e){e=g[e.name];var t={};t.promise=new o(function(e,r){t.resolve=e,t.reject=r}),e.deferredOperations.push(t),e.dbReady?e.dbReady=e.dbReady.then(function(){return t.promise}):e.dbReady=t.promise}function m(e){(e=g[e.name].deferredOperations.pop())&&(e.resolve(),e.promise)}function S(e,t){if(e=g[e.name].deferredOperations.pop())return e.reject(t),e.promise}function T(e,t){return new o(function(r,n){if(g[e.name]=g[e.name]||{forages:[],db:null,dbReady:null,deferredOperations:[]},e.db){if(!t)return r(e.db);_(e),e.db.close()}var a=[e.name],o=(t&&a.push(e.version),i.open.apply(i,a));t&&(o.onupgradeneeded=function(t){var r=o.result;try{r.createObjectStore(e.storeName),t.oldVersion<=1&&r.createObjectStore(d)}catch(r){if("ConstraintError"!==r.name)throw r;console.warn('The database "'+e.name+'" has been upgraded from version '+t.oldVersion+" to version "+t.newVersion+', but the storage "'+e.storeName+'" already exists.')}}),o.onerror=function(e){e.preventDefault(),n(o.error)},o.onsuccess=function(){var t=o.result;t.onversionchange=function(e){e.target.close()},r(t),m(e)}})}function I(e){return T(e,!1)}function A(e){return T(e,!0)}function b(e,t){var r,n,i;return!e.db||(r=!e.db.objectStoreNames.contains(e.storeName),i=e.version<e.db.version,n=e.version>e.db.version,i&&(e.version!==t&&console.warn('The database "'+e.name+"\" can't be downgraded from version "+e.db.version+" to version "+e.version+"."),e.version=e.db.version),(n||r)&&(r&&(i=e.db.version+1,e.version<i)&&(e.version=i),1))}function y(e){return a([(e=>{for(var t=e.length,r=new ArrayBuffer(t),n=new Uint8Array(r),i=0;i<t;i++)n[i]=e.charCodeAt(i);return r})(atob(e.data))],{type:e.type})}function O(e){return e&&e.__local_forage_encoded_blob}function D(e){var t=this,r=t._initReady().then(function(){var e=g[t._dbInfo.name];if(e&&e.dbReady)return e.dbReady});return c(r,e,e),r}function N(e,t,r,n){void 0===n&&(n=1);try{var i=e.db.transaction(e.storeName,t);r(null,i)}catch(i){if(0<n&&(!e.db||"InvalidStateError"===i.name||"NotFoundError"===i.name))return o.resolve().then(function(){if(!e.db||"NotFoundError"===i.name&&!e.db.objectStoreNames.contains(e.storeName)&&e.version<=e.db.version)return e.db&&(e.version=e.db.version+1),A(e)}).then(function(){return(e=>{_(e);for(var t=g[e.name],r=t.forages,n=0;n<r.length;n++){var i=r[n];i._dbInfo.db&&(i._dbInfo.db.close(),i._dbInfo.db=null)}return e.db=null,I(e).then(function(t){return e.db=t,b(e)?A(e):t}).then(function(n){e.db=t.db=n;for(var i=0;i<r.length;i++)r[i]._dbInfo.db=n}).catch(function(t){throw S(e,t),t})})(e).then(function(){N(e,t,r,n-1)})}).catch(r);r(i)}}e={_driver:"asyncStorage",_initStorage:function(e){var t=this,r={db:null};if(e)for(var n in e)r[n]=e[n];var i=g[r.name],a=(i||(i={forages:[],db:null,dbReady:null,deferredOperations:[]},g[r.name]=i),i.forages.push(t),t._initReady||(t._initReady=t.ready,t.ready=D),[]);function s(){return o.resolve()}for(var c=0;c<i.forages.length;c++){var l=i.forages[c];l!==t&&a.push(l._initReady().catch(s))}var u=i.forages.slice(0);return o.all(a).then(function(){return r.db=i.db,I(r)}).then(function(e){return r.db=e,b(r,t._defaultConfig.version)?A(r):e}).then(function(e){r.db=i.db=e,t._dbInfo=r;for(var n=0;n<u.length;n++){var a=u[n];a!==t&&(a._dbInfo.db=r.db,a._dbInfo.version=r.version)}})},_support:(()=>{try{var e,t;return!(!i||!i.open)&&(e="undefined"!=typeof openDatabase&&/(Safari|iPhone|iPad|iPod)/.test(navigator.userAgent)&&!/Chrome/.test(navigator.userAgent)&&!/BlackBerry/.test(navigator.platform),t="function"==typeof fetch&&-1!==fetch.toString().indexOf("[native code"),(!e||t)&&"undefined"!=typeof indexedDB&&"undefined"!=typeof IDBKeyRange)}catch(e){return!1}})(),iterate:function(e,t){var r=this,n=new o(function(t,n){r.ready().then(function(){N(r._dbInfo,p,function(i,a){if(i)return n(i);try{var o=a.objectStore(r._dbInfo.storeName).openCursor(),s=1;o.onsuccess=function(){var r,n=o.result;n?(O(r=n.value)&&(r=y(r)),void 0!==(r=e(r,n.key,s++))?t(r):n.continue()):t()},o.onerror=function(){n(o.error)}}catch(i){n(i)}})}).catch(n)});return s(n,t),n},getItem:function(e,t){var r=this,n=(e=l(e),new o(function(t,n){r.ready().then(function(){N(r._dbInfo,p,function(i,a){if(i)return n(i);try{var o=a.objectStore(r._dbInfo.storeName).get(e);o.onsuccess=function(){var e=o.result;O(e=void 0===e?null:e)&&(e=y(e)),t(e)},o.onerror=function(){n(o.error)}}catch(i){n(i)}})}).catch(n)}));return s(n,t),n},setItem:function(e,t,r){var n=this,i=(e=l(e),new o(function(r,i){var a;n.ready().then(function(){return a=n._dbInfo,"[object Blob]"===h.call(t)?f(a.db).then(function(e){return e?t:(r=t,new o(function(e,t){var n=new FileReader;n.onerror=t,n.onloadend=function(t){t=btoa(t.target.result||""),e({__local_forage_encoded_blob:!0,data:t,type:r.type})},n.readAsBinaryString(r)}));var r}):t}).then(function(t){N(n._dbInfo,v,function(a,o){if(a)return i(a);try{var s=o.objectStore(n._dbInfo.storeName),c=(null===t&&(t=void 0),s.put(t,e));o.oncomplete=function(){r(t=void 0===t?null:t)},o.onabort=o.onerror=function(){var e=c.error||c.transaction.error;i(e)}}catch(a){i(a)}})}).catch(i)}));return s(i,r),i},removeItem:function(e,t){var r=this,n=(e=l(e),new o(function(t,n){r.ready().then(function(){N(r._dbInfo,v,function(i,a){if(i)return n(i);try{var o=a.objectStore(r._dbInfo.storeName).delete(e);a.oncomplete=function(){t()},a.onerror=function(){n(o.error)},a.onabort=function(){var e=o.error||o.transaction.error;n(e)}}catch(i){n(i)}})}).catch(n)}));return s(n,t),n},clear:function(e){var t=this,r=new o(function(e,r){t.ready().then(function(){N(t._dbInfo,v,function(n,i){if(n)return r(n);try{var a=i.objectStore(t._dbInfo.storeName).clear();i.oncomplete=function(){e()},i.onabort=i.onerror=function(){var e=a.error||a.transaction.error;r(e)}}catch(n){r(n)}})}).catch(r)});return s(r,e),r},length:function(e){var t=this,r=new o(function(e,r){t.ready().then(function(){N(t._dbInfo,p,function(n,i){if(n)return r(n);try{var a=i.objectStore(t._dbInfo.storeName).count();a.onsuccess=function(){e(a.result)},a.onerror=function(){r(a.error)}}catch(n){r(n)}})}).catch(r)});return s(r,e),r},key:function(e,t){var r=this,n=new o(function(t,n){e<0?t(null):r.ready().then(function(){N(r._dbInfo,p,function(i,a){if(i)return n(i);try{var o=a.objectStore(r._dbInfo.storeName),s=!1,c=o.openKeyCursor();c.onsuccess=function(){var r=c.result;r?0===e||s?t(r.key):(s=!0,r.advance(e)):t(null)},c.onerror=function(){n(c.error)}}catch(i){n(i)}})}).catch(n)});return s(n,t),n},keys:function(e){var t=this,r=new o(function(e,r){t.ready().then(function(){N(t._dbInfo,p,function(n,i){if(n)return r(n);try{var a=i.objectStore(t._dbInfo.storeName).openKeyCursor(),o=[];a.onsuccess=function(){var t=a.result;t?(o.push(t.key),t.continue()):e(o)},a.onerror=function(){r(a.error)}}catch(n){r(n)}})}).catch(r)});return s(r,e),r},dropInstance:function(e,t){t=u.apply(this,arguments);var r=this.config();return(e="function"!=typeof e&&e||{}).name||(e.name=e.name||r.name,e.storeName=e.storeName||r.storeName),s(r=e.name?(r=e.name===r.name&&this._dbInfo.db?o.resolve(this._dbInfo.db):I(e).then(function(t){var r=g[e.name],n=r.forages;r.db=t;for(var i=0;i<n.length;i++)n[i]._dbInfo.db=t;return t}),e.storeName?r.then(function(t){if(t.objectStoreNames.contains(e.storeName)){var r=t.version+1,n=(_(e),g[e.name]),a=n.forages;t.close();for(var s=0;s<a.length;s++){var c=a[s];c._dbInfo.db=null,c._dbInfo.version=r}return new o(function(t,n){var a=i.open(e.name,r);a.onerror=function(e){a.result.close(),n(e)},a.onupgradeneeded=function(){a.result.deleteObjectStore(e.storeName)},a.onsuccess=function(){var e=a.result;e.close(),t(e)}}).then(function(e){n.db=e;for(var t=0;t<a.length;t++){var r=a[t];r._dbInfo.db=e,m(r._dbInfo)}}).catch(function(t){throw(S(e,t)||o.resolve()).catch(function(){}),t})}}):r.then(function(t){_(e);var r=g[e.name],n=r.forages;t.close();for(var a=0;a<n.length;a++)n[a]._dbInfo.db=null;return new o(function(t,r){var n=i.deleteDatabase(e.name);n.onerror=function(){var e=n.result;e&&e.close(),r(n.error)},n.onblocked=function(){console.warn('dropInstance blocked for database "'+e.name+'" until all open connections are closed')},n.onsuccess=function(){var e=n.result;e&&e.close(),t(e)}}).then(function(e){r.db=e;for(var t=0;t<n.length;t++)m(n[t]._dbInfo)}).catch(function(t){throw(S(e,t)||o.resolve()).catch(function(){}),t})})):o.reject("Invalid arguments"),t),r}};var R="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",w=/^~~local_forage_type~([^~]+)~/,L="__lfsc__:",C="arbf",P="blob",M=Object.prototype.toString;function k(e){for(var t,r,n,i,a=.75*e.length,o=e.length,s=0,c=("="===e[e.length-1]&&(a--,"="===e[e.length-2])&&a--,a=new ArrayBuffer(a),new Uint8Array(a)),l=0;l<o;l+=4)t=R.indexOf(e[l]),r=R.indexOf(e[l+1]),n=R.indexOf(e[l+2]),i=R.indexOf(e[l+3]),c[s++]=t<<2|r>>4,c[s++]=(15&r)<<4|n>>2,c[s++]=(3&n)<<6|63&i;return a}function U(e){for(var t=new Uint8Array(e),r="",n=0;n<t.length;n+=3)r=(r=(r=(r+=R[t[n]>>2])+R[(3&t[n])<<4|t[n+1]>>4])+R[(15&t[n+1])<<2|t[n+2]>>6])+R[63&t[n+2]];return t.length%3==2?r=r.substring(0,r.length-1)+"=":t.length%3==1&&(r=r.substring(0,r.length-2)+"=="),r}var B={serialize:function(e,t){var r="";if(e&&(r=M.call(e)),e&&("[object ArrayBuffer]"===r||e.buffer&&"[object ArrayBuffer]"===M.call(e.buffer))){var n,i=L;e instanceof ArrayBuffer?(n=e,i+=C):(n=e.buffer,"[object Int8Array]"===r?i+="si08":"[object Uint8Array]"===r?i+="ui08":"[object Uint8ClampedArray]"===r?i+="uic8":"[object Int16Array]"===r?i+="si16":"[object Uint16Array]"===r?i+="ur16":"[object Int32Array]"===r?i+="si32":"[object Uint32Array]"===r?i+="ui32":"[object Float32Array]"===r?i+="fl32":"[object Float64Array]"===r?i+="fl64":t(new Error("Failed to get type for BinaryArray"))),t(i+U(n))}else if("[object Blob]"===r)(i=new FileReader).onload=function(){var r="~~local_forage_type~"+e.type+"~"+U(this.result);t(L+P+r)},i.readAsArrayBuffer(e);else try{t(JSON.stringify(e))}catch(r){console.error("Couldn't convert value into a JSON string: ",e),t(null,r)}},deserialize:function(e){if(e.substring(0,9)!==L)return JSON.parse(e);var t,r=e.substring(13),n=e.substring(9,13),i=(n===P&&w.test(r)&&(t=(e=r.match(w))[1],r=r.substring(e[0].length)),k(r));switch(n){case C:return i;case P:return a([i],{type:t});case"si08":return new Int8Array(i);case"ui08":return new Uint8Array(i);case"uic8":return new Uint8ClampedArray(i);case"si16":return new Int16Array(i);case"ur16":return new Uint16Array(i);case"si32":return new Int32Array(i);case"ui32":return new Uint32Array(i);case"fl32":return new Float32Array(i);case"fl64":return new Float64Array(i);default:throw new Error("Unkown type: "+n)}},stringToBuffer:k,bufferToString:U};function x(e,t,r,n){e.executeSql("CREATE TABLE IF NOT EXISTS "+t.storeName+" (id INTEGER PRIMARY KEY, key unique, value)",[],r,n)}function W(e,t,r,n,i,a){e.executeSql(r,n,i,function(e,o){o.code===o.SYNTAX_ERR?e.executeSql("SELECT name FROM sqlite_master WHERE type='table' AND name = ?",[t.storeName],function(e,s){s.rows.length?a(e,o):x(e,t,function(){e.executeSql(r,n,i,a)},a)},a):a(e,o)},a)}function F(e,t,r,n){var i=this,a=(e=l(e),new o(function(a,o){i.ready().then(function(){var s=t=void 0===t?null:t,c=i._dbInfo;c.serializer.serialize(t,function(t,l){l?o(l):c.db.transaction(function(r){W(r,c,"INSERT OR REPLACE INTO "+c.storeName+" (key, value) VALUES (?, ?)",[e,t],function(){a(s)},function(e,t){o(t)})},function(t){t.code===t.QUOTA_ERR&&(0<n?a(F.apply(i,[e,s,r,n-1])):o(t))})})}).catch(o)}));return s(a,r),a}var V={_driver:"webSQLStorage",_initStorage:function(e){var t=this,r={db:null};if(e)for(var n in e)r[n]="string"!=typeof e[n]?e[n].toString():e[n];var i=new o(function(e,n){try{r.db=openDatabase(r.name,String(r.version),r.description,r.size)}catch(e){return n(e)}r.db.transaction(function(i){x(i,r,function(){t._dbInfo=r,e()},function(e,t){n(t)})},n)});return r.serializer=B,i},_support:"function"==typeof openDatabase,iterate:function(e,t){var r=this,n=new o(function(t,n){r.ready().then(function(){var i=r._dbInfo;i.db.transaction(function(r){W(r,i,"SELECT * FROM "+i.storeName,[],function(r,n){for(var a=n.rows,o=a.length,s=0;s<o;s++){var c=a.item(s),l=(l=c.value)&&i.serializer.deserialize(l);if(void 0!==(l=e(l,c.key,s+1)))return void t(l)}t()},function(e,t){n(t)})})}).catch(n)});return s(n,t),n},getItem:function(e,t){var r=this,n=(e=l(e),new o(function(t,n){r.ready().then(function(){var i=r._dbInfo;i.db.transaction(function(r){W(r,i,"SELECT * FROM "+i.storeName+" WHERE key = ? LIMIT 1",[e],function(e,r){r=(r=r.rows.length?r.rows.item(0).value:null)&&i.serializer.deserialize(r),t(r)},function(e,t){n(t)})})}).catch(n)}));return s(n,t),n},setItem:function(e,t,r){return F.apply(this,[e,t,r,1])},removeItem:function(e,t){var r=this,n=(e=l(e),new o(function(t,n){r.ready().then(function(){var i=r._dbInfo;i.db.transaction(function(r){W(r,i,"DELETE FROM "+i.storeName+" WHERE key = ?",[e],function(){t()},function(e,t){n(t)})})}).catch(n)}));return s(n,t),n},clear:function(e){var t=this,r=new o(function(e,r){t.ready().then(function(){var n=t._dbInfo;n.db.transaction(function(t){W(t,n,"DELETE FROM "+n.storeName,[],function(){e()},function(e,t){r(t)})})}).catch(r)});return s(r,e),r},length:function(e){var t=this,r=new o(function(e,r){t.ready().then(function(){var n=t._dbInfo;n.db.transaction(function(t){W(t,n,"SELECT COUNT(key) as c FROM "+n.storeName,[],function(t,r){r=r.rows.item(0).c,e(r)},function(e,t){r(t)})})}).catch(r)});return s(r,e),r},key:function(e,t){var r=this,n=new o(function(t,n){r.ready().then(function(){var i=r._dbInfo;i.db.transaction(function(r){W(r,i,"SELECT key FROM "+i.storeName+" WHERE id = ? LIMIT 1",[e+1],function(e,r){r=r.rows.length?r.rows.item(0).key:null,t(r)},function(e,t){n(t)})})}).catch(n)});return s(n,t),n},keys:function(e){var t=this,r=new o(function(e,r){t.ready().then(function(){var n=t._dbInfo;n.db.transaction(function(t){W(t,n,"SELECT key FROM "+n.storeName,[],function(t,r){for(var n=[],i=0;i<r.rows.length;i++)n.push(r.rows.item(i).key);e(n)},function(e,t){r(t)})})}).catch(r)});return s(r,e),r},dropInstance:function(e,t){t=u.apply(this,arguments);var r=this.config(),n=((e="function"!=typeof e&&e||{}).name||(e.name=e.name||r.name,e.storeName=e.storeName||r.storeName),this),i=e.name?new o(function(t){var i,a=e.name===r.name?n._dbInfo.db:openDatabase(e.name,"","",0);e.storeName?t({db:a,storeNames:[e.storeName]}):t((i=a,new o(function(e,t){i.transaction(function(r){r.executeSql("SELECT name FROM sqlite_master WHERE type='table' AND name <> '__WebKitDatabaseInfoTable__'",[],function(t,r){for(var n=[],a=0;a<r.rows.length;a++)n.push(r.rows.item(a).name);e({db:i,storeNames:n})},function(e,r){t(r)})},function(e){t(e)})})))}).then(function(e){return new o(function(t,r){e.db.transaction(function(n){for(var i=[],a=0,s=e.storeNames.length;a<s;a++)i.push((e=>new o(function(t,r){n.executeSql("DROP TABLE IF EXISTS "+e,[],function(){t()},function(e,t){r(t)})}))(e.storeNames[a]));o.all(i).then(function(){t()}).catch(function(e){r(e)})},function(e){r(e)})})}):o.reject("Invalid arguments");return s(i,t),i}};function j(e,t){var r=e.name+"/";return e.storeName!==t.storeName&&(r+=e.storeName+"/"),r}function K(e,t){for(var r,n,i=e.length,a=0;a<i;){if((r=e[a])===(n=t)||"number"==typeof r&&"number"==typeof n&&isNaN(r)&&isNaN(n))return 1;a++}}var G={_driver:"localStorageWrapper",_initStorage:function(e){var t={};if(e)for(var r in e)t[r]=e[r];return t.keyPrefix=j(e,this._defaultConfig),!(()=>{var e="_localforage_support_test";try{localStorage.setItem(e,!0),localStorage.removeItem(e)}catch(e){return 1}})()||0<localStorage.length?((this._dbInfo=t).serializer=B,o.resolve()):o.reject()},_support:(()=>{try{return"undefined"!=typeof localStorage&&"setItem"in localStorage&&!!localStorage.setItem}catch(e){return!1}})(),iterate:function(e,t){var r=this,n=r.ready().then(function(){for(var t=r._dbInfo,n=t.keyPrefix,i=n.length,a=localStorage.length,o=1,s=0;s<a;s++){var c=localStorage.key(s);if(0===c.indexOf(n)){var l=(l=localStorage.getItem(c))&&t.serializer.deserialize(l);if(void 0!==(l=e(l,c.substring(i),o++)))return l}}});return s(n,t),n},getItem:function(e,t){var r=this,n=(e=l(e),r.ready().then(function(){var t=r._dbInfo,n=localStorage.getItem(t.keyPrefix+e);return n&&t.serializer.deserialize(n)}));return s(n,t),n},setItem:function(e,t,r){var n=this,i=(e=l(e),n.ready().then(function(){var r=t=void 0===t?null:t;return new o(function(i,a){var o=n._dbInfo;o.serializer.serialize(t,function(t,n){if(n)a(n);else try{localStorage.setItem(o.keyPrefix+e,t),i(r)}catch(t){"QuotaExceededError"!==t.name&&"NS_ERROR_DOM_QUOTA_REACHED"!==t.name||a(t),a(t)}})})}));return s(i,r),i},removeItem:function(e,t){var r=this,n=(e=l(e),r.ready().then(function(){var t=r._dbInfo;localStorage.removeItem(t.keyPrefix+e)}));return s(n,t),n},clear:function(e){var t=this,r=t.ready().then(function(){for(var e=t._dbInfo.keyPrefix,r=localStorage.length-1;0<=r;r--){var n=localStorage.key(r);0===n.indexOf(e)&&localStorage.removeItem(n)}});return s(r,e),r},length:function(e){var t=this.keys().then(function(e){return e.length});return s(t,e),t},key:function(e,t){var r=this,n=r.ready().then(function(){var t,n=r._dbInfo;try{t=localStorage.key(e)}catch(n){t=null}return t&&t.substring(n.keyPrefix.length)});return s(n,t),n},keys:function(e){var t=this,r=t.ready().then(function(){for(var e=t._dbInfo,r=localStorage.length,n=[],i=0;i<r;i++){var a=localStorage.key(i);0===a.indexOf(e.keyPrefix)&&n.push(a.substring(e.keyPrefix.length))}return n});return s(r,e),r},dropInstance:function(e,t){t=u.apply(this,arguments),(e="function"!=typeof e&&e||{}).name||(n=this.config(),e.name=e.name||n.name,e.storeName=e.storeName||n.storeName);var r=this,n=e.name?new o(function(t){e.storeName?t(j(e,r._defaultConfig)):t(e.name+"/")}).then(function(e){for(var t=localStorage.length-1;0<=t;t--){var r=localStorage.key(t);0===r.indexOf(e)&&localStorage.removeItem(r)}}):o.reject("Invalid arguments");return s(n,t),n}},H=Array.isArray||function(e){return"[object Array]"===Object.prototype.toString.call(e)},Y={},q={},z={INDEXEDDB:e,WEBSQL:V,LOCALSTORAGE:G},X=(e=[z.INDEXEDDB._driver,z.WEBSQL._driver,z.LOCALSTORAGE._driver],["dropInstance"]),J=["clear","getItem","iterate","key","keys","length","removeItem","setItem"].concat(X),Q={description:"",driver:e.slice(),name:"localforage",size:4980736,storeName:"keyvaluepairs",version:1};function $(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];if(r)for(var n in r)r.hasOwnProperty(n)&&(H(r[n])?e[n]=r[n].slice():e[n]=r[n])}return e}function Z(e){var t,r,n;if(!(this instanceof Z))throw new TypeError("Cannot call a class as a function");for(t in z)z.hasOwnProperty(t)&&(n=(r=z[t])._driver,this[t]=n,Y[n]||this.defineDriver(r));this._defaultConfig=$({},Q),this._config=$({},this._defaultConfig,e),this._driverSet=null,this._initDriver=null,this._ready=!1,this._dbInfo=null,this._wrapLibraryMethodsWithReady(),this.setDriver(this._config.driver).catch(function(){})}Z.prototype.config=function(e){if("object"!==(void 0===e?"undefined":n(e)))return"string"==typeof e?this._config[e]:this._config;if(this._ready)return new Error("Can't call config() after localforage has been used.");for(var t in e){if("storeName"===t&&(e[t]=e[t].replace(/\W/g,"_")),"version"===t&&"number"!=typeof e[t])return new Error("Database version must be a number.");this._config[t]=e[t]}return!("driver"in e&&e.driver)||this.setDriver(this._config.driver)},Z.prototype.defineDriver=function(e,t,r){var n=new o(function(t,r){try{var n=e._driver,i=new Error("Custom driver not compliant; see https://mozilla.github.io/localForage/#definedriver");if(e._driver){for(var a=J.concat("_initStorage"),c=0,l=a.length;c<l;c++){var u=a[c];if((!K(X,u)||e[u])&&"function"!=typeof e[u])return void r(i)}for(var d=0,E=X.length;d<E;d++){var g=X[d];e[g]||(e[g]=(e=>function(){var t=new Error("Method "+e+" is not implemented by the current driver");return s(t=o.reject(t),arguments[arguments.length-1]),t})(g))}var h=function(r){Y[n]&&console.info("Redefining LocalForage driver: "+n),Y[n]=e,q[n]=r,t()};"_support"in e?e._support&&"function"==typeof e._support?e._support().then(h,r):h(!!e._support):h(!0)}else r(i)}catch(i){r(i)}});return c(n,t,r),n},Z.prototype.driver=function(){return this._driver||null},Z.prototype.getDriver=function(e,t,r){return c(e=Y[e]?o.resolve(Y[e]):o.reject(new Error("Driver not found.")),t,r),e},Z.prototype.getSerializer=function(e){var t=o.resolve(B);return c(t,e),t},Z.prototype.ready=function(e){var t=this,r=t._driverSet.then(function(){return null===t._ready&&(t._ready=t._initDriver()),t._ready});return c(r,e,e),r},Z.prototype.setDriver=function(e,t,r){var n=this,i=(H(e)||(e=[e]),this._getSupportedDrivers(e));function a(){n._config.driver=n.driver()}function s(e){return n._extend(e),a(),n._ready=n._initStorage(n._config),n._ready}return e=null!==this._driverSet?this._driverSet.catch(function(){return o.resolve()}):o.resolve(),this._driverSet=e.then(function(){var e=i[0];return n._dbInfo=null,n._ready=null,n.getDriver(e).then(function(e){n._driver=e._driver,a(),n._wrapLibraryMethodsWithReady(),n._initDriver=function(e){return function(){var t=0;return function r(){for(;t<e.length;){var i=e[t];return t++,n._dbInfo=null,n._ready=null,n.getDriver(i).then(s).catch(r)}a();var c=new Error("No available storage method found.");return n._driverSet=o.reject(c),n._driverSet}()}}(i)})}).catch(function(){a();var e=new Error("No available storage method found.");return n._driverSet=o.reject(e),n._driverSet}),c(this._driverSet,t,r),this._driverSet},Z.prototype.supports=function(e){return!!q[e]},Z.prototype._extend=function(e){$(this,e)},Z.prototype._getSupportedDrivers=function(e){for(var t=[],r=0,n=e.length;r<n;r++){var i=e[r];this.supports(i)&&t.push(i)}return t},Z.prototype._wrapLibraryMethodsWithReady=function(){for(var e=0,t=J.length;e<t;e++)((e,t)=>{e[t]=function(){var r=arguments;return e.ready().then(function(){return e[t].apply(e,r)})}})(this,J[e])},Z.prototype.createInstance=function(e){return new Z(e)},V=new Z,t.exports=V},{3:3}]},{},[4])(4)},814:e=>{var t,r,n="undefined"!=typeof crypto&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto)||"undefined"!=typeof msCrypto&&"function"==typeof window.msCrypto.getRandomValues&&msCrypto.getRandomValues.bind(msCrypto);n?(t=new Uint8Array(16),e.exports=function(){return n(t),t}):(r=new Array(16),e.exports=function(){for(var e,t=0;t<16;t++)!(3&t)&&(e=4294967296*Math.random()),r[t]=e>>>((3&t)<<3)&255;return r})}},t={};function r(n){var i=t[n];return void 0!==i||(i=t[n]={exports:{}},e[n](i,i.exports,r)),i.exports}r.d=(e,t)=>{for(var n in t)r.o(t,n)&&!r.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:t[n]})},r.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}(),r.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),r.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})};var n,i,a,o,s,c={};{r.r(c),r.d(c,{default:()=>Mn});let ze={URL:"URL",LOGGED_IN_STATUS:"moe_logged_in_status",FIRST_VISIT:"moe_first_visit"},Xe={ID:"USER_ATTRIBUTE_UNIQUE_ID",EMAIL:"USER_ATTRIBUTE_USER_EMAIL",NAME:"USER_ATTRIBUTE_USER_NAME",FIRST_NAME:"USER_ATTRIBUTE_USER_FIRST_NAME",LAST_NAME:"USER_ATTRIBUTE_USER_LAST_NAME",MOBILE:"USER_ATTRIBUTE_USER_MOBILE",GENDER:"USER_ATTRIBUTE_USER_GENDER",BDAY:"USER_ATTRIBUTE_USER_BDAY",ID_MODIFIED:"USER_ID_MODIFIED_FROM"},Je={NUMBER:"number"},Qe={MOE_LIFECYCLE:{TOPIC_NAME:"MOE_LIFECYCLE",EVENT_NAMES:{MOE_INIT:"SDK_INITIALIZED",DEVICE_UUID:"DEVICE_UUID",SDK_DISABLED:"SDK_DISABLED",WEBP_INIT:"WEBP_INITIALIZED"}},USER_LIFECYCLE:{TOPIC_NAME:"USER_LIFECYCLE",EVENT_NAMES:{USER_IDENTITY_UPDATE:"USER_IDENTITY_UPDATE",LOGOUT:"LOGOUT"}},SPA_LIFECYCLE:{TOPIC_NAME:"SPA",EVENT_NAMES:{PAGE_CHANGED:"PAGE_CHANGED"}}},$e={SCRIPT_URL:"http://localhost:3001/sample.js",EDITOR_QUERY_PARAM:"moeWpE",NO_LIVE_CAMPAIGN:"MoeWpLive",CHECK_TEST_WEBP:"moeWpT",VERSION_FILE:"https://app-cdn.moengage.com/personalization-ui/editor/version.json",STAGING_EDITOR_FILE:"https://app-cdn.moengage.com/personalization-ui/editor/moe-web-editor.staging.js",STAGING_ERROR:"Version not found in staging",EDITOR_FILE:e=>`https://app-cdn.moengage.com/personalization-ui/editor/moe-web-editor.${e}.js`,CLUSTER_ENVIRONMENT_MAP:{DC_1:"sdk-01.moengage.com",DC_2:"sdk-02.moengage.com",DC_3:"sdk-03.moengage.com",DC_4:"sdk-04.moengage.com",DC_5:"sdk-05.moengage.com",DC_6:"sdk-06.moengage.com",DC_100:"sdk-100.moengage.com",DC_101:"sdk-101.moengage.com"},CLUSTERS:{dc_1:"DC_1",dc_2:"DC_2",dc_3:"DC_3",dc_4:"DC_4",dc_5:"DC_5",dc_6:"DC_6",dc_100:"DC_100",dc_101:"DC_101"},EVENTS:{IMPRESSION:"MOE_WEBP_MESSAGE_SHOWN",CLICK:"MOE_WEBP_MESSAGE_CLICKED"},MOE_UUID:"moe_uuid",RETRY_INTERVAL:3e3,RETRY_MAX_TIME:30,PRE_PROD:"PRE_PROD",MAX_EVENTS_FOR_IN_SESSION:10,MAX_RETRY_OPERATION_ATTEMPTES:20,FUNCTION_DEBOUNCE_TIME:500,ANTI_FLICKER_STYLESHEET:"moe-flicker-style",ANTI_FLICKER_HIDE:"moe-anti-flicker-hide",ANTI_FLICKER_SHOW:"moe-anti-flicker-show",ANTI_FLICKER_CLASSNAME:"moe-anti-flicker-style",SYNC_TIME_FOR_WEB_ACTION_EVENTS:1440,DATA_MOE_SELECTOR_ID:"data-moe-id"},Ze={PageEventHistoryManager:"MoengagePageEventHistoryManager"},et={WEB_P_EVENT_WATCHER_MAX_RETRIES:5},tt={ELEMENT_BORDER_CLASS:"moe-show-personalized-experience",DATA_ATTRIBUTE:{LABEL_NAME:"data-moe-personalized-label",BACKUP_TITLE:"data-moe-backup-title"},STYLE:{STYLE_ID:"moe-personalized-experience-css",STYLE_DATA:"\n    .moe-show-personalized-experience {\n      outline-offset: -3px;\n      outline: 3px dashed #06A6B7;\n      border: 3px dashed #06A6B7;\n    }\n    .tooltip {\n      visibility: hidden;\n      opacity: 0;\n      transition: opacity 0.2s, visibility 0.2s;\n      color: #fff;\n      border: 1px solid #06A6B7;\n      border-radius: 3px;\n      background-color: #06A6B7;\n      padding: 4px;\n      font-size: 12px;\n      white-space: nowrap;\n      position: fixed;\n      z-index: 1000;\n      pointer-events: none; /* Ensures the tooltip doesn't interfere with mouse events */\n    }\n    .tooltip.visible {\n      visibility: visible;\n      opacity: 1;\n    }\n    "},LABELS:{update:"Text edited",attribute:"Attributes updated",tracking:"Tracking enabled",insert:"Custom HTML added",insert_js:"",update_outerhtml:"HTML edited",rearrange:"Element rearranged",insert_image:"Image added",replace:"Element replaced"}},rt={WEBP:"MoeWebP",PAGE_CONTEXT:"moePageContext"},nt={USER_DATA:"USER_DATA",IDENTITY_MAP:"IDENTITY_MAP",DEVICE_DATA:"DEVICE_DATA",SESSION:"SESSION",SDK_DISABLED:"SDK_DISABLED",INIT_DATA:"INIT_DATA",WEB_SETTINGS:"WEB_SETTINGS"},it={SESSION:"SESSION",NUMBER_OF_SESSIONS:"numberOfSessions"},at={LIVE:"v1/experiences/web/live",TEST:"v1/experiences/web/test",STATS:"v1/experiences/web/stats",WEB_ACTION:"v1/experiences/web/actions",LIVE_RECOMMENDATIONS:"v1/experiences/web/live_recom",SPLIT_URL:"v1/experiences/web/split",TAB_DATA:"v1/experiences/web/recommendations",FETCH:"v1/experiences/sdk/fetch"},ot={DATABASE_NAME:"moe_webp",EXPERIENCES:{STORE_NAME:"experiences"},AI_EXPERIENCES:{STORE_NAME:"ai_experiences",AI_EXPERIENCE_CONTEXT:"ai_experience_context",WEB_ACTION_EVENTS:"web_action_events",WEB_ACTIONS_LAST_FETCHED_TIME:"web_actions_last_fetched_time"},META:{STORE_NAME:"meta",LAST_FETCHED_TIME:"last_fetched_time",USER_IN_GCG:"user_in_gcg"},IN_SESSION:{STORE_NAME:"inSession",IN_SESSION_EVENTS:"in_session_events",IN_SESSION_EVENTS_HISTORY:"in_session_events_history"},SPLIT_EXPERIENCES:{STORE_NAME:"split_experiences"},TABBED_EXPERIENCES:{STORE_NAME:"tabbed_experiences"}};function l(e,t,r){return null!=e&&t?(e=e[(t=Array.isArray(t)?t:t.split("."))[0]])&&1<t.length?l(e,t.slice(1),r):void 0===e?r||null:e:null}class st{static set(e,t){st.baseLogTag,window&&(window.moeInternals?window.moeInternals.ephemeral||(window.moeInternals.ephemeral={}):(window.moeInternals={},window.moeInternals.ephemeral={}),window.moeInternals.ephemeral[e]=t)}static get(e){return l(window,"moeInternals.ephemeral."+e,null)}static clear(){window&&(window.moeInternals={},window.moeInternals.ephemeral={})}}st.baseLogTag="EphemeralStorage";let ct={INIT_DATA:"initData",BROWSER_DETAILS:"browserDetails",UNIFIED_LOGS:"unifiedLogs",HAS_USER_LOGGED_OUT:"hasUserLoggedOut",LANDING_PAGE_TRACKING:"landingPageTracking"},lt={USER_DATA:"USER_DATA",PUSH_TOKEN:"PUSH_TOKEN",SUBSCRIPTION_DETAILS:"SUBSCRIPTION_DETAILS",SETUP_TIME:"SETUP_TIME",OPT_IN_SHOWN_TIME:"OPT_IN_SHOWN_TIME",OPTED_STATUS_TRACK_TIME:"OPTED_STATUS_TRACK_TIME",SOFT_ASK_STATUS:"SOFT_ASK_STATUS",HARD_ASK_STATUS:"HARD_ASK_STATUS",WEB_SETTINGS:"WEB_SETTINGS",GRACEFUL_DATA:"GRACEFUL_DATA",Q:{PREFIX:"Q",REPORT:"REPORT",DEVICE:"DEVICE"},INIT_DATA:"INIT_DATA",OLD_SDK:{USER_DATA:"moengage_data",SUBSCRIPTION_DETAILS:"MOE_PUSH_ENDPOINT",PUSH_TOKEN:"MOE_PUSH_TOKEN"},BROWSER_DETAILS:"browserDetails",SESSION:"SESSION",DEVICE_DATA:"DEVICE_DATA",IDENTITY_MAP:"IDENTITY_MAP",SDK_VERSION:"SDK_VERSION",SDK_DISABLED:"SDK_DISABLED"},ut={SESSION_COOKIE:{EXPIRY_YEARS:2}},dt="COOKIE_SHARING",Et={COOKIE_NAME_MAPPING:{[lt.USER_DATA]:"moe_u_d",[lt.SUBSCRIPTION_DETAILS]:"moe_s_d",[lt.PUSH_TOKEN]:"moe_p_t",[lt.OPT_IN_SHOWN_TIME]:"moe_o_s_t",[lt.SOFT_ASK_STATUS]:"moe_s_a_s",[lt.HARD_ASK_STATUS]:"moe_h_a_s",[lt.SESSION]:"moe_s_n",[lt.DEVICE_DATA]:"moe_d_d",[lt.IDENTITY_MAP]:"moe_i_m",[lt.SDK_DISABLED]:"moe_dis",COOKIE_SHARING:"moe_c_s"},PERMISSION_STATE_MAPPING:{prompt:2,granted:1,dismissed:3,denied:0,shown:4,"not shown":5,allowed:6},SUBSCRIPTION_DETAILS_KEYS:{domain:"d",token:"t",endpoint:"e",keys:"k",p256dh:"p",auth:"a"},USER_DATA_KEYS:{attributes:"a",subscribedToOldSdk:"s_old",deviceUuid:"d_id",deviceAdded:"d_added"},ATTRIBUTE_KEYS:{key:"k",value:"v",updated_at:"u_at",level:"l"},IDENTITY_MAP_KEYS:{userIdentities:"u_i",previousIdentities:"p_i",previousIdentitiesUpdatedTime:"p_i_u_t"},SESSION_KEYS:{sessionKey:"s_k",sessionStartTime:"s_s_t",sessionMaxTime:"s_m_t",customIdentifiersToTrack:"c_i_t_t",sessionExpiryTime:"s_e_t",numberOfSessions:"n_o_s",currentSource:"c_s"},SOURCE_KEYS:{source:"s",medium:"m",source_url:"s_u",term:"t",campaign_name:"c_n",campaign_id:"c_id",content:"c",extra:"e"},DEVICE_DATA_KEYS:{deviceUniqueId:"d_uid"},ENDPOINT_URL_MAPPING:{"https://fcm.googleapis.com/fcm/send/":"f","https://wns2-pn1p.notify.windows.com/w/":"w","https://wns2-sin1p.notify.windows.com/":"w1","https://wns2-bay1p.notify.windows.com/":"w2","https://updates.push.services.mozilla.com/wpush/v2/":"m","https://web.push.apple.com/":"a"}},gt={USER_ATTRIBUTE:"EVENT_ACTION_USER_ATTRIBUTE",UNSUBSCRIBED:"MOE_WEB_UNSUBSCRIBED",WEB_SESSION_START:"EVENT_ACTION_WEB_SESSION_START",PAGE_VIEWED:"MOE_PAGE_VIEWED",WEB_OPTIN_BANNER_LOAD:"MOE_WEB_OPTIN_BANNER_LOAD",WEB_OPTIN_CLOSED:"MOE_WEB_OPTIN_CLOSED",WEB_OPTIN_ACCEPTED:"MOE_WEB_OPTIN_ACCEPTED",USER_SUBSCRIBED:"MOE_USER_SUBSCRIBED",OPT_IN_SHOWN:"MOE_OPT_IN_SHOWN",OPT_IN_ALLOWED:"MOE_OPT_IN_ALLOWED",OPT_IN_DISMISSED:"MOE_OPT_IN_DISMISSED",OPT_IN_BLOCKED:"MOE_OPT_IN_BLOCKED",OPT_IN_ATTEMPT:"MOE_OPT_IN_ATTEMPT",LOGOUT:"MOE_LOGOUT",DEVICE_ATTRIBUTE:"EVENT_ACTION_DEVICE_ATTRIBUTE",PERMISSION_ALLOWED:"MOE_PUSH_PERMISSION_STATE_ALLOWED",PERMISSION_BLOCKED:"MOE_PUSH_PERMISSION_STATE_BLOCKED",MOE_PAGE_EXIT:"MOE_PAGE_EXIT",MOE_PAGE_SCROLL:"MOE_PAGE_SCROLL",MOE_PAGE_URL_EVENT:"MOE_PAGE_URL_EVENT",MOE_EXIT:"MOE_EXIT"},ht={URL:"URL",LOGGED_IN_STATUS:"moe_logged_in_status",FIRST_VISIT:"moe_first_visit"},pt={ID:"USER_ATTRIBUTE_UNIQUE_ID",EMAIL:"USER_ATTRIBUTE_USER_EMAIL",NAME:"USER_ATTRIBUTE_USER_NAME",FIRST_NAME:"USER_ATTRIBUTE_USER_FIRST_NAME",LAST_NAME:"USER_ATTRIBUTE_USER_LAST_NAME",MOBILE:"USER_ATTRIBUTE_USER_MOBILE",GENDER:"USER_ATTRIBUTE_USER_GENDER",BDAY:"USER_ATTRIBUTE_USER_BDAY",ID_MODIFIED:"USER_ID_MODIFIED_FROM"},vt=[pt.ID,pt.ID_MODIFIED],ft={MOE_LIFECYCLE:{TOPIC_NAME:"MOE_LIFECYCLE",EVENT_NAMES:{MOE_INIT:"SDK_INITIALIZED",SETTINGS_FETCHED:"SETTINGS_FETCHED",EVENT_TRACKED:"EVENT_TRACKED",DEVICE_UUID:"DEVICE_UUID",MOE_INIT_COMPLETED:"SDK_INITIALIZATION_COMPLETED",CARDS_INIT:"CARDS_INITIALIZED",SDK_DISABLED:"SDK_DISABLED",SDK_ENABLED:"SDK_ENABLED",OSM_INIT:"OSM_INITIALIZED",WEBP_INIT:"WEBP_INITIALIZED",LANDING_PAGE_DEVICE_ADD:"LANDING_PAGE_DEVICE_ADD"}},OPT_IN_LIFECYCLE:{TOPIC_NAME:"MOE_OPT_IN",EVENT_NAMES:{HARD_ASK_SHOWN:"HARD_ASK_SHOWN",HARD_ASK_DISMISSED:"HARD_ASK_DISMISSED",HARD_ASK_ATTEMPTED:"HARD_ASK_ATTEMPTED",HARD_ASK_ALLOWED:"HARD_ASK_ALLOWED",HARD_ASK_DENIED:"HARD_ASK_DENIED",SOFT_ASK_SHOWN:"SOFT_ASK_SHOWN",SOFT_ASK_DISMISSED:"SOFT_ASK_DISMISSED",SOFT_ASK_ALLOWED:"SOFT_ASK_ALLOWED"}},INAPP_LIFECYCLE:{TOPIC_NAME:"INAPP_LIFECYCLE",EVENT_NAMES:{MODULE_LOADED:"MODULE_LOADED",OSM_RENDERED:"OSM_RENDERED"}},USER_LIFECYCLE:{TOPIC_NAME:"USER_LIFECYCLE",EVENT_NAMES:{USER_IDENTITY_UPDATE:"USER_IDENTITY_UPDATE",LOGOUT:"LOGOUT"}},SPA_LIFECYCLE:{TOPIC_NAME:"SPA",EVENT_NAMES:{PAGE_CHANGED:"PAGE_CHANGED"}}},_t={DC_1:"sdk-01.moengage.com",DC_2:"sdk-02.moengage.com",DC_3:"sdk-03.moengage.com",DC_4:"sdk-04.moengage.com",DC_5:"sdk-05.moengage.com",DC_6:"sdk-06.moengage.com",DC_100:"sdk-100.moengage.com",DC_101:"sdk-101.moengage.com",EU:"sdk-02.moengage.com",IN:"sdk-03.moengage.com"},mt={MOE_DASHBOARD:"https://dashboard.moengage.com",WEBSDK_DOCS:"https://developers.moengage.com/hc/en-us/articles/360060713252-Web-SDK-Integration",SELF_HANDLED_DOCS:"https://developers.moengage.com/hc/en-us/articles/360061219351-Configure-Self-Handled-Opt-In"},St={SESSION:"SESSION",SESSION_KEY:"sessionKey",SESSION_START_TIME:"sessionStartTime",SESSION_EXPIRY_TIME:"sessionExpiryTime",SESSION_MAX_TIME:"sessionMaxTime",SESSION_ENABLED:"sessionEnabled",CUSTOM_IDENTIFIERS_TO_TRACK:"customIdentifiersToTrack",CURRENT_SOURCE:"currentSource",NUMBER_OF_SESSIONS:"numberOfSessions"},Tt={DATABASE_NAME:"moe_tracking",STORE_NAME:"events"},It={DATABASE_NAME:"moe_tracking",STORE_NAME:"batched_events"},At={DATABASE_NAME:"moe_database",STORE_NAME:"moe_data"},bt={UUID:"moe_uuid"};const yt={OSM:{CLICK:"MOE_ONSITE_MESSAGE_CLICKED",IMPRESSION:"MOE_ONSITE_MESSAGE_SHOWN",DISMISS:"MOE_ONSITE_MESSAGE_DISMISSED",AUTO_DISMISS:"MOE_ONSITE_MESSAGE_AUTO_DISMISS",DELIVERED:"MOE_ONSITE_MESSAGE_DELIVERED",TYPE:"onsite"},WP:{CLICK:"MOE_WEBP_MESSAGE_CLICKED",IMPRESSION:"MOE_WEBP_MESSAGE_SHOWN",DISMISS:"MOE_WEBP_MESSAGE_DISMISSED",DELIVERED:"MOE_WEBP_MESSAGE_DELIVERED",TYPE:"webp"}};let Ot={DATABASE_NAME:"moe_database",OFFLINE_SYNC_EVENT:"moe_offline_data_sync",STORES:{OFFLINE_DATA:{NAME:"offline_data"}}},Dt={API:{REPORT_ADD:"v2/sdk/report/"},CONFIG:{TIME_BETWEEN_BATCHES:15e3}},Nt={FIRST_SEEN_SESSIONS:1},Rt={TOPIC:"MOE_AUTOMATED_EVENTS",NAMES:[gt.UNSUBSCRIBED,gt.WEB_SESSION_START,gt.PAGE_VIEWED,gt.WEB_OPTIN_BANNER_LOAD,gt.WEB_OPTIN_CLOSED,gt.WEB_OPTIN_ACCEPTED,gt.USER_SUBSCRIBED,gt.OPT_IN_ATTEMPT,gt.OPT_IN_SHOWN,gt.OPT_IN_ALLOWED,gt.OPT_IN_DISMISSED,gt.OPT_IN_BLOCKED,gt.PERMISSION_ALLOWED,gt.PERMISSION_BLOCKED,gt.LOGOUT,yt.OSM.CLICK,yt.OSM.IMPRESSION,yt.OSM.DISMISS,yt.OSM.AUTO_DISMISS]},wt=[gt.OPT_IN_ATTEMPT],Lt={MOE_PUSH_OPTED:"moe_push_opted"},Ct={END_POINT:"v1/sdk_logging/"},Pt={API:{DEVICE_ADD:"v2/device/add",DEVICE_TOKEN_CHECK:"v2/device/token-check",REPORT_ADD:"v2/report/add"},MAX_PAYLOAD_SIZE:195},Mt={TV:"tv",TABLET:"tablet",MOBILE:"mobile",WEB:"web"},kt={TIZEN:"Tizen",WEB_OS:"WebOS",XBOX:"Xbox",VIZIO:"viziotv",DEFAULT:"SmartTV"},Ut="User is offline.",Bt=[{moeName:"uid",attributeName:"USER_ATTRIBUTE_UNIQUE_ID",programName:"id"},{moeName:"u_em",attributeName:"USER_ATTRIBUTE_USER_EMAIL",programName:"email"},{moeName:"u_gd",attributeName:"USER_ATTRIBUTE_USER_GENDER",programName:"gender"},{moeName:"u_bd",attributeName:"USER_ATTRIBUTE_USER_BDAY",programName:"birthday"},{moeName:"u_n",attributeName:"USER_ATTRIBUTE_USER_NAME",programName:"name"},{moeName:"u_fn",attributeName:"USER_ATTRIBUTE_USER_FIRST_NAME",programName:"first_name"},{moeName:"u_ln",attributeName:"USER_ATTRIBUTE_USER_LAST_NAME",programName:"last_name"},{moeName:"u_mb",attributeName:"USER_ATTRIBUTE_USER_MOBILE",programName:"mobile"}],xt=["Google Chrome","Mozilla Firefox","Opera","Apple Safari","Edge"],Wt="identifiers",Ft=[lt.DEVICE_DATA];function u(){return window[window.moengage_object||"Moengage"]}class Vt{static logData(e,t){return{log_type:e,sent_time:(new Date).toISOString(),lake_fields:t}}static setRemoteLogging(e,t){return this.isTrackingEnabled||(this.logLevel=e,this.isTrackingEnabled=t),this.isTrackingEnabled}static log(e,t,r,n,...i){!this.isTrackingEnabled||e!==this.logLevel&&"verbose"!==this.logLevel||u().remoteLogs.addRemoteLogs(this.logData(e,{msg:r+[...i].toString(),file_name:t,trace:n}))}}let jt="color: white; background: #41AE55; border-radius: 5px;";class Kt{static setLogLevel(e,t){var r=Kt.baseLogTag+".setLogLevel";null==st.get(ct.UNIFIED_LOGS)&&st.set(ct.UNIFIED_LOGS,[]),null==e?Kt.logLevel=0:e in[0,1,2]?0<(Kt.logLevel=e)&&t&&Kt.releaseAllLogs():Kt.warn(0,r,"Value",e,"not supported for setDebugLevel(). Current log level is",Kt.logLevel,". Debug level can only be [0, 1, 2]")}static setLogTabStyle(e){Kt.tagLogStyle=Kt.tagLogStyle.replace("#48beab",e)}static log(e,t,r,...n){e<=Kt.logLevel?console.log("%c "+Kt.logBrand+" %c %c info %c %c "+t+" ",jt,"","color: white; background: #18a0bf; border-radius: 5px;","",Kt.tagLogStyle,r,...n):Kt.cacheLog(()=>{Kt.log(e,t,r,...n)})}static remoteLogTracking(e,t,r,n,...i){Vt.log(t,r,n,...i),this.log(e,r,n,...i)}static error(e,t,r,...n){var i;null!=(i=n[n.length-1])&&i.isCached||Vt.log("error",t,r,...n),e<=Kt.logLevel?console.error("%c "+Kt.logBrand+" %c %c error %c %c "+t+" ",jt,"","color: white; background: #cc0a0a; border-radius: 5px;","",Kt.tagLogStyle,r,...n.slice(0,-1)):Kt.cacheLog(()=>{Kt.error(e,t,r,...n,{isCached:!0})})}static warn(e,t,r,...n){var i;null!=(i=n[n.length-1])&&i.isCached||Vt.log("warning",t,r,...n),e<=Kt.logLevel?console.warn("%c "+Kt.logBrand+" %c %c warn %c %c "+t+" ",jt,"","color: white; background: #e8ab51; border-radius: 5px;","",Kt.tagLogStyle,r,...n.slice(0,-1)):Kt.cacheLog(()=>{Kt.warn(e,t,r,...n,{isCached:!0})})}static customLabel(e,t,r,...n){e<=Kt.logLevel?console.log("%c "+Kt.logBrand+" %c %c "+t+" %c %c "+r+" %c ",jt,"",Kt.tagLogStyle,"","color: white; background: #a400ff; border-radius: 5px;","",...n):Kt.cacheLog(()=>{Kt.customLabel(e,t,r,...n)})}static image(e,t){e<=Kt.logLevel?console.log("%c+","font-size: 1px; padding: 20px 80px; line-height: 45px; background: url("+t+"); background-size: 160px 90px; color: transparent;"):Kt.cacheLog(()=>{Kt.image(e,t)})}static releaseAllLogs(){var e=st.get(ct.UNIFIED_LOGS),t=e.length,r=e;if(st.set(ct.UNIFIED_LOGS,[]),0<t){Kt.log(0,"Logger.releaseAllLogs","<---- HISTORICAL LOGS BEGIN ----\x3e");for(let e=0;e<t;e++)r[e]();Kt.log(0,"Logger.releaseAllLogs","<---- HISTORICAL LOGS END ----\x3e")}}static setLogBrand(e){Kt.logBrand=e}static setBrandColor(e){jt="color: white; background: "+e+"; border-radius: 5px;"}static cacheLog(e){let t=st.get(ct.UNIFIED_LOGS);(t=null==t?[]:t).push(e),st.set(ct.UNIFIED_LOGS,t)}}Kt.baseLogTag="Logger",Kt.logBrand="MoEngage",Kt.logLevel=0,Kt.tagLogStyle="color: white; background: #48beab; border-radius: 5px;";let Gt=e=>{if(e){var t=e.indexOf("?");if(t<0)return{};t=(e=e.slice(t+1)).replace("?","").split("&");let r={};return t.forEach(e=>{var t=(e=e.split("="))[0];e=decodeURIComponent(e[1]||""),r[t]?"[object Array]"===Object.prototype.toString.call(r[t])?r[t].push(e):r[t]=[r[t],e]:r[t]=e}),JSON.parse(JSON.stringify(r))}return{}};class Ht{static get(e,t){return Ht.makeNetworkCall(n.METHODS.GET,e,t)}static post(e,t){return Ht.makeNetworkCall(n.METHODS.POST,e,t)}static makeNetworkCall(e,t,r={}){return new Promise((n,i)=>{var a=JSON.stringify(l(r,"postData",null));t=((e,t)=>{if(t){for(var r in"?"!==e[e.length-1]&&(e+="?"),t)t.hasOwnProperty(r)&&null!=t[r]&&(e+=r+"="+encodeURIComponent(t[r])+"&");"&"===e[e.length-1]&&(e=e.slice(0,-1))}return e})(t,l(r,"queryParams",null));let o=new XMLHttpRequest;o.open(e,t,!0),Ht.addRequestHeaders(o,l(r,"headers",{})),o.onreadystatechange=()=>{4===o.readyState&&200===o.status||4===o.readyState&&410===o.status?n({status:o.status,responseText:o.responseText}):4===o.readyState&&200!==o.status&&i({code:o.status,reason:o.responseText})},o.send(a)})}static addRequestHeaders(e,t){for(var r in t)t.hasOwnProperty(r)&&e.setRequestHeader(r,t[r]);return e}}(c=(c=n=n||{}).METHODS||(c.METHODS={})).GET="GET",c.POST="POST";var d,E=r(790),g=function(e,t,r,n){return new(r=r||Promise)(function(i,a){function o(e){try{c(n.next(e))}catch(e){a(e)}}function s(e){try{c(n.throw(e))}catch(e){a(e)}}function c(e){var t;e.done?i(e.value):((t=e.value)instanceof r?t:new r(function(e){e(t)})).then(o,s)}c((n=n.apply(e,t||[])).next())})};class Yt{static initialize(){return g(this,void 0,void 0,function*(){var e;return null==Yt.ready&&(Yt.experiencesStore=E.createInstance({driver:[E.INDEXEDDB,E.WEBSQL,E.LOCALSTORAGE],name:ot.DATABASE_NAME,storeName:ot.EXPERIENCES.STORE_NAME}),Yt.aiExperiencesStore=E.createInstance({driver:[E.INDEXEDDB,E.WEBSQL,E.LOCALSTORAGE],name:ot.DATABASE_NAME,storeName:ot.AI_EXPERIENCES.STORE_NAME}),Yt.metaStore=E.createInstance({driver:[E.INDEXEDDB,E.WEBSQL,E.LOCALSTORAGE],name:ot.DATABASE_NAME,storeName:ot.META.STORE_NAME}),Yt.inSessionStore=E.createInstance({driver:[E.INDEXEDDB,E.WEBSQL,E.LOCALSTORAGE],name:ot.DATABASE_NAME,storeName:ot.IN_SESSION.STORE_NAME}),Yt.splitExperiences=E.createInstance({driver:[E.INDEXEDDB,E.WEBSQL,E.LOCALSTORAGE],name:ot.DATABASE_NAME,storeName:ot.SPLIT_EXPERIENCES.STORE_NAME}),Yt.tabbedExperiences=E.createInstance({driver:[E.INDEXEDDB,E.WEBSQL,E.LOCALSTORAGE],name:ot.DATABASE_NAME,storeName:ot.TABBED_EXPERIENCES.STORE_NAME}),e=[Yt.experiencesStore.ready(),Yt.aiExperiencesStore.ready(),Yt.metaStore.ready(),Yt.inSessionStore.ready(),Yt.splitExperiences.ready(),Yt.tabbedExperiences.ready()],Yt.ready=Promise.all(e)),Yt.ready})}static clear(){return g(this,void 0,void 0,function*(){var e=Yt.baseLogTag+".clear";try{yield Yt.initialize(),yield Promise.all([Yt.experiencesStore.clear(),Yt.aiExperiencesStore.clear(),Yt.metaStore.clear(),Yt.splitExperiences.clear(),Yt.tabbedExperiences.clear()]);var t=[Yt.experiencesStore.ready(),Yt.aiExperiencesStore.ready(),Yt.metaStore.ready(),Yt.splitExperiences.ready(),Yt.tabbedExperiences.ready()];Yt.ready=Promise.all(t)}catch(t){Kt.error(1,e,"Error clearing web personalization stores:",t)}return Yt.ready})}}Yt.baseLogTag="MOE_WEBP_STORES";class qt{constructor(e){this.debugLevel=0,this.cluster=null,this.environment=null,this.baseDomainName="https://sdk-01.moengage.com/",this.inapp=null,this.customSoftAsk=null;var t=qt.baseLogTag+".constructor";null!=l(e,"app_id",null)?(this.appId=l(e,"app_id",null),this.integrationType=d.OLD_SDK):null!=l(e,"appId",null)?(this.appId=l(e,"appId",null),this.integrationType=d.NEW_SDK):(Kt.error(1,t,"App Id not specified. Please check docs page to complete the integration - ",mt.WEBSDK_DOCS),this.integrationType=null),null!=l(e,"debug_logs",null)?this.debugLevel=l(e,"debug_logs",0):null!=l(e,"debugLevel",null)?this.debugLevel=l(e,"debugLevel",0):(Kt.log(2,t,"No log level config found. Using default value of",0),this.debugLevel=0),this.appId&&(this.baseDomainName="https://sdk-01.moengage.com/",this.forceSwUpdate=l(e,"forceSwUpdate",!1),this.cluster=l(e,"cluster",this.cluster),this.cluster&&null!=_t[this.cluster.toUpperCase()]&&(this.environment=_t[this.cluster.toUpperCase()]),l(e,"environment",null)&&(this.environment=e.environment),this.environment&&(this.baseDomainName="https://"+this.environment+"/"),0<this.debugLevel&&this.appId.indexOf("_DEBUG")<0?this.appId=this.appId+"_DEBUG":0===this.debugLevel&&0<=this.appId.indexOf("_DEBUG")&&(this.appId=this.appId.substr(0,this.appId.indexOf("_DEBUG"))),this.swPath=l(e,"swPath",null),null!=e.customSoftAsk?this.customSoftAsk={mainClass:l(e,"customSoftAsk.mainClass",null),allowClass:l(e,"customSoftAsk.allowClass",null),dismissClass:l(e,"customSoftAsk.dismissClass",null)}:this.customSoftAsk={mainClass:l(e,"main_class",null),allowClass:l(e,"allow_class",null),dismissClass:l(e,"block_class",null)},null!=l(e,"inapp.host",null)&&(this.inapp={host:l(e,"inapp.host",null)}),null!=l(e,"swScope",null)&&(this.swScope=l(e,"swScope",null)),null!=l(e,"disable_onsite",null)&&(this.disableOnsite=l(e,"disable_onsite",!1)),null!=l(e,"enableSPA",null)&&(this.enableSPA=l(e,"enableSPA",!1)),null!=l(e,"cards",null)&&(this.cards=l(e,"cards",{})),null!=l(e,"proxyDomains",null)&&(this.proxyDomains=l(e,"proxyDomains",null),this.proxyDomains.api)&&(this.baseDomainName="https://"+this.proxyDomains.api+"/",this.environment=this.proxyDomains.api),null!=l(e,"disable_web_push",null)&&(this.disableWebPush=l(e,"disable_web_push",!1)),null!=l(e,"disableCookies",null)&&(this.disableCookies=l(e,"disableCookies",!1)),null!=l(e,"disableSdk",null)&&(this.disableSdk=l(e,"disableSdk",!1)),null!=l(e,"project_id",null))&&(this.projectId=l(e,"project_id",null))}static save(e){st.set(ct.INIT_DATA,new qt(e)),ar.set(lt.INIT_DATA,new qt(e))}static get(){return st.get(ct.INIT_DATA)}}function h(e,t){return!(e!==pt.EMAIL&&e!==pt.MOBILE&&!t.includes(e))}qt.baseLogTag="InitData",(c=d=d||{}).OLD_SDK="OLD_SDK",c.NEW_SDK="NEW_SDK";class zt{constructor(){this.items=[]}static enqueue(e,t){e=zt.getLocalStorageQName(e);let r=new zt;(r=ar.get(e)?ar.get(e):r).items.push(t),r.items=r.items.slice(Math.max(r.items.length-50,0)),ar.set(e,r)}static dequeue(e){e=zt.getLocalStorageQName(e);var t=ar.get(e);let r=null;return t&&0<t.items.length&&(r=t.items[0],t.items.splice(0,1),ar.set(e,t)),r}static isEmpty(e){return e=zt.getLocalStorageQName(e),!(ar.get(e)&&0<ar.get(e).items.length)}static purge(e){var t=this.baseLogTag+".purge",r=zt.getLocalStorageQName(e);zt.isEmpty(e)||ar.remove(r),Kt.log(2,t,`Queue "${e}" has been cleared.`)}static getLocalStorageQName(e){return lt.Q.PREFIX+"_"+e}}zt.baseLogTag="LocalQ";var p=Uint8Array,v=Uint16Array,f=Int32Array,_=new p([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),m=new p([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),S=new p([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),T=(c=function(e,t){for(var r=new v(31),n=0;n<31;++n)r[n]=t+=1<<e[n-1];var i=new f(r[30]);for(n=1;n<30;++n)for(var a=r[n];a<r[n+1];++a)i[a]=a-r[n]<<5|n;return{b:r,r:i}})(_,2),I=T.b,A=T.r;I[28]=258,A[258]=28;for(var b=(T=c(m,0)).b,y=T.r,O=new v(32768),D=0;D<32768;++D){var N=(43690&D)>>1|(21845&D)<<1;O[D]=((65280&(N=(61680&(N=(52428&N)>>2|(13107&N)<<2))>>4|(3855&N)<<4))>>8|(255&N)<<8)>>1}var R=function(e,t,r){for(var n=e.length,i=0,a=new v(t);i<n;++i)e[i]&&++a[e[i]-1];var o=new v(t);for(i=1;i<t;++i)o[i]=o[i-1]+a[i-1]<<1;if(r){var s=new v(1<<t),c=15-t;for(i=0;i<n;++i)if(e[i])for(var l=i<<4|e[i],u=t-e[i],d=o[e[i]-1]++<<u,E=d|(1<<u)-1;d<=E;++d)s[O[d]>>c]=l}else for(s=new v(n),i=0;i<n;++i)e[i]&&(s[i]=O[o[e[i]-1]++]>>15-e[i]);return s},w=new p(288);for(D=0;D<144;++D)w[D]=8;for(D=144;D<256;++D)w[D]=9;for(D=256;D<280;++D)w[D]=7;for(D=280;D<288;++D)w[D]=8;var L=new p(32);for(D=0;D<32;++D)L[D]=5;var C=R(w,9,0),P=R(w,9,1),M=R(L,5,0),k=R(L,5,1),U=function(e){for(var t=e[0],r=1;r<e.length;++r)t<e[r]&&(t=e[r]);return t},B=function(e,t,r){var n=t/8|0;return(e[n]|e[1+n]<<8)>>(7&t)&r},x=function(e,t){var r=t/8|0;return(e[r]|e[1+r]<<8|e[2+r]<<16)>>(7&t)},W=function(e){return(e+7)/8|0},F=function(e,t,r){return(null==r||r>e.length)&&(r=e.length),new p(e.subarray(t=null==t||t<0?0:t,r))},V=["unexpected EOF","invalid block type","invalid length/literal","invalid distance","stream finished","no stream handler",,"no callback","invalid UTF-8 data","extra field too long","date not in range 1980-2099","filename too long","stream finishing","invalid zip data"],j=function(e,t,r){if((t=new Error(t||V[e])).code=e,Error.captureStackTrace&&Error.captureStackTrace(t,j),r)return t;throw t},K=function(e,t,r){var n=t/8|0;e[n]|=r<<=7&t,e[1+n]|=r>>8},G=function(e,t,r){var n=t/8|0;e[n]|=r<<=7&t,e[1+n]|=r>>8,e[2+n]|=r>>16},H=function(e,t){for(var r=[],n=0;n<e.length;++n)e[n]&&r.push({s:n,f:e[n]});var i=r.length,a=r.slice();if(!i)return{t:$,l:0};if(1==i)return(f=new p(r[0].s+1))[r[0].s]=1,{t:f,l:1};r.sort(function(e,t){return e.f-t.f}),r.push({s:-1,f:25001});var o=r[0],s=r[1],c=0,l=1,u=2;for(r[0]={s:-1,f:o.f+s.f,l:o,r:s};l!=i-1;)o=r[r[c].f<r[u].f?c++:u++],s=r[c!=l&&r[c].f<r[u].f?c++:u++],r[l++]={s:-1,f:o.f+s.f,l:o,r:s};var d=a[0].s;for(n=1;n<i;++n)a[n].s>d&&(d=a[n].s);var E=new v(d+1),g=Y(r[l-1],E,0);if(t<g){n=0;var h=0,f=g-t,_=1<<f;for(a.sort(function(e,t){return E[t.s]-E[e.s]||e.f-t.f});n<i;++n){var m=a[n].s;if(!(E[m]>t))break;h+=_-(1<<g-E[m]),E[m]=t}for(h>>=f;0<h;){var S=a[n].s;E[S]<t?h-=1<<t-E[S]++-1:++n}for(;0<=n&&h;--n){var T=a[n].s;E[T]==t&&(--E[T],++h)}g=t}return{t:new p(E),l:g}},Y=function(e,t,r){return-1==e.s?Math.max(Y(e.l,t,r+1),Y(e.r,t,r+1)):t[e.s]=r},q=function(e){for(var t=e.length;t&&!e[--t];);for(var r=new v(++t),n=0,i=e[0],a=1,o=function(e){r[n++]=e},s=1;s<=t;++s)if(e[s]==i&&s!=t)++a;else{if(!i&&2<a){for(;138<a;a-=138)o(32754);2<a&&(o(10<a?a-11<<5|28690:a-3<<5|12305),a=0)}else if(3<a){for(o(i),--a;6<a;a-=6)o(8304);2<a&&(o(a-3<<5|8208),a=0)}for(;a--;)o(i);a=1,i=e[s]}return{c:r.subarray(0,n),n:t}},z=function(e,t){for(var r=0,n=0;n<t.length;++n)r+=e[n]*t[n];return r},X=function(e,t,r){var n=r.length,i=W(t+2);e[i]=255&n,e[i+1]=n>>8,e[i+2]=255^e[i],e[i+3]=255^e[i+1];for(var a=0;a<n;++a)e[i+a+4]=r[a];return 8*(i+4+n)},J=function(e,t,r,n,i,a,o,s,c,l,u){K(t,u++,r),++i[256];for(var d=(r=H(i,15)).t,E=(r=r.l,(g=H(a,15)).t),g=g.l,h=(p=q(d)).c,p=p.n,f=(T=q(E)).c,T=T.n,I=new v(19),A=0;A<h.length;++A)++I[31&h[A]];for(A=0;A<f.length;++A)++I[31&f[A]];for(var b=(y=H(I,7)).t,y=y.l,O=19;4<O&&!b[S[O-1]];--O);var D=l+5<<3,N=z(i,w)+z(a,L)+o;if(i=z(i,d)+z(a,E)+o+14+3*O+z(I,b)+2*I[16]+3*I[17]+7*I[18],0<=c&&D<=N&&D<=i)return X(t,u,e.subarray(c,c+l));if(K(t,u,1+(i<N)),u+=2,i<N){var P=R(d,r,0),k=d,U=R(E,g,0),B=E,x=R(b,y,0);for(K(t,u,p-257),K(t,u+5,T-1),K(t,u+10,O-4),u+=14,A=0;A<O;++A)K(t,u+3*A,b[S[A]]);u+=3*O;for(var W=[h,f],F=0;F<2;++F){var V=W[F];for(A=0;A<V.length;++A){var j=31&V[A];K(t,u,x[j]),u+=b[j],15<j&&(K(t,u,V[A]>>5&127),u+=V[A]>>12)}}}else P=C,k=w,U=M,B=L;for(A=0;A<s;++A){var Y,J=n[A];255<J?(G(t,u,P[257+(j=J>>18&31)]),u+=k[j+257],7<j&&(K(t,u,J>>23&31),u+=_[j]),G(t,u,U[Y=31&J]),u+=B[Y],3<Y&&(G(t,u,J>>5&8191),u+=m[Y])):(G(t,u,P[J]),u+=k[J])}return G(t,u,P[256]),u+k[256]},Q=new f([65540,131080,131088,131104,262176,1048704,1048832,2114560,2117632]),$=new p(0);var Z="undefined"!=typeof TextEncoder&&new TextEncoder,ee="undefined"!=typeof TextDecoder&&new TextDecoder;try{ee.decode($,{stream:!0})}catch(kn){}function te(e){try{let n=e.replace(/-/g,"+").replace(/_/g,"/");for(;n.length%4;)n+="=";var t=atob(n),r=new Uint8Array(t.length);for(let e=0;e<t.length;e++)r[e]=t.charCodeAt(e);return function(e,t){var r;if(t){for(var n="",i=0;i<e.length;i+=16384)n+=String.fromCharCode.apply(null,e.subarray(i,i+16384));return n}return ee?ee.decode(e):(r=(t=function(e){for(var t="",r=0;;){var n=e[r++],i=(127<n)+(223<n)+(239<n);if(e.length<r+i)return{s:t,r:F(e,r-1)};i?3==i?(n=((15&n)<<18|(63&e[r++])<<12|(63&e[r++])<<6|63&e[r++])-65536,t+=String.fromCharCode(55296|n>>10,56320|1023&n)):t+=1&i?String.fromCharCode((31&n)<<6|63&e[r++]):String.fromCharCode((15&n)<<12|(63&e[r++])<<6|63&e[r++]):t+=String.fromCharCode(n)}}(e)).s,(n=t.r).length&&j(8),r)}(function(e,t){return function(e,t,r,n){var i=e.length,a=n?n.length:0;if(!i||t.f&&!t.l)return r||new p(0);function o(e){var t=r.length;t<e&&((t=new p(Math.max(2*t,e))).set(r),r=t)}var s=!r,c=s||2!=t.i,l=t.i,u=(s&&(r=new p(3*i)),t.f||0),d=t.p||0,E=t.b||0,g=t.l,h=t.d,v=t.m,f=t.n,T=8*i;do{if(!g){u=B(e,d,1);var A=B(e,d+1,3);if(d+=3,!A){var y=e[(K=W(d)+4)-4]|e[K-3]<<8;if(i<(C=K+y)){l&&j(0);break}c&&o(E+y),r.set(e.subarray(K,C),E),t.b=E+=y,t.p=d=8*C,t.f=u;continue}if(1==A)g=P,h=k,v=9,f=5;else if(2==A){y=B(e,d,31)+257;for(var O=B(e,d+10,15)+4,D=y+B(e,d+5,31)+1,N=(d+=14,new p(D)),w=new p(19),L=0;L<O;++L)w[S[L]]=B(e,d+3*L,7);d+=3*O;var C,M=(1<<(C=U(w)))-1,V=R(w,C,1);for(L=0;L<D;){var K,G=V[B(e,d,M)];if(d+=15&G,(K=G>>4)<16)N[L++]=K;else{var H=0,Y=0;for(16==K?(Y=3+B(e,d,3),d+=2,H=N[L-1]):17==K?(Y=3+B(e,d,7),d+=3):18==K&&(Y=11+B(e,d,127),d+=7);Y--;)N[L++]=H}}var q=N.subarray(0,y),z=N.subarray(y);v=U(q),f=U(z),g=R(q,v,1),h=R(z,f,1)}else j(1);if(T<d){l&&j(0);break}}c&&o(E+131072);for(var X=(1<<v)-1,J=(1<<f)-1,Q=d;;Q=d){var $=(H=g[x(e,d)&X])>>4;if(T<(d+=15&H)){l&&j(0);break}if(H||j(2),$<256)r[E++]=$;else{if(256==$){Q=d,g=null;break}var Z,ee=$-254,te=(264<$&&(Z=_[L=$-257],ee=B(e,d,(1<<Z)-1)+I[L],d+=Z),($=h[x(e,d)&J])>>4);if($||j(3),d+=15&$,z=b[te],3<te&&(Z=m[te],z+=x(e,d)&(1<<Z)-1,d+=Z),T<d){l&&j(0);break}c&&o(E+131072);var re=E+ee;if(E<z){var ne=a-z,ie=Math.min(z,re);for(ne+E<0&&j(3);E<ie;++E)r[E]=n[ne+E]}for(;E<re;++E)r[E]=r[E-z]}}t.l=g,t.p=Q,t.b=E,t.f=u,g&&(u=1,t.m=v,t.d=h,t.n=f)}while(!u);return E!=r.length&&s?F(r,0,E):r.subarray(0,E)}(e,{i:2},t&&t.out,t&&t.dictionary)}(r))}catch(e){return null}}function re(e){if("undefined"!=typeof document){var t=e+"=",r=document.cookie.split(";");for(let i=0;i<r.length;i++){var n=r[i].trim();if(0===n.indexOf(t)){n=n.substring(t.length);try{return decodeURIComponent(n)}catch(e){return n}}}}return null}let{SUBSCRIPTION_DETAILS_KEYS:Xt,USER_DATA_KEYS:Jt,ATTRIBUTE_KEYS:Qt,IDENTITY_MAP_KEYS:$t,SESSION_KEYS:Zt,SOURCE_KEYS:er,DEVICE_DATA_KEYS:tr}=Et;function ne(e){var t,r,n,i,a,o,s;return e&&(({domain:t,token:r,endpoint:n,keys:i,p256dh:a,auth:o}=Xt),s={},e[t]&&(s.domain=e[t]),e[r]&&(s.token=e[r]),e[n]&&("string"==typeof e[n]&&e[n].startsWith("h://")?s.endpoint=e[n].replace("h://","https://"):s.endpoint=e[n]),e[i]&&(s.keys={},e[i][a]&&(s.keys.p256dh=e[i][a]),e[i][o])&&(s.keys.auth=e[i][o]),s)}function ie(e){if(!e)return e;var{attributes:t,subscribedToOldSdk:r,deviceUuid:n,deviceAdded:i}=Jt;let{key:a,value:o,updated_at:s,level:c}=Qt;var l={};return e[t]&&(l.attributes=e[t].map(e=>{var t,r,n={};return e[a]&&(n.key=(t=e[a],(r=Bt.find(e=>e.moeName===t))?r.attributeName:t)),void 0!==e[o]&&(n.value=e[o]),void 0!==e[s]&&(n.updated_at=e[s]),void 0!==e[c]&&(n.level=e[c]),n})),void 0!==e[r]&&(l.subscribedToOldSdk=e[r]),e[n]&&(l.deviceUuid=e[n]),void 0!==e[i]&&(l.deviceAdded=e[i]),l}function ae(e){var t,r,n,i;return e&&(({userIdentities:t,previousIdentities:r,previousIdentitiesUpdatedTime:n}=$t),i={},e[t]&&(i.userIdentities=e[t]),e[r]&&(i.previousIdentities=e[r]),void 0!==e[n]&&(i.previousIdentitiesUpdatedTime=e[n]),i)}function oe(e){var t,r,n,i,a,o,s,c;return e&&(({sessionKey:t,sessionStartTime:r,sessionMaxTime:n,customIdentifiersToTrack:i,sessionExpiryTime:a,numberOfSessions:o,currentSource:s}=Zt),c={},e[t]&&(c.sessionKey=e[t]),e[r]&&(c.sessionStartTime=e[r]),void 0!==e[n]&&(c.sessionMaxTime=e[n]),e[i]&&(c.customIdentifiersToTrack=e[i]),void 0!==e[a]&&(c.sessionExpiryTime=e[a]),void 0!==e[o]&&(c.numberOfSessions=e[o]),e[s]&&(c.currentSource=(e=>{var t,r,n,i,a,o,s,c,l;return e&&(({source:t,medium:r,source_url:n,term:i,campaign_name:a,campaign_id:o,content:s,extra:c}=er),l={},e[t]&&(l.source=e[t]),e[r]&&(l.medium=e[r]),e[n]&&(l.source_url=e[n]),e[i]&&(l.term=e[i]),e[a]&&(l.campaign_name=e[a]),e[o]&&(l.campaign_id=e[o]),e[s]&&(l.content=e[s]),e[c]&&(l.extra=e[c]),l)})(e[s])),c)}class rr{static getCompressedKeyName(e){return Et.COOKIE_NAME_MAPPING[e]||e}static getOriginalName(e){return rr.REVERSE_COOKIE_NAME_MAPPING[e]||e}static getCookieVersion(e,t){if([Et.COOKIE_NAME_MAPPING[dt],Et.COOKIE_NAME_MAPPING[lt.HARD_ASK_STATUS],Et.COOKIE_NAME_MAPPING[lt.SOFT_ASK_STATUS],bt.UUID,Et.COOKIE_NAME_MAPPING[lt.OPT_IN_SHOWN_TIME],Et.COOKIE_NAME_MAPPING[lt.SDK_DISABLED]].includes(e))return 3;if(!Object.keys(Et.COOKIE_NAME_MAPPING).includes(e)&&Object.values(Et.COOKIE_NAME_MAPPING).includes(e))try{let i;try{if(i=JSON.parse(t),rr.hasV3Structure(i,e))return 3;if("string"==typeof i){var r=te(i);if(null!==r)try{return JSON.parse(r),3}catch(e){}}return 2}catch(e){var n=te(t);if(null!==n)try{return i=JSON.parse(n),3}catch(e){}return 2}}catch(e){return 2}return 1}static hasV3Structure(e,t){if(!e||"object"!=typeof e)return!1;switch(rr.getOriginalName(t)){case lt.SUBSCRIPTION_DETAILS:return e.e&&"string"==typeof e.e&&e.e.length<=2;case lt.USER_DATA:return e.d_uid||e.a&&!Array.isArray(e.a)||!e.hasOwnProperty("a");case lt.IDENTITY_MAP:return!e.hasOwnProperty("p_i")||!e.hasOwnProperty("p_i_u_t");case lt.SESSION:return e.s_s_t&&"number"==typeof e.s_s_t;default:return!1}}static getAllCookieNames(e){var t=[e],r=Et.COOKIE_NAME_MAPPING[e];return r&&r!==e&&t.push(r),t}static compressValue(e,t){if(null==e)return e;if("object"!=typeof e||Array.isArray(e))return"boolean"!=typeof e||t!==lt.SDK_DISABLED&&t!==dt?"string"==typeof e&&Object.keys(Et.PERMISSION_STATE_MAPPING).includes(e)?Et.PERMISSION_STATE_MAPPING[e]:e:e?1:0;if(null===(e=rr.compressObjectV3(e,t)))return null;var r=(e=>{try{var t=function(e){return function(e,t,r,n,i){var a,o;return i||(i={l:1},t.dictionary&&(a=t.dictionary.subarray(-32768),(o=new p(a.length+e.length)).set(a),o.set(e,a.length),e=o,i.w=a.length)),function(e,t,r,n,i,a){var o=a.z||e.length,s=new p(n+o+5*(1+Math.ceil(o/7e3))+i),c=s.subarray(n,s.length-i),l=a.l,u=7&(a.r||0);if(t){u&&(c[0]=a.r>>3);for(var d=(t=Q[t-1])>>13,E=8191&t,g=(1<<r)-1,h=a.p||new v(32768),S=a.h||new v(1+g),T=Math.ceil(r/3),I=2*T,b=function(t){return(e[t]^e[t+1]<<T^e[t+2]<<I)&g},O=new f(25e3),D=new v(288),N=new v(32),R=0,w=0,L=a.i||0,C=0,P=a.w||0,M=0;L+2<o;++L){var k=b(L),U=32767&L,B=S[k];if(h[U]=B,S[k]=U,P<=L){var x=o-L;if((7e3<R||24576<C)&&(423<x||!l)){u=J(e,c,0,O,D,N,w,C,M,L-M,u),C=R=w=0,M=L;for(var V=0;V<286;++V)D[V]=0;for(V=0;V<30;++V)N[V]=0}var j=2,K=0,G=E,H=U-B&32767;if(2<x&&k==b(L-H))for(var Y=Math.min(d,x)-1,q=Math.min(32767,L),z=Math.min(258,x);H<=q&&--G&&U!=B;){if(e[L+j]==e[L+j-H]){for(var $=0;$<z&&e[L+$]==e[L+$-H];++$);if(j<$){if(K=H,Y<(j=$))break;var Z=Math.min(H,$-2),ee=0;for(V=0;V<Z;++V){var te=L-H+V&32767,re=te-h[te]&32767;ee<re&&(ee=re,B=te)}}}H+=(U=B)-(B=h[U])&32767}K?(O[C++]=268435456|A[j]<<18|y[K],k=31&A[j],x=31&y[K],w+=_[k]+m[x],++D[257+k],++N[x],P=L+j,++R):(O[C++]=e[L],++D[e[L]])}}for(L=Math.max(L,P);L<o;++L)O[C++]=e[L],++D[e[L]];u=J(e,c,l,O,D,N,w,C,M,L-M,u),l||(a.r=7&u|c[u/8|0]<<3,u-=7,a.h=S,a.p=h,a.i=L,a.w=P)}else{for(L=a.w||0;L<o+l;L+=65535){var ne=L+65535;o<=ne&&(c[u/8|0]=l,ne=o),u=X(c,u+1,e.subarray(L,ne))}a.i=o}return F(s,0,n+W(u)+i)}(e,null==t.level?6:t.level,null==t.mem?i.l?Math.ceil(1.5*Math.max(8,Math.min(13,Math.log(e.length)))):20:12+t.mem,r,n,i)}(e,{},0,0)}(function(e){var t;if(Z)return Z.encode(e);var r=e.length,n=new p(e.length+(e.length>>1)),i=0,a=function(e){n[i++]=e};for(t=0;t<r;++t){i+5>n.length&&((o=new p(i+8+(r-t<<1))).set(n),n=o);var o=e.charCodeAt(t);o<128?a(o):(o<2048?a(192|o>>6):(55295<o&&o<57344?(a(240|(o=65536+(1047552&o)|1023&e.charCodeAt(++t))>>18),a(128|o>>12&63)):a(224|o>>12),a(128|o>>6&63)),a(128|63&o))}return F(n,0,i)}(e));let r="";for(let e=0;e<t.length;e++)r+=String.fromCharCode(t[e]);return btoa(r).replace(/\+/g,"-").replace(/\//g,"_").replace(/=/g,"")}catch(e){return null}})(t=JSON.stringify(e));if(null!==r){var n=encodeURIComponent(t).length;if(r.length<n&&te(r)===t)return r}return e}static decompressValue(e,t,r){if(null==e)return e;if(void 0===r&&(n=rr.getCompressedKeyName(t),r="string"==typeof e?rr.getCookieVersion(n,e):2),(3===r||void 0===r)&&"string"==typeof e){var n=te(e);if(null!==n)try{var i=JSON.parse(n);return rr.decompressObjectV3(i,t)}catch(t){r=2}}return 1===r&&rr.isLegacyValue(e)?"string"===e.MOE_DATA_TYPE?e.actualValue?String(e.actualValue):null:(e.MOE_DATA_TYPE,e.actualValue):"number"!=typeof e||0!==e&&1!==e||t!==lt.SDK_DISABLED&&t!==dt?"number"==typeof e&&0<=e&&e<=6&&(t===lt.SOFT_ASK_STATUS||t===lt.HARD_ASK_STATUS)?Object.keys(Et.PERMISSION_STATE_MAPPING).find(t=>Et.PERMISSION_STATE_MAPPING[t]===e):"object"!=typeof e||Array.isArray(e)?e:void 0!==r&&2!==r||(n=rr.getCompressedKeyName(t),!rr.hasV3Structure(e,n))?3===r?rr.decompressObjectV3(e,t):rr.decompressObject(e,t):rr.decompressObjectV3(e,t):1===e}static compressObjectV3(e,t){if(!e)return e;switch(t){case lt.SUBSCRIPTION_DETAILS:return rr.compressSubscriptionDetailsV3(e);case lt.USER_DATA:return rr.compressUserDataV3(e);case lt.IDENTITY_MAP:return rr.compressIdentityMapV3(e);case lt.SESSION:return rr.compressSessionV3(e);case lt.DEVICE_DATA:return null;default:return e}}static compressSubscriptionDetailsV3(e){var t,r,n,i,a,o,s=e&&(({domain:s,token:o,endpoint:t,keys:r,p256dh:n,auth:i}=Xt),a={},e.domain&&(a[s]=e.domain),e.token&&(a[o]=e.token),e.endpoint&&(a[t]=e.endpoint),e.keys&&(a[r]={},e.keys.p256dh&&(a[r][n]=e.keys.p256dh),e.keys.auth)&&(a[r][i]=e.keys.auth),a);return s.e&&"string"==typeof s.e&&(o=Et.ENDPOINT_URL_MAPPING[s.e])&&(s.e=o),s}static compressUserDataV3(e){var t;if(e=function(e){if(!e)return e;var{attributes:t,subscribedToOldSdk:r,deviceUuid:n,deviceAdded:i}=Jt;let{key:a,value:o,updated_at:s,level:c}=Qt;var l={};return e.attributes&&(l[t]=e.attributes.map(e=>{var t,r,n={};return e.key&&(n[a]=(t=e.key,(r=Bt.find(e=>e.attributeName===t))?r.moeName:t)),void 0!==e.value&&(n[o]=e.value),void 0!==e.updated_at&&(n[s]=e.updated_at),void 0!==e.level&&(n[c]=e.level),n})),void 0!==e.subscribedToOldSdk&&(l[r]=e.subscribedToOldSdk),e.deviceUuid&&(l[n]=e.deviceUuid),void 0!==e.deviceAdded&&(l[i]=e.deviceAdded),l}(e),e.d_uid||(t=rr.getDeviceDataForMigration())&&t.deviceUniqueId&&(e.d_uid=t.deviceUniqueId),e.d_id&&delete e.d_id,e.a&&Array.isArray(e.a)&&0===e.a.length&&delete e.a,e.a&&Array.isArray(e.a)&&0<e.a.length){let t={};e.a.forEach(e=>{var r;e.k&&void 0!==e.v&&(r=e.l?e.k+"_p_attr":e.k,t[r]={v:e.v,u_at:e.u_at,l:e.l||void 0})}),e.a=t}return e}static compressIdentityMapV3(e){var t,r,n,i=e&&(({userIdentities:i,previousIdentities:t,previousIdentitiesUpdatedTime:r}=$t),n={},e.userIdentities&&(n[i]=e.userIdentities),e.previousIdentities&&(n[t]=e.previousIdentities),void 0!==e.previousIdentitiesUpdatedTime&&(n[r]=e.previousIdentitiesUpdatedTime),n);return i.p_i&&0!==Object.keys(i.p_i).length||0!==i.p_i_u_t||(delete i.p_i,delete i.p_i_u_t),i}static compressSessionV3(e){var t;return e=function(e){var t,r,n,i,a,o,s,c;return e&&(({sessionKey:t,sessionStartTime:r,sessionMaxTime:n,customIdentifiersToTrack:i,sessionExpiryTime:a,numberOfSessions:o,currentSource:s}=Zt),c={},e.sessionKey&&(c[t]=e.sessionKey),e.sessionStartTime&&(c[r]=e.sessionStartTime),void 0!==e.sessionMaxTime&&(c[n]=e.sessionMaxTime),e.customIdentifiersToTrack&&(c[i]=e.customIdentifiersToTrack),void 0!==e.sessionExpiryTime&&(c[a]=e.sessionExpiryTime),void 0!==e.numberOfSessions&&(c[o]=e.numberOfSessions),e.currentSource&&(c[s]=(e=>{var t,r,n,i,a,o,s,c,l;return e&&(({source:t,medium:r,source_url:n,term:i,campaign_name:a,campaign_id:o,content:s,extra:c}=er),l={},e.source&&(l[t]=e.source),e.medium&&(l[r]=e.medium),e.source_url&&(l[n]=e.source_url),e.term&&(l[i]=e.term),e.campaign_name&&(l[a]=e.campaign_name),e.campaign_id&&(l[o]=e.campaign_id),e.content&&(l[s]=e.content),e.extra&&(l[c]=e.extra),l)})(e.currentSource)),c)}(e),e.s_s_t&&"string"==typeof e.s_s_t&&(t=new Date(e.s_s_t).getTime(),e.s_s_t=t),e}static decompressObject(e,t){if(!e)return e;switch(t){case lt.SUBSCRIPTION_DETAILS:return ne(e);case lt.USER_DATA:return ie(e);case lt.IDENTITY_MAP:return ae(e);case lt.SESSION:return oe(e);case lt.DEVICE_DATA:return(r=e)&&(i={},r[n=tr.deviceUniqueId]&&(i.deviceUniqueId=r[n]),i);default:return e}var r,n,i}static decompressObjectV3(e,t){if(!e)return e;switch(t){case lt.SUBSCRIPTION_DETAILS:return rr.decompressSubscriptionDetailsV3(e);case lt.USER_DATA:return rr.decompressUserDataV3(e);case lt.IDENTITY_MAP:return rr.decompressIdentityMapV3(e);case lt.SESSION:return rr.decompressSessionV3(e);case lt.DEVICE_DATA:return rr.getDeviceDataFromUserData();default:return e}}static decompressSubscriptionDetailsV3(e){var t;return(e=Object.assign({},e)).e&&"string"==typeof e.e&&(t=rr.REVERSE_ENDPOINT_URL_MAPPING[e.e])&&(e.e=t),ne(e)}static decompressUserDataV3(e,t){var r=!(e=Object.assign({},e)).hasOwnProperty("a"),n=(e.a&&"object"==typeof e.a&&!Array.isArray(e.a)&&(n=Object.entries(e.a).map(([e,t])=>{var r=void 0!==t.l,n=e.endsWith("_p_attr");return{k:r&&n?e.slice(0,-7):e,v:t.v,u_at:t.u_at||(new Date).getTime(),l:t.l||void 0}}),e.a=n),r&&(e.a=[]),ie(e));return n.deviceUuid||(r=re("moe_uuid"))&&(n.deviceUuid=r),n}static decompressIdentityMapV3(e){return(e=Object.assign({},e)).hasOwnProperty("p_i")||(e.p_i={}),e.hasOwnProperty("p_i_u_t")||(e.p_i_u_t=0),ae(e)}static decompressSessionV3(e){return(e=Object.assign({},e)).s_s_t&&"number"==typeof e.s_s_t&&(e.s_s_t=new Date(e.s_s_t).toISOString()),oe(e)}static getDeviceDataForMigration(){if("undefined"!=typeof localStorage)try{var e=localStorage.getItem("MOE_DATA");if(e){var t=JSON.parse(e);if(t&&t.DEVICE_DATA&&t.DEVICE_DATA.deviceUniqueId)return t.DEVICE_DATA}}catch(e){}return null}static getDeviceDataFromUserData(){var e;for(e of rr.getAllCookieNames(lt.USER_DATA)){var t,r=re(e);if(null!==r)try{let e=JSON.parse(r);if((e="string"==typeof e&&null!==(t=te(e))?JSON.parse(t):e).d_uid)return{deviceUniqueId:e.d_uid};var n=rr.decompressUserDataV3(e);if(n.deviceUuid)return{deviceUniqueId:n.deviceUuid}}catch(e){continue}}return null}static isCompressedCookie(e){return e.startsWith("moe_")&&Object.values(Et.COOKIE_NAME_MAPPING).includes(e)}static isLegacyValue(e){return"object"==typeof e&&null!==e&&e.hasOwnProperty("MOE_DATA_TYPE")&&e.hasOwnProperty("actualValue")}}rr.REVERSE_ENDPOINT_URL_MAPPING=Object.fromEntries(Object.entries(Et.ENDPOINT_URL_MAPPING).map(([e,t])=>[t,e])),rr.REVERSE_COOKIE_NAME_MAPPING=Object.fromEntries(Object.entries(Et.COOKIE_NAME_MAPPING).map(([e,t])=>[t,e]));class nr{static set(e,t){if(null==(r=qt.get())||!r.disableCookies){var r=nr.baseTag+".set";if(null==t)nr.remove(e);else if(e===lt.PUSH_TOKEN)Kt.log(2,r,"Skipping PUSH_TOKEN as it is redundant with SUBSCRIPTION_DETAILS");else if(e!==lt.DEVICE_DATA){let n;r=rr.compressValue(t,e),t=rr.getCompressedKeyName(e),nr.cleanupOldVersions(e,t),n="string"==typeof r?r:"object"==typeof r&&null!==r?JSON.stringify(r):String(r),e=Date.now(),r=";expires="+new Date(e+31536e6*ut.SESSION_COOKIE.EXPIRY_YEARS).toUTCString(),document.cookie=t+"="+encodeURIComponent(n)+r+";domain="+nr.getOrigin()+";path=/;SameSite=None; Secure"}}}static get(e){var t,r;if(null==(r=qt.get())||!r.disableCookies){let n=null,i=null,a=1;for(t of rr.getAllCookieNames(e))if(null!==(n=nr.getCookieValue(t))){i=t,a=rr.getCookieVersion(t,n);break}return null===n?null:(r=nr.processParseValue(n,e,1<a,a),i&&a<3&&nr.migrateToV3(e,r,i),r)}}static migrateToV3(e,t,r){var n=nr.baseTag+".migrateToV3";try{nr.set(e,t),nr.removeSpecificCookie(r)}catch(e){Kt.error(2,n,`Failed to migrate cookie ${r} to V3:`,e)}}static cleanupOldVersions(e,t){rr.getAllCookieNames(e).forEach(e=>{var t=nr.getCookieValue(e);null!==t&&rr.getCookieVersion(e,t)<3&&nr.removeSpecificCookie(e)})}static removeSpecificCookie(e){document.cookie=e+"=;domain="+nr.getOrigin()+";path=/;expires=Thu, 01 Jan 1970 00:00:01 GMT;"}static getCookieValue(e){var t=e+"=",r=nr.getDecodedCookies();for(let e=r.length-1;0<=e;e--){let n=r[e];for(;" "===n.charAt(0);)n=n.substring(1);if(0===n.indexOf(t))return n.substring(t.length,n.length)}return null}static processParseValue(e,t,r,n){var i="MOE_DATA_TYPE",a="actualValue";try{let o;try{o=JSON.parse(e)}catch(t){o=e}rr.isLegacyValue(o)?"string"===l(o,i,null)?e=(e=l(o,a,null))?String(e):null:"boolean"===l(o,i,null)&&(e=l(o,a,null)):e=r?rr.decompressValue(o,t,n):o}catch(t){}return e}static remove(e){var t;null!=(t=qt.get())&&t.disableCookies||rr.getAllCookieNames(e).forEach(e=>{nr.removeSpecificCookie(e)})}static setRaw(e,t,r){var n;if(null==(n=qt.get())||!n.disableCookies)if(null==t)nr.remove(e);else{let n="";null!=r&&(n=";expires="+r.toISOString()),document.cookie=e+"="+encodeURIComponent(t)+n+";domain="+nr.getOrigin()+";path=/;"}}static getOrigin(){if(null==(e=qt.get())||!e.disableCookies){var e=nr.baseTag+".getOrigin";let t=window.location.origin;return t=t.indexOf(".")!==t.lastIndexOf(".")?t.substring(t.indexOf(".")):"."+t.substring(t.lastIndexOf("/")+1),"localhost"===window.location.hostname&&(Kt.warn(1,e,"Cross domain user persitence will not work with localhost. \n\nWe will save the key-value pairs in the localhost cookie store for reference. You'll be able to test this functionality in a hosted staging/test environment."),t=""),t}}static getDecodedCookies(){let e=nr.baseTag+".getDecodedCookies";return document.cookie.split(";").map(t=>{let r=t.trim();"%"===r.slice(-1)&&(r+="25");try{return decodeURIComponent(r)}catch(t){return Kt.error(2,e,"Error decoding cookie:",r,t),r}})}}nr.baseTag="CookieStorage";let ir="MOE_DATA";class ar{static setPrefix(e){ar.prefix=e+"_"}static set(e,t){ar.baseLogTag,e=ar.prefix+e,localStorage&&((n=ar.getMoeData())[e]=t,localStorage.setItem(ir,JSON.stringify(n)));var r,n=ar.KEYS_SHARED_WITH_COOKIE.indexOf(e);ar.isSharedWithCookie&&0<=n&&(r="object"!=typeof t||Array.isArray(t)?t:Object.assign({},t),0===n&&Array.isArray(r.attributes)&&(r.attributes=r.attributes.filter(e=>!!this.isPushBillingOrIdentityAttribute(e.key))),e===lt.SUBSCRIPTION_DETAILS&&(r.domain=t.domain,r.token=t.token,r.endpoint=t.endpoint,r.keys=t.keys),nr.set(e,r))}static get(e){return ar.baseLogTag,e=ar.prefix+e,localStorage?l(ar.getMoeData(),e,null):null}static remove(e){var t,r=ar.baseLogTag+".remove",n=ar.prefix+e;localStorage&&null!=ar.get(e)&&(delete(t=ar.getMoeData())[n],localStorage.setItem(ir,JSON.stringify(t)),Kt.log(2,r,"Key",e,"removed.")),ar.isSharedWithCookie&&0<=ar.KEYS_SHARED_WITH_COOKIE.indexOf(e)&&nr.remove(e)}static logout(){var e,t,r=["INIT_DATA","Q","WEB_SETTINGS","SUBSCRIPTION_DETAILS","PUSH_TOKEN","GRACEFUL_DATA","DEVICE_DATA","SDK_VERSION","SDK_DISABLED"];for(e in lt)r.indexOf(e)<0&&ar.remove(lt[e]);for(t in lt.Q)zt.purge(t)}static getString(e){if(e=ar.prefix+e,localStorage)return"string"==typeof(e=ar.get(e))||e instanceof String?e:JSON.stringify(e)}static removePrefix(){ar.prefix=""}static copyKeysFromCookie(){let e=null;for(let n=0;n<ar.KEYS_SHARED_WITH_COOKIE.length;n++){var t=ar.KEYS_SHARED_WITH_COOKIE[n],r=nr.get(t);if(null!=r){let n="object"!=typeof r||Array.isArray(r)?r:Object.assign({},r);if(t===lt.USER_DATA){if(r=ar.get(t)&&ar.get(t).attributes,Array.isArray(n.attributes)&&Array.isArray(r)&&0<r.length){let e=[...r];n.attributes.forEach(t=>{var r=e.findIndex(e=>e.key===t.key&&e.level===t.level);0<=r?e[r]=t:e.push(t)}),e=e.filter(e=>!(this.isPushBillingOrIdentityAttribute(e.key)&&n.attributes.findIndex(t=>t.key===e.key&&t.level===e.level)<0)),n.attributes=e}n.d_uid&&(e={deviceUniqueId:n.d_uid},delete n.d_uid)}else t===lt.DEVICE_DATA&&(e=n);ar.set(t,n)}}e&&ar.set(lt.DEVICE_DATA,e),nr.get(lt.PUSH_TOKEN)&&nr.remove(lt.PUSH_TOKEN),ar.removeStaleKeysFromLS(),ar.copyIdentitiesFromCookiesToIDB()}static isPushBillingOrIdentityAttribute(e){var t=ar.get(lt.WEB_SETTINGS),r=(null==(r=null==t?void 0:t.configs)?void 0:r.identityAttributes)||[],n=(null==(n=null==t?void 0:t.configs)?void 0:n.subscriberBasedBillingAttributes)||[];return!!(null!=t&&t.isPushSubBilling&&h(e,n)||vt.includes(e)||r.includes((null==(t=Bt.find(t=>t.attributeName===e))?void 0:t.moeName)||e))}static copyIdentitiesFromCookiesToIDB(){var e,t,r=this.baseLogTag+".copyIdentitiesFromCookiesToIDB",n=nr.get(lt.IDENTITY_MAP),i=nr.get(lt.USER_DATA),a={};null!=n&&n.userIdentities&&(({userIdentities:n,previousIdentities:e,previousIdentitiesUpdatedTime:t}=n),a.userIdentities=n,a.previousIdentities=e,a.previousIdentitiesUpdatedTime=t),null!=(n=null==i?void 0:i.attributes)&&n.length&&i.attributes.find(e=>e.key===pt.ID)&&(a.moe_user_id=i.attributes.find(e=>e.key===pt.ID).value),null!=(e=this.moeDataStore)&&e.getItem||(this.moeDataStore=E.createInstance({driver:[E.INDEXEDDB],name:"moe_database",storeName:"moe_data"}),this.moeDataStore&&(this.moeDataStore.setItem(Wt,a),Kt.log(2,r,"Copied identities from cookie to IndexedDB")))}static removeStaleKeysFromLS(){var e=ar.baseLogTag+".removeStaleKeysFromLS";try{Object.keys(ar.getMoeData()).forEach(e=>{var t=nr.get(e);!this.KEYS_SHARED_WITH_COOKIE.includes(e)||Ft.includes(e)||t||!1===t||ar.remove(e)})}catch(t){Kt.error(1,e,t)}}static getMoeData(){var e=ar.baseLogTag+".getMoeData",t=localStorage.getItem(ir);if(null==t)return{};try{return JSON.parse(t)}catch(t){return Kt.error(1,e,t),{}}}}ar.baseLogTag="PersistentStorage",ar.prefix="",ar.isSharedWithCookie=!1,ar.KEYS_SHARED_WITH_COOKIE=[lt.USER_DATA,lt.SUBSCRIPTION_DETAILS,lt.SOFT_ASK_STATUS,lt.OPT_IN_SHOWN_TIME,lt.HARD_ASK_STATUS,lt.SESSION,lt.DEVICE_DATA,lt.IDENTITY_MAP,lt.SDK_DISABLED];class or{constructor(e,t){this.key=e,this.value=t,this.updated_at=(new Date).getTime()}static equal(e,t){return e.key===t.key&&JSON.stringify(e.value)===JSON.stringify(t.value)}}class sr{constructor(e,t,r=!0){this.name=e,this.attributes=t,r&&this.attributes.push(new or(ze.URL,location.href))}}class cr{constructor(e){var t;this.experiences=null==(t=null==e?void 0:e.experiences)?void 0:t.map(e=>new lr(e)),this.user_in_gcg=e&&e.user_in_gcg,this.personalization_used=null==e?void 0:e.personalization_used,this.split_experiences=(null==e?void 0:e.split_experiences)||[]}}cr.baseLogTag="CampaignDataModel";class lr{constructor(e){this.delivery=l(e,"delivery",{}),this.url=l(e,"url",""),this.id=l(e,"id",""),this.gcg_enabled=l(e,"gcg_enabled"),this.expiry_time=l(e,"expiry_time"),this.updated_time=l(e,"updated_time"),this.context=l(e,"context",{}),this.payload=l(e,"payload",[]),this.name=l(e,"name",""),this.status=l(e,"status",""),this.in_session_behaviour_segment=l(e,"in_session_behaviour_segment"),this.url_filters=l(e,"url_filters"),this.is_ai=l(e,"is_ai"),this.page_attributes=l(e,"page_attributes"),this.tab_list=l(e,"tab_list")}}(c=i=i||{}).AND="and",c.OR="or",(T=a=a||{}).BOOL="bool",T.STRING="string",T.DATE="datetime",T.NUMBER="double",T.LONG="long",T.ARRAY_BOOL="array_bool",T.ARRAY_NUMBER="array_double",T.ARRAY_STRING="array_string",T.ARRAY_DATETIME="array_datetime",(c=o=o||{}).EQ="is",c.LT="lessThan",c.GT="greaterThan",c.BETWEEN="between",c.IN="in",c.EXISTS="exists",c.CONTAINS="contains",c.STARTSWITH="startsWith",c.ENDSWITH="endsWith",c.INTHELAST="inTheLast",c.INTHENEXT="inTheNext",c.AFTER="after",c.BEFORE="before",c.ON="on",c.TODAY="today",(T=s=s||{}).ALLOF="all_of",T.ANYOFF="any_of";class ur{}ur.REMOVE_TRAIL_CHARS=/[^\w\s]+$/gi;class dr{constructor(e,t,r,n){this.dataType=e,this.availableOperations=t,this.event=r,this.filter=n}validate(){return!(this.availableOperations.indexOf(this.filter.operator)<0)}checkEq(){let e=!1,t=(t,r)=>{this.dataType===a.STRING&&typeof t===a.STRING&&(t=this.removeSpecialChars(t),r=this.removeSpecialChars(r)),(this.dataType!==a.STRING||this.filter.case_sensitive||t.toLowerCase()!==r.toLowerCase())&&t!==r||(e=!0)};var r;return this.event?this.event.attributes.forEach(e=>{e.key===this.filter.name&&t(e.value,this.filter.value)}):(r=this.getPageContextObjectValue(this.filter.name),t(r,this.filter.value)),e}checkExists(){let e=!1;return this.event?this.event.attributes.forEach(t=>{t.key===this.filter.name&&(e=!0)}):this.getPageContextObjectValue(this.filter.name)&&(e=!0),e}removeSpecialChars(e){return e.replace(ur.REMOVE_TRAIL_CHARS,"")}getPageContextObjectValue(e){var t;e=e.split(".");let r=We();for(t of e)r=r[t];return r}}let Er={isBoolean:e=>"boolean"==typeof e,isNumber:e=>"number"==typeof e,isString:e=>"string"==typeof e,isNumeric:e=>"number"==typeof e||"string"==typeof e&&Number(e).toString()===e,isDate:e=>"[object Date]"===Object.prototype.toString.call(e),isArray:e=>Array.isArray(e)},gr=[o.EQ,o.EXISTS,o.CONTAINS,o.STARTSWITH,o.ENDSWITH,o.IN];class hr extends dr{constructor(e,t){super(a.STRING,gr,e,t),this.event||(this.value=this.getPageContextObjectValue(t.name))}evaluate(){var e;hr.baseLogTag;let t=!1;if(this.event&&(e=this.event.attributes.filter(e=>e.key===this.filter.name),this.value=0<e.length?e[0].value:null),null!=this.value&&Er.isString(this.value))switch(this.filter.operator){case o.EQ:t=this.checkEq();break;case o.EXISTS:t=this.checkExists();break;case o.CONTAINS:t=this.checkContains();break;case o.STARTSWITH:t=this.checkStartsWith();break;case o.ENDSWITH:t=this.checkEndsWith();break;case o.IN:t=this.checkIn()}return this.filter.negate?!t:t}checkContains(){return this.event,this.filter.case_sensitive?0<=this.value.indexOf(this.filter.value):0<=this.value.toLowerCase().indexOf(this.filter.value.toLowerCase())}checkStartsWith(){var e=(e,t)=>e.substr(0,t.length)===t;return this.filter.case_sensitive?e(this.value,this.filter.value):e(this.value.toLowerCase(),this.filter.value.toLowerCase())}checkEndsWith(){var e,t,r=(e,t,r)=>((void 0===r||r>e.length)&&(r=e.length),e.substring(r-t.length,r)===t);return this.filter.case_sensitive?r(this.value,this.filter.value):(e=this.removeSpecialChars(this.value),t=this.removeSpecialChars(this.filter.value),r(e.toLowerCase(),t.toLowerCase()))}checkIn(){let e=!1;if(Array.isArray(this.filter.value))for(let t=this.filter.value.length-1;0<=t;t--)if(this.filter.case_sensitive){if(this.filter.value[t]===this.value){e=!0;break}}else if(this.filter.value[t].toLowerCase()===this.value.toLowerCase()){e=!0;break}return e}}hr.baseLogTag="StringDataType";let pr=[o.EQ,o.EXISTS];class vr extends dr{constructor(e,t){super(a.BOOL,pr,e,t)}evaluate(){let e=!1;switch(this.filter.operator){case o.EQ:e=this.checkEq();break;case o.EXISTS:e=this.checkExists()}return this.filter.negate?!e:e}}vr.baseLogTag="BooleanDataType";let fr=[o.EXISTS,o.ON,o.BETWEEN,o.BEFORE,o.AFTER,o.INTHELAST,o.INTHENEXT,o.TODAY];class _r extends dr{constructor(e,t){!Er.isDate(t.value)&&Er.isString(t.value)&&(t.value=new Date(t.value.split("Z").join(""))),!Er.isDate(t.value2)&&Er.isString(t.value2)&&null!=t.value2&&(t.value2=new Date(t.value2.split("Z").join(""))),!Er.isDate(t.value1)&&Er.isString(t.value1)&&null!=t.value1&&(t.value1=new Date(t.value1.split("Z").join(""))),super(a.DATE,fr,e,t)}evaluate(){_r.baseLogTag;let e=!1;var t=this.event.attributes.filter(e=>e.key===this.filter.name),r=0<t.length?t[0]:null;if(null!=r)switch(r.value.setHours(0,0,0,0),this.filter.operator){case o.EQ:e=this.checkEq();break;case o.EXISTS:e=this.checkExists();break;case o.ON:e=this.checkOn(r);break;case o.BETWEEN:e=this.checkBetween(r);break;case o.BEFORE:e=this.checkBefore(r);break;case o.AFTER:e=this.checkAfter(r);break;case o.INTHELAST:e=this.checkLastX(r);break;case o.INTHENEXT:e=this.checkNextX(r);break;case o.TODAY:e=this.checkToday(r)}return this.filter.negate?!e:e}checkOn(e){return e.value.setHours(0,0,0,0)===this.filter.value.setHours(0,0,0,0)}checkBetween(e){return this.filter.value2?this.filter.value.getTime()<=e.value.getTime()&&e.value.getTime()<this.filter.value2.getTime():this.filter.value.getTime()<=e.value.getTime()&&e.value.getTime()<this.filter.value1.getTime()}checkBefore(e){var{value:t}=this.filter;return typeof t===Je.NUMBER?((new Date).setHours(0,0,0,0)-e.value.setHours(0,0,0,0))/864e5>t:e.value.setHours(0,0,0,0)<t.setHours(0,0,0,0)}checkAfter(e){var{value:t}=this.filter;return typeof t===Je.NUMBER?(e.value.setHours(0,0,0,0)-(new Date).setHours(0,0,0,0))/864e5>t:e.value.setHours(0,0,0,0)>t.setHours(0,0,0,0)}checkLastX(e){var t=(new Date).setHours(0,0,0,0);return 0<t-(e=e.value.setHours(0,0,0,0))&&(t-e)/864e5<=this.filter.value}checkNextX(e){var t=(new Date).setHours(0,0,0,0);return 0<(e=e.value.setHours(0,0,0,0))-t&&(e-t)/864e5<=this.filter.value}checkToday(e){return e.value.setHours(0,0,0,0)===(new Date).setHours(0,0,0,0)}}_r.baseLogTag="DateTimeDataType";let mr=[o.EQ,o.EXISTS,o.GT,o.LT,o.BETWEEN,o.IN];class Sr extends dr{constructor(e,t){super(a.NUMBER,mr,e,t),this.event||(this.value=this.getPageContextObjectValue(t.name))}evaluate(){var e;Sr.baseLogTag;let t=!1;if(this.event&&(e=this.event.attributes.filter(e=>e.key===this.filter.name),this.value=0<e.length?e[0].value:null),null!=this.value&&"number"==typeof this.value)switch(this.filter.operator){case o.EQ:t=this.checkEq();break;case o.EXISTS:t=this.checkExists();break;case o.GT:t=this.checkGreaterThan();break;case o.LT:t=this.checkLessThan();break;case o.BETWEEN:t=this.checkBetween();break;case o.IN:t=this.checkIn()}return this.filter.negate?!t:t}checkGreaterThan(){return this.value>this.filter.value}checkLessThan(){return this.value<this.filter.value}checkBetween(){return this.filter.value2?this.filter.value&&this.filter.value2&&this.filter.value<=this.value&&this.value<this.filter.value2:this.filter.value&&this.filter.value1&&this.filter.value<=this.value&&this.value<this.filter.value1}checkIn(){return Array.isArray(this.filter.value)&&0<=this.filter.value.indexOf(this.value)}}Sr.baseLogTag="NumberDataType";let Tr=[o.EQ,o.EXISTS,o.CONTAINS,o.STARTSWITH,o.ENDSWITH,o.IN,o.LT,o.GT,o.BETWEEN,o.INTHELAST,o.INTHENEXT,o.AFTER,o.BEFORE,o.ON,o.TODAY];class Ir extends dr{constructor(e,t){super(t.data_type,Tr,e,t)}evaluate(){var e=this.event.attributes.filter(e=>e.key===this.filter.name);return!(null==(e=0<e.length?e[0]:null)||!Er.isArray(e.value))&&(this.filter.array_filter_type&&this.filter.array_filter_type===s.ANYOFF?this.checkAnyOf(e):this.checkAllOf(e))}checkAllOf(e){return e.value.every(t=>this.getFilterResult(t,e))}checkAnyOf(e){return e.value.some(t=>this.getFilterResult(t,e))}getFilterResult(e,t){return t=this.createCustomEvent(t.key,e),!!(e=this.getDataType(t)).validate()&&e.evaluate()}createCustomEvent(e,t){return e=new or(e,t),new sr(this.event.name,[e])}getDataType(e){let t;switch(this.filter.data_type){case a.ARRAY_BOOL:t=new vr(e,this.filter);break;case a.ARRAY_DATETIME:t=new _r(e,this.filter);break;case a.ARRAY_NUMBER:t=new Sr(e,this.filter);break;case a.ARRAY_STRING:t=new hr(e,this.filter)}return t}}class Ar{static doesEventMatchFilters(e,t){Ar.baseLogTag;let r=!1,n=null;switch(t.data_type){case a.BOOL:(n=new vr(e,t)).validate()&&(r=n.evaluate());break;case a.STRING:(n=new hr(e,t)).validate()&&(r=n.evaluate());break;case a.NUMBER:case a.LONG:(n=new Sr(e,t)).validate()&&(r=n.evaluate());break;case a.DATE:(n=new _r(e,t)).validate()&&(r=n.evaluate());break;case a.ARRAY_STRING:case a.ARRAY_DATETIME:case a.ARRAY_BOOL:case a.ARRAY_NUMBER:(n=new Ir(e,t)).validate()&&(r=n.evaluate())}return r}static doesValueMatchFilter(e,t){return e=new or(t.name,e),e=new sr("sample event",[e]),Ar.doesEventMatchFilters(e,t)}}Ar.baseLogTag="TriggerEvaluator";let br=e=>l(e,"url_filters.filters",[]);var se=r(414),ce=function(e,t,r,n){return new(r=r||Promise)(function(i,a){function o(e){try{c(n.next(e))}catch(e){a(e)}}function s(e){try{c(n.throw(e))}catch(e){a(e)}}function c(e){var t;e.done?i(e.value):((t=e.value)instanceof r?t:new r(function(e){e(t)})).then(o,s)}c((n=n.apply(e,t||[])).next())})};let yr=e=>ce(void 0,void 0,void 0,function*(){var t;Or(t=e).length&&(t=(e=>{let t=[];return e.forEach(e=>{var r;(null===(r=null==e?void 0:e.in_session_behaviour_segment)||void 0===r?void 0:r.included_filters)&&(t=t.concat(e.in_session_behaviour_segment.included_filters.filters[0].action_name))}),t})(e),Yt.inSessionStore.setItem(ot.IN_SESSION.IN_SESSION_EVENTS,t))}),Or=e=>e.filter(e=>!!e.in_session_behaviour_segment),Dr=()=>ce(void 0,void 0,void 0,function*(){return Yt&&Yt.inSessionStore?new Promise((e,t)=>ce(void 0,void 0,void 0,function*(){var t=yield Yt.inSessionStore.getItem(ot.IN_SESSION.IN_SESSION_EVENTS_HISTORY);e(t||[])})):[]});var le=function(e,t,r,n){return new(r=r||Promise)(function(i,a){function o(e){try{c(n.next(e))}catch(e){a(e)}}function s(e){try{c(n.throw(e))}catch(e){a(e)}}function c(e){var t;e.done?i(e.value):((t=e.value)instanceof r?t:new r(function(e){e(t)})).then(o,s)}c((n=n.apply(e,t||[])).next())})};function ue(e){return le(this,void 0,void 0,function*(){var t=l(e,"in_session_behaviour_segment.included_filters.filters",[]),r=l(e,"in_session_behaviour_segment.included_filters.filter_operator","and");if(!(yield function(e,t){return le(this,void 0,void 0,function*(){return new Promise((r,n)=>le(this,void 0,void 0,function*(){var{count:n,type:i}=e,a=yield Rr(t);let o;switch(i){case"exactly":o=a===n;break;case"atleast":o=n<=a;break;case"atmost":o=a<=n}r(o)}))})}(t[0].execution,t[0].action_name)))return!1;let n=yield de(t[0]);if(1<t.length)for(let e=0;e<t.length;e++)if(r===i.AND){if(0==(n=!(!n||!(yield de(t[e])))))break}else if(r===i.OR&&1==(n=!(!n&&!(yield de(t[e])))))break;return n})}function de(e){return le(this,void 0,void 0,function*(){var t=l(e,"attributes.filters",[]);let r=!0;if(t&&0<t.length){let o=yield Nr(e.action_name);var n=l(e,"attributes.filter_operator","and"),a=t.map(e=>!!o.find(t=>Ar.doesEventMatchFilters(t,e)));r=a[0];for(let e=1;e<a.length;e++)if(n===i.AND){if(!1===(r=r&&a[e]))break}else if(n===i.OR&&!0===(r=r||a[e]))break}return r})}let Nr=e=>le(void 0,void 0,void 0,function*(){return(yield Dr()).filter(t=>e===t.name)}),Rr=e=>le(void 0,void 0,void 0,function*(){var t=yield Dr();let r=0;return t.forEach(t=>{t.name===e&&r++}),r});var Ee=function(e,t,r,n){return new(r=r||Promise)(function(i,a){function o(e){try{c(n.next(e))}catch(e){a(e)}}function s(e){try{c(n.throw(e))}catch(e){a(e)}}function c(e){var t;e.done?i(e.value):((t=e.value)instanceof r?t:new r(function(e){e(t)})).then(o,s)}c((n=n.apply(e,t||[])).next())})};function ge(e){return Ee(this,void 0,void 0,function*(){return yield function(e,t){return Ee(this,void 0,void 0,function*(){if(!window[rt.PAGE_CONTEXT])return!1;let r=!0;if(e&&0<e.length){var n=e.map(e=>Ar.doesEventMatchFilters(void 0,e));r=n[0];for(let e=1;e<n.length;e++)if(t===i.AND){if(!1===(r=r&&n[e]))break}else if(t===i.OR&&!0===(r=r||n[e]))break}return r})}(l(e,"page_attributes.filters",[]),l(e,"page_attributes.filter_operator","and"))})}var he=function(e,t,r,n){return new(r=r||Promise)(function(i,a){function o(e){try{c(n.next(e))}catch(e){a(e)}}function s(e){try{c(n.throw(e))}catch(e){a(e)}}function c(e){var t;e.done?i(e.value):((t=e.value)instanceof r?t:new r(function(e){e(t)})).then(o,s)}c((n=n.apply(e,t||[])).next())})};class wr{static getIdentityMap(){var e=ar.get(lt.WEB_SETTINGS);return null!=e&&e.isDomainLevelStorage?this.getIdentitiesFromCookies():this.getIdentitiesFromLocalStorage()}static getIdentitiesFromLocalStorage(){var e=ar.get(lt.IDENTITY_MAP);return null!=e&&e.userIdentities?e:null}static getIdentitiesFromCookies(){var e,t=nr.get(lt.IDENTITY_MAP);return t&&"object"==typeof t&&t.userIdentities?(e={userIdentities:t.userIdentities},t.previousIdentities&&(e.previousIdentities=t.previousIdentities,e.previousIdentitiesUpdatedTime=t.previousIdentitiesUpdatedTime),e):null}static getUserIdentities(){var e=this.getIdentityMap();return null!=e&&e.userIdentities?e.userIdentities:null}static updateCurrentUserIdentities(e){return he(this,void 0,void 0,function*(){let t;var r=this.getIdentityMap();t=null!=r&&r.userIdentities?Object.assign(Object.assign({},r),{userIdentities:Object.assign(Object.assign({},r.userIdentities),e)}):(this.createIdentityMap(),Object.assign(Object.assign({},this.getIdentityMap()),{userIdentities:e})),ar.set(lt.IDENTITY_MAP,t),yield this.updateIdentifiersIDB(t)})}static broadcastUserIdentityUpdate(){var e=this.baseLogTag+".broadcastUserIdentityUpdate";Kt.log(1,e,"User Identities Updated."),cn.broadcastToWindow({topic:ft.USER_LIFECYCLE.TOPIC_NAME,name:ft.USER_LIFECYCLE.EVENT_NAMES.USER_IDENTITY_UPDATE})}static broadcastLogout(){cn.broadcastToWindow({topic:ft.USER_LIFECYCLE.TOPIC_NAME,name:ft.USER_LIFECYCLE.EVENT_NAMES.LOGOUT})}static updatePreviousUserIdentities(e,t){return he(this,void 0,void 0,function*(){let r;var n,i=this.getIdentityMap();r=null!=i&&i.userIdentities?(n=(null==i?void 0:i.previousIdentities)||{},Object.assign(Object.assign({},i),{previousIdentities:Object.assign(Object.assign({},n),e),previousIdentitiesUpdatedTime:t||(new Date).getTime()})):(this.createIdentityMap(),Object.assign(Object.assign({},this.getIdentityMap()),{previousIdentities:e,previousIdentitiesUpdatedTime:t||(new Date).getTime()})),ar.set(lt.IDENTITY_MAP,r),yield this.updateIdentifiersIDB(r)})}static updateIdentifiersIDB(e){var t;return he(this,void 0,void 0,function*(){var r;null!=(t=this.moeDataStore)&&t.getItem||(this.moeDataStore=E.createInstance({driver:[E.INDEXEDDB],name:At.DATABASE_NAME,storeName:At.STORE_NAME})),this.moeDataStore&&(Object.keys(e).length?(r=(yield this.moeDataStore.getItem(Wt))||{},yield this.moeDataStore.setItem(Wt,Object.assign(Object.assign({},r),e))):yield this.moeDataStore.setItem(Wt,e))})}static copyUidIntoIdentityMap(e){var t=this.baseLogTag+".copyUidIntoIdentityMap";(e=e.getAttribute("id"))&&(this.updateCurrentUserIdentities({uid:e}),Kt.log(1,t,"UID copied into IdentityMap."))}static getIdentifiersFromIdentities(){var{userIdentities:e,previousIdentities:t,previousIdentitiesUpdatedTime:r}=this.getIdentityMap()||{},n={};return e&&Object.keys(e).length&&(n.userIdentities=e),0<r&&(216e5<(new Date).getTime()-r?this.removePreviousUserIdentities():n.previousIdentities=t),n}static removePreviousUserIdentities(){return he(this,void 0,void 0,function*(){var e=this.baseLogTag+".removePreviousUserIdentities",t=Object.assign(Object.assign({},this.getIdentityMap()),{previousIdentities:{},previousIdentitiesUpdatedTime:0});ar.set(lt.IDENTITY_MAP,t),yield this.updateIdentifiersIDB(t),Kt.log(1,e,"previousIdentities removed from IdentityMap.")})}static createIdentityMap(){ar.set(lt.IDENTITY_MAP,{userIdentities:{},previousIdentities:{},previousIdentitiesUpdatedTime:0})}}function pe(){var e=navigator.userAgent;return!(!/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|ipad|iris|kindle|Android|Silk|lge |maemo|midp|mmp|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows (ce|phone)|xda|xiino/i.test(e)&&!/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(e.substr(0,4)))}function ve(){var e=navigator.userAgent.toLowerCase(),t=/(ipad|tablet|(android(?!.*mobile))|(windows(?!.*phone)(.*touch))|kindle|playbook|silk|(puffin(?!.*(IP|AP|WP))))/.test(e);return/nexus player|neo-x5|adt-2|tsbnettv|roku|tizen|smart-tv.+(samsung)|hbbtv.+maple;(\d+)|(nux; netcast.+smarttv|lg (netcast\.tv-201\d|android tv))|(apple) ?tv|crkey|droid.+aft(\w)( bui|\))|\(dtv[\);].+(aquos)|(aquos-tv[\w ]+)\)|(bravia[\w ]+)( bui|\))|(mitv-\w{5}) bui|Hbbtv.*(technisat) (.*);|\b(roku)[\dx]*[\)\/]((?:dvp-)?[\d\.]*)|hbbtv\/\d+\.\d+\.\d+ +\([\w\+ ]*; *([\w\d][^;]*);([^;]*)|\b(android tv|smart[- ]?tv|opera tv|tv; rv:)\b/i.test(e)?Mt.TV:t?Mt.TABLET:pe()?Mt.MOBILE:Mt.WEB}function fe(e,t){var r=t&&new RegExp("^("+t.join("|")+")$");return ve()===Mt.TV&&(null!=r&&r.test(e)||!t)?{moe_os_type:(()=>{var e=navigator.userAgent.toLowerCase();return/tizen/i.test(e)?kt.TIZEN:/web0s/i.test(e)?kt.WEB_OS:/xbox/i.test(e)?kt.XBOX:/vizio/i.test(e)?kt.VIZIO:kt.DEFAULT})(),os:Mt.TV.toUpperCase()}:{}}function _e(e,t){if(null==e||null==t)return e===t;if(e instanceof Function)return e===t;if(e instanceof RegExp)return e===t;if(e===t||e.valueOf()===t.valueOf())return!0;if(Array.isArray(e)&&e.length!==t.length)return!1;if(e instanceof Date)return!1;if(!(e instanceof Object))return!1;if(!(t instanceof Object))return!1;let r=Object.keys(e);return Object.keys(t).every(e=>-1!==r.indexOf(e))&&r.every(r=>_e(e[r],t[r]))}wr.baseLogTag="IdentityMethods";class Lr{constructor(e,t,r){this.os="web",this.osPlatform=e.userAgent,this.isMobile=pe(),this.os=pe()?"mweb":"web",this.name=Lr.getBrowserName(e.userAgent,t),this.isIncognito=r}static getInstance(){return function(e,t,r,n){return new(r=r||Promise)(function(t,i){function a(e){try{s(n.next(e))}catch(e){i(e)}}function o(e){try{s(n.throw(e))}catch(e){i(e)}}function s(e){var n;e.done?t(e.value):((n=e.value)instanceof r?n:new r(function(e){e(n)})).then(a,o)}s((n=n.apply(e,[])).next())})}(this,0,void 0,function*(){var e,t;return null==st.get(ct.BROWSER_DETAILS)?(e=yield Lr.isIncognito(window),e=new Lr(navigator,document,e),st.set(ct.BROWSER_DETAILS,e),(t=ar.get(lt.BROWSER_DETAILS))&&Lr.isBrowserUpdated(t,e)||ar.set(ct.BROWSER_DETAILS,e),e):st.get(ct.BROWSER_DETAILS)})}static isIncognito(e){let t=e.RequestFileSystem||e.webkitRequestFileSystem;return new Promise(r=>{t?t(e.TEMPORARY,100,()=>{r(!1)},()=>{r(!0)}):r(!1)})}static getBrowserName(e,t){return-1!==e.indexOf("MSIE")||1==t.documentMode?Lr.BROWSER_NAMES.INTERNET_EXPLORER:-1<e.indexOf("Edg")?Lr.BROWSER_NAMES.EDGE:-1<e.indexOf("OPR")||-1<e.indexOf("Opera")?Lr.BROWSER_NAMES.OPERA:-1<e.indexOf("Chrome")||e.match(/\b(?:crmo|crios)\/([\w\.]+)/i)?-1<e.indexOf("MMS")?Lr.BROWSER_NAMES.OPERA_NEON:Lr.BROWSER_NAMES.CHROME:-1<e.indexOf("Safari")?Lr.BROWSER_NAMES.SAFARI:-1<e.indexOf("Firefox")?Lr.BROWSER_NAMES.FIREFOX:Lr.BROWSER_NAMES.OTHERS}static isBrowserUpdated(e,t){return _e(e,t)}isWebPushCompatible(){return this.isChrome()||this.isFirefox()||this.isOpera()||this.isSafari()||this.isEdge()}isChrome(){return this.name===Lr.BROWSER_NAMES.CHROME}isFirefox(){return this.name===Lr.BROWSER_NAMES.FIREFOX}isOpera(){return this.name===Lr.BROWSER_NAMES.OPERA||this.name===Lr.BROWSER_NAMES.OPERA_NEON}isSafari(){return this.name===Lr.BROWSER_NAMES.SAFARI}isEdge(){return this.name===Lr.BROWSER_NAMES.EDGE}static isIOS(){return!(!navigator.userAgent.match(/iPad/i)&&!navigator.userAgent.match(/iPhone/i))}}(c=(c=Lr=Lr||{}).BROWSER_NAMES||(c.BROWSER_NAMES={})).CHROME="Google Chrome",c.FIREFOX="Mozilla Firefox",c.OPERA="Opera",c.OPERA_NEON="Opera Neon",c.SAFARI="Apple Safari",c.INTERNET_EXPLORER="Internet Explorer",c.EDGE="Edge",c.OTHERS="Others";let Cr=Lr,Pr=()=>new Promise((e,t)=>{try{var r=JSON.parse(localStorage.getItem("MOE_DATA"));r&&r.WEB_SETTINGS&&r.WEB_SETTINGS.configs&&e(r.WEB_SETTINGS),t("Error in getting sdk settings from localstorage - no data found")}catch(e){Kt.error(1,"getSDKSettings","Error in getting sdk settings from localstorage ",e),t(e)}}),Mr=()=>new Promise((e,t)=>{try{var r=JSON.parse(localStorage.getItem("MOE_DATA"));return r&&r.INIT_DATA&&e(r.INIT_DATA),{}}catch(e){Kt.error(1,"getSDKSettings","Error in getting init data from localstorage ",e),t(e)}});class kr{constructor(e,t,r){this.key=e,this.value=t,this.updated_at=(new Date).getTime(),r===kr.USER_ATTRIBUTE_LEVEL.PORTFOLIO&&(this.level=r)}static equal(e,t){return e.key===t.key&&JSON.stringify(e.value)===JSON.stringify(t.value)}}(T=(T=kr=kr||{}).USER_ATTRIBUTE_LEVEL||(T.USER_ATTRIBUTE_LEVEL={})).PORTFOLIO="PORTFOLIO",T.PROJECT="PROJECT";let Ur=kr;function me(){var e;return(null==(e=ar.get(lt.SUBSCRIPTION_DETAILS))?void 0:e.token)||null}let Br=e=>e===gt.UNSUBSCRIBED||e===gt.PERMISSION_BLOCKED,xr=e=>{let t;try{t=JSON.stringify(e)}catch(e){return!1}return new Blob([t]).size/1024>Pt.MAX_PAYLOAD_SIZE};function Se(e){return`Event "${e}" can't get tracked as its size is more than ${Pt.MAX_PAYLOAD_SIZE} KB. Max permissible event size is ${Pt.MAX_PAYLOAD_SIZE} KB.`}class Wr{initiateSessionAndSource(e){return new Promise((t,r)=>{this.isSessionRunning()&&this.isCurrentSourceSameAsPreviousSource()||this.startNewSession(e),t(!0)})}clearSessionAndSource(){ar.remove(St.SESSION)}isSessionRunning(){return this.getSessionKey()&&!this.isSessionExpired()}isSessionExpired(){var e=this.getSessionExpiryTime(),t=st.get("wasBrowserInactive");return!(!t&&null!==t)&&(this.isWindowActive()&&st.set("wasBrowserInactive",!1),(new Date).getTime()>e)}isNonEventInteractive(e){return Wr.NON_INTERACTIVE_EVENTS.includes(e.name)||0<e.attributes.filter(e=>"moe_non_interactive"===e.key&&1===e.value).length}getCurrentSource(){let e=Gt(window.location.href),t="",r={};var n;if(Object.keys(e).includes("utm_source"))return t="utm_",this.geCustomIdentifiersToTrack().forEach(t=>{e[t]&&(r[t]=e[t])}),n={source_url:window.location.href},e[t+"source"]&&(n.source=e[t+"source"]),e[t+"medium"]&&(n.medium=e[t+"medium"]),e[t+"term"]&&(n.term=e[t+"term"]),e[t+"campaign"]&&(n.campaign_name=e[t+"campaign"]),e[t+"content"]&&(n.content=e[t+"content"]),e.utm_id&&(n.campaign_id=e.utm_id),Object.keys(r).length&&(n.extra=r),n}getActiveSource(){return this.getSavedSource()||this.getCurrentSource()}isSourceOrganic(){let e=Gt(window.location.href);var t=Object.keys(e);let r=!1;return this.geCustomIdentifiersToTrack().forEach(t=>{e[t]&&(r=!0)}),!t.includes("utm_source")&&!t.includes("source")&&!r}setCurrentSource(e){var t=this.getSession()||{};t.currentSource=e,ar.set(St.SESSION,t)}removeCurrentSource(){var e=this.getSession();e&&(e.currentSource=void 0,ar.set(St.SESSION,e))}getSavedSource(){var e=l(this.getSession(),St.CURRENT_SOURCE,void 0);if(e)return e}isCurrentSourceSameAsPreviousSource(){var e,t;return!!this.isSourceOrganic()||(delete(e=Object.assign({},this.getCurrentSource())).source_url,delete(t=Object.assign({},this.getSavedSource())).source_url,_e(e,t))}getSessionKey(){return l(this.getSession(),St.SESSION_KEY,null)}getSessionStartTime(){return l(this.getSession(),St.SESSION_START_TIME,null)}getSessionExpiryTime(){return l(this.getSession(),St.SESSION_EXPIRY_TIME,null)}getSessionMaxTime(){return l(this.getSession(),St.SESSION_MAX_TIME,null)}getSession(){return ar.get(St.SESSION)}geCustomIdentifiersToTrack(){return l(this.getSession(),St.CUSTOM_IDENTIFIERS_TO_TRACK,[])||[]}generateSessionKey(){return(0,se.v4)()}startNewSession(e){this.removeCurrentSource();var t=this.getNumberOfSessions();e={sessionKey:this.generateSessionKey(),sessionStartTime:(new Date).toISOString(),sessionMaxTime:e.configs.sessionInactiveDuration,customIdentifiersToTrack:e.configs.sourceExtraParams,sessionExpiryTime:(new Date).getTime()+1e3*e.configs.sessionInactiveDuration,numberOfSessions:++t},ar.set(St.SESSION,e)}extendSession(){var e=this.getSession();e&&(e.sessionExpiryTime=(new Date).getTime()+1e3*e.sessionMaxTime,ar.set(St.SESSION,e))}handleBrowserInactivity(e){"hidden"===e&&st.set("wasBrowserInactive",!0)}isWindowActive(){return!!st.get("isWindowActive")}getNumberOfSessions(){return l(ar.get(St.SESSION),St.NUMBER_OF_SESSIONS)||0}}Wr.NON_INTERACTIVE_EVENTS=[gt.WEB_OPTIN_BANNER_LOAD,gt.OPT_IN_SHOWN,gt.WEB_OPTIN_BANNER_LOAD,gt.LOGOUT];let Fr=r(372),Vr=lt.Q;class jr{static clear(e){var t=jr.baseLogTag+".clear";if(De()){let r=[];for(;!zt.isEmpty(e);)switch(e){case Vr.REPORT:let n=zt.dequeue(Vr.REPORT);r.push(e=>{nn.reportAdd(n).then(()=>{e()})});break;case Vr.DEVICE:zt.dequeue(Vr.DEVICE)&&r.push(e=>{nn.deviceAdd().then(()=>{e()})});break;default:Kt.error(1,t,"Do not know how to handle queue with name:",e)}setTimeout(()=>{jr.processing[e]=!0,Fr(r,5,(t,r)=>{jr.processing[e]=!1})},0)}}static startPeriodicClear(e){let t=jr.baseLogTag+".startPeriodicCleanQ";jr.clearInterval(e);var r=()=>{zt.isEmpty(e)?(Kt.log(1,t,"If you see multiple event tracks with same, they were captured over multiple visits or page refreshes."),l(jr.processing,e,!1)||jr.clearInterval(e)):(jr.clear(e),Kt.log(1,t,"Starting periodic queue clear for",e))};r(),jr.intervals[e]=setInterval(r,6e3)}static clearInterval(e){null!=jr.intervals[e]&&(clearInterval(jr.intervals[e]),jr.intervals[e]=null)}}function Te(e){return`${(e=e?new Date(e):new Date).getDate()}:${e.getMonth()+1}:${e.getFullYear()}:${e.getHours()}:${e.getMinutes()}:`+e.getSeconds()}jr.baseLogTag="QManager",jr.intervals={},jr.processing={};class Kr{constructor(e){this.EVENT_ACTION=e.event.name,this.EVENT_ATTRS=e.event.attributes&&Gr(e.event.attributes),this.EVENT_G_TIME=(new Date).getTime().toString(),this.EVENT_L_TIME=Te(e.event.timestamp),this.EVENT_ATTRS_CUST=e.postData.c,this.N_I_E=e.postData.nie,e.isPortfolioAttribute&&(this.IS_PORTFOLIO=e.isPortfolioAttribute)}}Kr.baseLogTag="ReportAddViewEvent";let Gr=e=>{let t={};return e.forEach(e=>{t[e.key]=e.value}),t};class Hr{static visibilityChange(){"hidden"!==document.visibilityState||Hr.windowClosed||Jr.reactToTriggerEvents()}static removeEventListeners(){document.removeEventListener("visibilitychange",Hr.visibilityChange,!1)}static addListeners(){document.addEventListener("visibilitychange",Hr.visibilityChange,!1)}}Hr.windowClosed=!1;let Yr=Hr;class qr{static initialize(){return function(e,t,r,n){return new(r=r||Promise)(function(t,i){function a(e){try{s(n.next(e))}catch(e){i(e)}}function o(e){try{s(n.throw(e))}catch(e){i(e)}}function s(e){var n;e.done?t(e.value):((n=e.value)instanceof r?n:new r(function(e){e(n)})).then(a,o)}s((n=n.apply(e,[])).next())})}(this,0,void 0,function*(){var e,t;return null==qr.ready&&(qr.offlineDataStore=E.createInstance({driver:[E.INDEXEDDB],name:Ot.DATABASE_NAME,storeName:Ot.STORES.OFFLINE_DATA.NAME}),t=E.createInstance({driver:[E.INDEXEDDB],name:Ot.DATABASE_NAME,storeName:"moe_data"}),e=E.createInstance({driver:[E.INDEXEDDB],name:Ot.DATABASE_NAME,storeName:"moe_backup"}),t=[qr.offlineDataStore.ready(),t.ready(),e.ready()],qr.ready=Promise.all(t)),yield qr.ready})}}class zr{static getRemoteLogsBatchRequestOptions(e){return new Promise(t=>{nn.collectGetParams().then(r=>{r={query_params:Object.assign(Object.assign({},r),{unique_id:r.unique_id,os:"web"===r.os?"Web":"mWeb"}),logs:[...e]},t(r)})})}static sendBatchOfLogs(e){let t=nn.baseLogTag+".sendBatchOfLogs";return new Promise((r,n)=>{zr.getRemoteLogsBatchRequestOptions(e).then(n=>{var i=(i=Mr()).baseDomainName+Ct.END_POINT+n.query_params.os.toLowerCase()+"/"+i.appId;Ht.post(i,{postData:n}).then(()=>{Kt.log(1,t,"[sendBatchOfLogs] batch payload: "+JSON.stringify(e)),Kt.log(1,t,"Batch Remote Logs sent to MoEngage successfully"),zr.batchRemoteLogsApiRetries=1,r(!0)}).catch(r=>{Kt.log(1,t,"Batch Remote Logs API failed",r),this.handleRemoteLogsFailure(e)})})})}static handleRemoteLogsFailure(e){var t=nn.baseLogTag+".handleRemoteLogsFailure";Kt.log(1,t,"Retry Batch Logs Failed API",zr.batchRemoteLogsApiRetries),zr.batchRemoteLogsApiRetries<3&&setTimeout(()=>{zr.batchRemoteLogsApiRetries++,zr.sendBatchOfLogs(e)},3e3*zr.batchRemoteLogsApiRetries)}static sendBeacon(e){zr.getRemoteLogsBatchRequestOptions(e).then(e=>{var t=(t=Mr()).baseDomainName+Ct.END_POINT+e.query_params.os.toLowerCase()+"/"+t.appId+"?"+(new Date).getTime();Kt.log(1,"RemoteLogsApi.sendBeacon","[sendBeacon] Remote Logs batch payload: "+JSON.stringify(e)),navigator.sendBeacon(t,JSON.stringify(e))})}}zr.batchRemoteLogsApiRetries=1;var Ie=function(e,t,r,n){return new(r=r||Promise)(function(i,a){function o(e){try{c(n.next(e))}catch(e){a(e)}}function s(e){try{c(n.throw(e))}catch(e){a(e)}}function c(e){var t;e.done?i(e.value):((t=e.value)instanceof r?t:new r(function(e){e(t)})).then(o,s)}c((n=n.apply(e,t||[])).next())})};class Xr{static updateEventStore(){ve()!==Mt.TV&&E.createInstance({driver:[E.INDEXEDDB,E.WEBSQL,E.LOCALSTORAGE],name:It.DATABASE_NAME,storeName:It.STORE_NAME}).setItem(It.STORE_NAME,Xr.reports)}static spliceReports(e=Xr.reports.length){return e=Xr.reports.splice(0,e),Xr.updateEventStore(),e}static spliceRemoteLogs(e=Xr.remoteLogs.length){return Xr.remoteLogs.splice(0,e)}static suspendBatching(){var e=Xr.baseLogTag+".suspendBatching";this.spliceReports(),this.spliceRemoteLogs(),Xr.periodicSyncInterval&&Xr.clearInterval(),Yr.removeEventListeners(),Kt.log(2,e,"Batching has stopped.")}static shouldCreateNewBatch(){return!Xr.lastbatchCreatedAt||(new Date).getTime()-Xr.lastbatchCreatedAt>=Dt.CONFIG.TIME_BETWEEN_BATCHES}static shouldCreateNewBatchForRemoteLogs(){return!Xr.lastRemoteLogsbatchCreatedAt||(new Date).getTime()-Xr.lastRemoteLogsbatchCreatedAt>=Dt.CONFIG.TIME_BETWEEN_BATCHES}static reactToTriggerEvents(){var e=Xr.baseLogTag+".reactToTriggerEvents";0<Xr.reports.length?(Kt.log(1,e,`Trigger Events: Created Batch of ${Xr.reports.length} reports`,Te()),Xr.createBatch()):Kt.log(2,e,Te()+": No report's to sync for this event."),0<Xr.remoteLogs.length?(Kt.log(1,e,`Trigger Events: Created Batch of remote logs ${Xr.remoteLogs.length} reports`,Te()),Xr.createRemoteLogsBatch()):Kt.log(2,e,Te()+": No logs's to sync for remote logs.")}static periodicSync(e){var t=Xr.baseLogTag+".periodicSync";0<Xr.reports.length&&Xr.shouldCreateNewBatch()?(Kt.log(1,t,`Periodic sync: Created Batch of ${Xr.reports.length} reports`,Te()),Xr.createBatch()):Kt.log(2,t,Te()+`: No report's to sync at this interval. The next sync will attempt in ${e} seconds`),0<Xr.remoteLogs.length&&Xr.shouldCreateNewBatchForRemoteLogs()?(Kt.log(1,t,`Periodic sync: Created Batch of remote logs ${Xr.reports.length} reports`,Te()),Xr.createRemoteLogsBatch()):Kt.log(2,t,Te()+`: No report's to sync at this interval for remote logs. The next sync will attempt in ${e} seconds`)}static clearInterval(){clearInterval(Xr.periodicSyncInterval),Xr.lastbatchCreatedAt=null}static init(e){Cr.getInstance().then(t=>Ie(this,void 0,void 0,function*(){(Xr.isOfflineBatchingSupported(t,e)||e.configs.remoteLogTracking)&&(yield qr.initialize(),Xr.periodicSyncInterval&&Xr.clearInterval(),Xr.periodicSyncInterval=window.setInterval(Xr.periodicSync.bind(this,e.configs.periodicFlushTime),1e3*e.configs.periodicFlushTime),Yr.addListeners())}))}static sendBatch(e){let t=Xr.baseLogTag+".sendBatch";return new Promise(r=>{try{nn.sendBatchOfReports(e).then(()=>{Xr.lastbatchCreatedAt=(new Date).getTime(),r(!0)})}catch(e){Kt.error(1,t,"Error in sending batch",e),r(!1)}})}static sendRemoteLogs(e){let t=Xr.baseLogTag+".sendRemoteLogs";return new Promise(r=>{try{zr.sendBatchOfLogs(e).then(()=>{Xr.lastRemoteLogsbatchCreatedAt=(new Date).getTime(),r(!0)})}catch(e){Kt.error(1,t,"Error in sending batch of remote logs",e),r(!1)}})}static createBatch(e){0<Xr.reports.length&&(e=Xr.spliceReports(e),Xr.sendBatch(e))}static createRemoteLogsBatch(e){0<Xr.remoteLogs.length&&(e=Xr.spliceRemoteLogs(e),Xr.sendRemoteLogs(e))}static addReport(e,t){var r=Xr.baseLogTag+".addReport";return e=new Kr(e),xr(e)?(Kt.error(1,r,Se(e.EVENT_ACTION)),!1):(Xr.reports.push(e),xr(Xr.reports)?(Xr.reports.pop(),Kt.log(1,r,`Created Batch of ${Xr.reports.length} reports as payload size would have breached after adding new event to this batch: "${e.EVENT_ACTION}"`,Te()),Xr.createBatch(),Xr.reports.push(e),Xr.updateEventStore()):(Xr.updateEventStore(),Xr.reports.length===t&&(Kt.log(1,r,`Created Batch of ${t} reports`,Te()),Xr.createBatch(t))),!0)}static sendBeacon(){var e=Xr.baseLogTag+".sendBeacon";0<Xr.reports.length&&(Kt.log(1,e,`Window Unload: Created batch of ${Xr.reports.length} reports`,Te()),nn.sendBeacon(Xr.spliceReports())),0<Xr.remoteLogs.length&&(Kt.log(1,e,`Window Unload: Created Remote Logs batch of ${Xr.remoteLogs.length} reports`,Te()),zr.sendBeacon(Xr.spliceRemoteLogs()),Xr.lastRemoteLogsbatchCreatedAt=(new Date).getTime())}static flushReports(e=!1){return Ie(this,void 0,void 0,function*(){var t=Xr.baseLogTag+".flushReports";try{e&&Yr.removeEventListeners(),0<Xr.reports.length&&(Kt.log(1,t,`Flushed ${Xr.reports.length} reports`,Te()),yield Xr.sendBatch(Xr.spliceReports())),0<Xr.remoteLogs.length&&(Kt.log(1,t,`Flushed ${Xr.remoteLogs.length} remote logs`,Te()),yield Xr.sendRemoteLogs(Xr.spliceRemoteLogs()))}catch(e){Kt.error(1,t,"Error in flushing reports",e)}})}static isOfflineBatchingSupported(e,t){return t=t||ar.get(lt.WEB_SETTINGS),Xr.isBatchingSupported(t,e)}static addRemoteLogs(e,t=15){var r=Xr.baseLogTag+".addRemoteLogs";Xr.remoteLogs.push(e),Xr.remoteLogs.length===t&&(Kt.log(1,r,`Created Batch of ${t} reports`,Te()),Xr.createRemoteLogsBatch(t))}static isBatchingSupported(e,t){try{var r=ve();return!(null==e||!e.configs.isBatchingEnabled||("web"!==r||t.name!==Cr.BROWSER_NAMES.CHROME&&t.name!==Cr.BROWSER_NAMES.EDGE&&t.name!==Cr.BROWSER_NAMES.OPERA)&&("mobile"!==r||Cr.isIOS()||t.name!==Cr.BROWSER_NAMES.CHROME&&t.name!==Cr.BROWSER_NAMES.OPERA)||!navigator.sendBeacon)}catch(e){Kt.error(1,"BatchManager.isBatchingSupported",e)}}}Xr.baseLogTag="BatchManager",Xr.reports=[],Xr.remoteLogs=[],Xr.lastbatchCreatedAt=null,Xr.lastRemoteLogsbatchCreatedAt=null;let Jr=Xr;class Qr{constructor(){var e=Qr.baseLogTag+".constructor";let t=on.getSync().getAttribute("id");t=t?t.toString():void 0;var r=window.analytics;let n,i;if(r){i=r._VERSIONS;try{n=r.user().anonymousId()}catch(t){Kt.error(1,e,"Error getting anonymous id from segment api",t)}}this.c=void 0,this.h="",e=wr.getIdentityMap(),(t||n||null!=e&&e.userIdentities)&&(this.identifiers={moe_user_id:t,segment_id:n,user_identities:(null==e?void 0:e.userIdentities)||void 0,previous_identities:(null==e?void 0:e.previousIdentities)||void 0}),this.meta={bid:(0,se.v4)(),segmentSdkData:r?i:void 0}}}Qr.baseLogTag="ReportPostData";class $r{constructor(e,t,r,n=Ur.USER_ATTRIBUTE_LEVEL.PROJECT){$r.baseLogTag,this.type=e,this.getParams=t,this.event=r,this.isPortfolioAttribute=n===Ur.USER_ATTRIBUTE_LEVEL.PORTFOLIO,this.postData=new Qr;var i,a,o={},s={};for(i of r.attributes)i&&null!=i.key&&(this.status=$r.STATUS.VALID,null!=i.value)&&("function"==typeof i.value.getMonth?((a={})[i.key]=Math.round(i.value.getTime()-6e4*i.value.getTimezoneOffset()),null==s.timestamp&&(s.timestamp=[]),s.timestamp.push(a)):o[i.key]=i.value);this.postData.e=r.name,this.postData.a=o,this.postData.c=(e=s,0===Object.keys(e).length&&e.constructor===Object?void 0:s),window&&window.location&&null!=window.location.href&&(this.postData.url=window.location.href)}}$r.baseLogTag="ReportClass",(T=(c=$r=$r||{}).STATUS||(c.STATUS={}))[T.INVALID=0]="INVALID",T[T.VALID=1]="VALID",(T=c.REPORT_ADD_TYPE||(c.REPORT_ADD_TYPE={}))[T.USER_ATTRIBUTE=0]="USER_ATTRIBUTE",T[T.EVENT=1]="EVENT";let Zr=$r;class en{constructor(e,t,r=!0){this.name=e,this.attributes=t,this.timestamp=(new Date).getTime(),r&&this.attributes.push(new Ur(ht.URL,location.href))}static createUserAttributeEvent(e){return new Promise((t,r)=>{var n=[],i=e.key;switch(e.key){case"id":e.key=pt.ID;break;case"email":e.key=pt.EMAIL;break;case"name":e.key=pt.NAME;break;case"first_name":e.key=pt.FIRST_NAME;break;case"last_name":e.key=pt.LAST_NAME;break;case"mobile":e.key=pt.MOBILE;break;case"gender":e.key=pt.GENDER;break;case"birthday":e.key=pt.BDAY}n.push(e),e.key!==i&&Kt.log(2,"Event.createUserAttributeEvent","Key changed to MoE reserved keyname: ",e.key),t(new en(gt.USER_ATTRIBUTE,n,!1))})}static createEvent(e,t,r){return new Promise((n,i)=>{on.get().then(i=>function(e,t,r,n){return new(r=r||Promise)(function(t,i){function a(e){try{s(n.next(e))}catch(e){i(e)}}function o(e){try{s(n.throw(e))}catch(e){i(e)}}function s(e){var n;e.done?t(e.value):((n=e.value)instanceof r?n:new r(function(e){e(n)})).then(a,o)}s((n=n.apply(e,[])).next())})}(this,0,void 0,function*(){try{var a=new Ur(ht.LOGGED_IN_STATUS,!!i.getAttribute("id")),o=new Wr,s=new Ur(ht.FIRST_VISIT,o.getNumberOfSessions()<=Nt.FIRST_SEEN_SESSIONS);t.push(a,s),n(new en(e,t,r))}catch(a){Kt.error(1,"Event.createEvent","Error occurred in create events ",a)}}))})}}class tn{static addEvent(e){tn.history.push(e),tn.listeners.forEach(t=>{t(e)})}static getHistory(){return tn.history}static addEventListener(e){tn.listeners.push(e)}static clear(){tn.history=[]}static clearAll(){tn.history=[],tn.listeners=[]}}var Ae;tn.history=[],tn.listeners=[];class rn{static track(e,t,r){let n="MoEngage.event.trackEvent";return new Promise((i,a)=>function(e,t,r,n){return new(r=r||Promise)(function(t,i){function a(e){try{s(n.next(e))}catch(e){i(e)}}function o(e){try{s(n.throw(e))}catch(e){i(e)}}function s(e){var n;e.done?t(e.value):((n=e.value)instanceof r?n:new r(function(e){e(n)})).then(a,o)}s((n=n.apply(e,[])).next())})}(this,0,void 0,function*(){var a,o;if(De()){let l;r=!!r;try{l=yield Pr()}catch(r){return Kt.warn(1,n,"SDK not yet initialized. Caching event and will track when SDK is initialized.",r),null!=(a=window.moengage_q)&&a.push({f:"track_event",a:[e,t]}),void i(!1)}if("string"==typeof e&&e)if(l.configs.blacklistedEvents&&l.configs.blacklistedEvents.includes(e))Kt.error(1,n,`This event "${e}" is blacklisted. Please contact Moengage team to whitelist it.`),i({error:5001,message:`Event "${e}" is blacklisted.`});else if(!wt.includes(e)||l.configs.whitelistedEvents&&l.configs.whitelistedEvents.includes(e))try{var s=[];if(null==t||null!==t&&t===Object(t)&&"[object Object]"===Object.prototype.toString.call(t)){for(var c in t=null==t?{}:t)t.hasOwnProperty(c)&&s.push(new Ur(c,t[c]));let n=new Wr,a=(yield n.initiateSessionAndSource(l),yield en.createEvent(e,s));tn.addEvent(a),null!=l&&l.configs.isWebPersonalizationModuleEnabled&&null!=(o=window.MoeWebP)&&o.handleInSessionEvent(a),nn.collectGetParams().then(t=>{Br(e)&&delete t.push_id,t=new Zr(Zr.REPORT_ADD_TYPE.EVENT,t,a);var o={session_id:n.getSessionKey(),start_time:n.getSessionStartTime(),background_initiated:0},s=[],c=n.getActiveSource();c&&(n.setCurrentSource(c),s.push(c)),t.postData.meta.session=o,s.length&&(t.postData.meta.source=s),n.isNonEventInteractive(a)&&(t.postData.nie=1),nn.reportAdd(t,r).then(()=>{n.isNonEventInteractive(a)||n.extendSession(),i(!0)})})}else Kt.error(1,n,"Event attributes were not passed a key-value pair object for event: "+e),i({error:5002,message:"Event value needs to be a key-value pair object"})}catch(e){Kt.error(1,n,"Error occurred in tracking events ",e)}else Kt.log(2,n,`This event "${e}" has not been whitelisted. Please contact Moengage team to whitelist it.`),i({error:5001,message:`Event "${e}" is not whitelisted.`});else Kt.error(1,n,"Event name not a string or null or empty string:",e),i({error:5001,message:"Event name can not be null"})}else Kt.warn(2,n,`Not tracking the event "${e}" as Web SDK has been disabled.`),i(!1)}))}}(c=Ae=Ae||{}).PROMPT="prompt",c.GRANTED="granted",c.DENIED="denied",c.DISMISSED="dismissed";var be=function(e,t,r,n){return new(r=r||Promise)(function(i,a){function o(e){try{c(n.next(e))}catch(e){a(e)}}function s(e){try{c(n.throw(e))}catch(e){a(e)}}function c(e){var t;e.done?i(e.value):((t=e.value)instanceof r?t:new r(function(e){e(t)})).then(o,s)}c((n=n.apply(e,t||[])).next())})};class nn{static deviceAdd(e=!0){var t=nn.baseLogTag+".deviceAdd";return nn.isExecutingDeviceAdd?(Kt.warn(2,t,"Device add is already in progress. Skipping this call."),Promise.resolve(!1)):(nn.isExecutingDeviceAdd=!0,new Promise((t,r)=>be(this,void 0,void 0,function*(){if(De()){let n=qt.get();return nn.collectGetParams(Pt.API.DEVICE_ADD).then(i=>{i={queryParams:i=Object.assign(Object.assign({},i),{url:window.location.href})},Ht.post(n.baseDomainName+Pt.API.DEVICE_ADD,i).then(()=>{e?on.get().then(e=>{e.deviceAdded=!0,e.save().then(()=>{jr.startPeriodicClear(lt.Q.REPORT),nn.onDeviceAdd.res()})}).then(()=>{this.trackDeviceAttributes(),nn.isExecutingDeviceAdd=!1,t(!0)}):(nn.isExecutingDeviceAdd=!1,t(!0))}).catch(e=>{zt.enqueue(lt.Q.DEVICE,!0),nn.isExecutingDeviceAdd=!1,r(!1)})})}t(!1)})))}static trackDeviceAttributes(){let e=nn.baseLogTag+".trackDeviceAttributes";return new Promise((t,r)=>be(this,void 0,void 0,function*(){try{var r="WEB"===(r=ve().toUpperCase())?"DESKTOP":r;rn.track(gt.DEVICE_ATTRIBUTE,{deviceType:r});let t=!1;Cr.getInstance().then(r=>{Pr().then(n=>be(this,void 0,void 0,function*(){if(a=n,o=r,!qt.get().disableWebPush&&a.isWebPushEnabled&&0<=xt.indexOf(o.name)&&navigator.serviceWorker&&"PushManager"in window&&"Notification"in window){let r=me();if(!r)try{var i=u()||{};let e="";(e="function"==typeof i.getPermissionState?yield i.getPermissionState():e)===Ae.GRANTED&&(r=!0)}catch(a){Kt.error(2,e,"Failed to get push notification permission state.",a)}t=r}var a,o})).then(()=>{rn.track(gt.DEVICE_ATTRIBUTE,{[Lt.MOE_PUSH_OPTED]:!!t,source:"deviceAdd"}),ar.set(lt.OPTED_STATUS_TRACK_TIME,Date.now())})})}catch(r){Kt.error(2,e,"Failed to track device attributes.",r)}t(null)}))}static reportAdd(e,t){let r=nn.baseLogTag+".reportAdd";return new Promise((n,i)=>{t=!!t,Pr().then(a=>{var o,s,c,l=st.get(ct.LANDING_PAGE_TRACKING)&&(null==(l=null==a?void 0:a.configs)?void 0:l.landingPageTracking);try{if(l&&!h(null==(s=null==(o=e.event.attributes)?void 0:o[0])?void 0:s.key,null==(c=null==a?void 0:a.configs)?void 0:c.subscriberBasedBillingAttributes))return Kt.log(2,r,"Landing page tracking enabled (both flag and config), processing report immediately:",e.event.name),zt.isEmpty(lt.Q.REPORT)||(Kt.log(2,r,"Flushing queued reports as landing page tracking is enabled"),jr.clear(lt.Q.REPORT)),nn.executeReportAdd(e,t,n,i)}catch(a){Kt.error(2,r,"Error checking push subscription attribute acceptance for landing page tracking:",a)}return a.isPushSubBilling?nn.handlePushSubBilling(e,t,a,n,i):nn.executeReportAdd(e,t,n,i)}).catch(e=>{Kt.error(1,r,"Error in getting Web SDK Settings. This might indicate that the App is blocked."),i(!1)})})}static executeReportAdd(e,t,r,n){nn.reportAddInternal(e,t).then(()=>{this.sendBroadcast(e),r(!0)}).catch(()=>{n(!1)})}static handlePushSubBilling(e,t,r,n,i){let a=nn.baseLogTag+".handlePushSubBilling";on.get().then(a=>{a.deviceAdded?nn.executeReportAdd(e,t,n,i):(nn.queueReportForDeviceAdd(e,r),n(!0))}).catch(r=>{Kt.error(1,a,"Error getting user data for push subscriber billing:",r),nn.executeReportAdd(e,t,n,i)})}static queueReportForDeviceAdd(e,t){var r=nn.baseLogTag+".queueReportForDeviceAdd";zt.enqueue(lt.Q.REPORT,e),Kt.log(2,r,"Report added to queue as device not added yet:",e.event.name),e.type===Zr.REPORT_ADD_TYPE.USER_ATTRIBUTE&&nn.handleUserAttributeForPushSubBilling(e,t)}static handleUserAttributeForPushSubBilling(e,t){var r=nn.baseLogTag+".handleUserAttributeForPushSubBilling";e.event.attributes&&0!==e.event.attributes.length&&(h(e.event.attributes[0].key,null==(e=null==t?void 0:t.configs)?void 0:e.subscriberBasedBillingAttributes)?(Kt.log(2,r,"Attribute accepted for push sub billing."),nn.deviceAdd()):Kt.log(2,r,"Attribute NOT accepted for push sub billing."))}static sendBroadcast(e){Rt.NAMES.includes(e.event.name)&&cn.broadcastToWindow({topic:Rt.TOPIC,name:e.event.name,data:e.event.attributes})}static getSegmentId(){var e=window.analytics;if(e&&e.user)return e.user().anonymousId()}static getBatchRequestOptions(e){return new Promise(t=>{nn.collectGetParams(Dt.API.REPORT_ADD).then(r=>be(this,void 0,void 0,function*(){var n,i=nn.getSegmentId()||"",a=on.getSync(),o=qt.get(),s={session_id:(n=new Wr).getSessionKey(),start_time:n.getSessionStartTime(),background_initiated:0},c=[],l=n.getActiveSource(),{userIdentities:n,previousIdentities:l}=(l&&(n.setCurrentSource(l),c.push(l)),yield wr.getIdentifiersFromIdentities()),u=(l={user_identities:n||void 0,previous_identities:l||void 0},yield this.getParamsFromCookie());let d=null;var E=Object.assign({},r);null!==u&&"object"==typeof u&&(d=u.moe_user_id,null!==u.push_id&&(E.push_id=u.push_id),null!==u.unique_id)&&(E.unique_id=u.unique_id),a={query_params:E,identifiers:Object.assign(Object.assign({moe_user_id:null!==d?d:a.getAttribute("id")||(null==n?void 0:n.uid)||void 0,segment_id:i||void 0},l),{moe_aid:Oe()}),meta:{bid:(0,se.v4)(),request_time:(new Date).toISOString(),session:s,source:c.length?c:void 0,initiator:null!=(E=null==(u=null==o?void 0:o.proxyDomains)?void 0:u.api)&&E.length?"proxy_server":void 0},viewsCount:e.length,viewsInfo:[...e]},t(a)}))})}static getParamsFromCookie(){let e=this.baseLogTag+".getMoeUserIdFromCookies",t={moe_user_id:null,unique_id:null,push_id:null};return new Promise(r=>{Pr().then(e=>{var n,i;null!=e&&e.isDomainLevelStorage&&(e=nr.get(lt.USER_DATA),i=null==(i=nr.get(lt.SUBSCRIPTION_DETAILS))?void 0:i.token,e&&(null!=(n=e.attributes)&&n.length&&e.attributes.find(e=>e.key===pt.ID)?t.moe_user_id=e.attributes.find(e=>e.key===pt.ID).value:t.moe_user_id=void 0,null!=(n=e.deviceUuid))&&n.length&&(t.unique_id=e.deviceUuid),null!=i&&i.length&&Ne(i)?t.push_id=i:t.push_id=void 0),r(t)}).catch(n=>{Kt.error(2,e,"Error occurred while trying to fetch SDK Settings: ",n),r(t)})})}static addReportsToOfflineDB(e,t){return be(this,void 0,void 0,function*(){let r=nn.baseLogTag+".addReportsToOfflineDB";var n=yield nn.getBatchRequestOptions([]);yield qr.offlineDataStore.setItem(t||"report_add_"+(new Date).getTime(),e),yield qr.offlineDataStore.setItem("requestMetaData",n),yield qr.offlineDataStore.setItem(t||"batch_"+(new Date).getTime(),Object.assign(Object.assign({},n),{viewsCount:e.length,viewsInfo:e})),navigator.serviceWorker&&navigator.serviceWorker.ready.then(e=>{e.sync?e.sync.register(Ot.OFFLINE_SYNC_EVENT).then(()=>{Kt.log(2,r,"offline sync event registered")}).catch(e=>{Kt.error(1,r,"Service worker sync error",e)}):Kt.log(2,r,"Service worker sync unavailable")})})}static sendReportBeacon(e,t,r){var n=nn.baseLogTag+".sendReportBeacon";try{if(!e&&navigator.sendBeacon&&navigator.sendBeacon(t,new Blob([JSON.stringify(r)],{type:"text/plain;charset=UTF-8"})))return!0}catch(e){Kt.error(2,n,"Failed to send Report call with Beacon:",e)}return!1}static sendBatchOfReports(e){let t=nn.baseLogTag+".sendBatchOfReports";return new Promise((r,n)=>{nn.getBatchRequestOptions(e).then(i=>{var a=qt.get();let o=a.baseDomainName+Dt.API.REPORT_ADD+a.appId;Pr().then(n=>{if(!window.navigator.onLine)return this.sendToOfflineTracking(e,Ut,n);nn.sendReportBeacon(n.configs.isBeaconDisabled,o,i)?(Kt.log(1,t,"[sendBatchOfReports] batch payload: "+JSON.stringify(e)),Kt.log(1,t,"Batch sent to MoEngage successfully through beacon"),r(!0)):Ht.post(o,{postData:i}).then(()=>{Kt.log(1,t,"[sendBatchOfReports] batch payload: "+JSON.stringify(e)),Kt.log(1,t,"Batch sent to MoEngage successfully"),r(!0)}).catch(i=>{Kt.error(1,t,"Batch Report add API failed",i),r(this.sendToOfflineTracking(e,i,n))})}).catch(e=>{e!==Ut&&Kt.error(1,t,"Error in getting Web SDK Settings. This might indicate that the App is blocked."),n(e)})})})}static sendToOfflineTracking(e,t,r){let n=nn.baseLogTag+".sendToOfflineTracking";return new Promise((i,a)=>{De()?Cr.getInstance().then(o=>{Jr.isOfflineBatchingSupported(o,r)?(Kt.error(1,n,"Add Report API failed, adding reports to offline db. ",t),nn.addReportsToOfflineDB(e).then(()=>{Kt.log(2,n,"Network offline: Batch added to offline db")}),i(!0)):(Kt.warn(1,n,"Report not added to offline db. Offline tracking is supported only if batching is enabled. It is supported only on Chrome, Edge and Opera browsers on desktop web and Chrome and Opera browsers on Android web."),a(t))}).catch(()=>{a(t)}):(Kt.warn(2,n,"Not adding report(s) to offline db as SDK has been disabled."),a(t))})}static reportAddInternal(e,t){let r=nn.baseLogTag+".reportAddInternal";return new Promise((n,i)=>{Pr().then(i=>{Cr.getInstance().then(a=>{if(t){var o,s=nn.getUpdatedPushDetails();for(o in s)!s.hasOwnProperty(o)||Br(e.event.name)&&"push_id"===o||(e.getParams[o]=s[o]);var c=fe(),l=(c={queryParams:Object.assign(Object.assign({},e.getParams),c)},e.postData.nie?(delete(l=Object.assign({},e)).postData.meta.source,delete l.postData.meta.session,c.postData=l.postData):c.postData=e.postData,qt.get().baseDomainName);l+=Pt.API.DEVICE_ADD,Ht.post(l,c).then(()=>{var t="WEB"===(t=ve().toUpperCase())?"DESKTOP":t;rn.track(gt.DEVICE_ATTRIBUTE,{deviceType:t}),n(nn.handleReportAddSuccess(e))}).catch(t=>{Jr.isBatchingSupported(i,a)?zt.enqueue(lt.Q.DEVICE,e):nn.handleReportAddFailure(e,t)})}else Jr.isBatchingSupported(i,a)?(Jr.addReport(e,i.configs.eventBatchCount)&&(Kt.log(1,r,"Event batched successfully:",e.event),this.addEventsToIDB(e.event)),n(!0)):(l=new Kr(e),xr(l)?(Kt.error(1,r,Se(l.EVENT_ACTION)),n(!1)):nn.sendBatchOfReports([l]).then(()=>{n(nn.handleReportAddSuccess(e))}).catch(t=>{nn.handleReportAddFailure(e,t)}))})}).catch(e=>{Kt.error(1,r,"Error in getting Web SDK Settings. This might indicate that the App is blocked."),i(!1)})})}static handleReportAddSuccess(e){var t=nn.baseLogTag+".handleReportAddSuccess";return e.type===Zr.REPORT_ADD_TYPE.EVENT?(Kt.log(1,t,"Event tracked successfully:",e.event),this.addEventsToIDB(e.event)):e.type===Zr.REPORT_ADD_TYPE.USER_ATTRIBUTE&&Kt.log(1,t,"User attribute added successfully:",e.event.attributes),nn.addReportApiRetries=1,!0}static handleReportAddFailure(e,t){var r=nn.baseLogTag+".handleReportAddFailure";Kt.error(1,r,"Add Report API failed",t),e.type===Zr.REPORT_ADD_TYPE.EVENT?Kt.log(1,r,"Queueing unsuccessful event tracking:",e.event):e.type===Zr.REPORT_ADD_TYPE.USER_ATTRIBUTE&&Kt.log(1,r,"Queueing unsuccessful user attribute add:",e.event.attributes),nn.addReportApiRetries<3&&setTimeout(()=>{nn.addReportApiRetries++,zt.enqueue(lt.Q.REPORT,e),jr.startPeriodicClear(lt.Q.REPORT)},3e3*nn.addReportApiRetries)}static checkIfTokenValid(e){let t=qt.get().baseDomainName+Pt.API.DEVICE_TOKEN_CHECK,r=qt.get();return new Promise(n=>{e?on.get().then(i=>{i={queryParams:{app_id:r.appId,unique_id:i.deviceUuid,push_id:e}},Ht.post(t,i).then(e=>{200===e.status?n(!0):n(!1)}).catch(e=>{n(!1)})}):n(!1)})}static collectGetParams(e){return new Promise((t,r)=>{on.get().then(r=>be(this,void 0,void 0,function*(){let n=qt.get(),i=(null!=n&&null!=n.appId||(n=new qt(ar.get(lt.INIT_DATA))),yield Pr());var a=new Date;let o=Date.UTC(a.getUTCFullYear(),a.getUTCMonth(),a.getUTCDate(),a.getUTCHours(),a.getUTCMinutes(),a.getUTCSeconds(),a.getUTCMilliseconds());Cr.getInstance().then(a=>{var s,c,l=this.getDeviceUniqueId(),u=fe(e,[Pt.API.REPORT_ADD,Pt.API.DEVICE_ADD,Dt.API.REPORT_ADD]),d=Object.assign({os:a.os,os_platform:a.osPlatform,is_incognito:a.isIncognito,app_id:n.appId,os_ver:a.name,sdk_ver:"2.61.01",model:a.name,app_ver:"1.0",device_ts:Number(o),device_tz_offset:(-6e4*(new Date).getTimezoneOffset()).toString(),unique_id:r.deviceUuid,device_tz:(new Date).getTimezoneOffset().toString(),device_unique_id:l},u),E=(n.projectId&&(d.project_code=n.projectId),l=r.getAttribute("cart_token"),Ne(((u=null==(u=qt.get())?void 0:u.swPath)&&u.includes("tools/moengage")&&l&&null!=i&&i.configs.isMultiIdEnabled&&e!==Pt.API.DEVICE_ADD&&(d.cart_token=l),u=me()))&&(d.push_id=u),a.isWebPushCompatible()&&(l=i.webPushPlatformData,((u=a).isChrome()||u.isOpera()||u.isEdge()||u.isSafari()?"vapid"===(null==(c=null==l?void 0:l.chrome)?void 0:c.subscriptionMode)&&null!=(c=null==l?void 0:l.chrome)&&c.vapidPublicKey:u.isFirefox()&&"vapid"===(null==(c=null==l?void 0:l.firefox)?void 0:c.subscriptionMode)&&null!=(u=null==l?void 0:l.firefox)&&u.vapidPublicKey)?(d.subscription_type="vapid",d.vapid_public=(c=i.webPushPlatformData,(l=a).isChrome()||l.isOpera()||l.isEdge()||l.isSafari()?(null==(s=null==c?void 0:c.chrome)?void 0:s.vapidPublicKey)||"":l.isFirefox()&&(null==(s=null==c?void 0:c.firefox)?void 0:s.vapidPublicKey)||"")):d.subscription_type="normal"),null!=n.environment&&(d.environment=n.environment),ar.get(lt.SUBSCRIPTION_DETAILS));if(null!=E&&null!=E.keys){for(var g in E.keys)d["keys_"+g]=encodeURI(E.keys[g]);null!=E.endpoint&&(d.endpoint=encodeURI(E.endpoint)),d.expirationTime=E.expirationTime}t(d)})}))})}static getDeviceUniqueId(){var e;return(null==(e=ar.get(lt.DEVICE_DATA))?void 0:e.deviceUniqueId)||void 0}static getUpdatedPushDetails(){var e={},t=ar.get(lt.SUBSCRIPTION_DETAILS);if(null!=t){var r=t.token;if(null!=r&&"NA"!==r&&""!==r&&"null"!==r&&(e.push_id=r),t.keys){for(var n in t.keys)e["keys_"+n]=encodeURI(t.keys[n]);null!=t.endpoint&&(e.endpoint=encodeURI(t.endpoint)),e.expirationTime=t.expirationTime}}return e}static sendBeacon(e){if(!window.navigator.onLine)return this.sendToOfflineTracking(e,Ut);nn.getBatchRequestOptions(e).then(e=>{var t=(t=qt.get()).baseDomainName+Dt.API.REPORT_ADD+t.appId+"?"+(new Date).getTime();Kt.log(1,"MoeApi.sendBeacon","[sendBeacon] batch payload: "+JSON.stringify(e)),navigator.sendBeacon(t,JSON.stringify(e))})}static addEventsToIDB(e){var t;ve()!==Mt.TV&&null!=(t=E.createInstance({driver:[E.INDEXEDDB,E.WEBSQL,E.LOCALSTORAGE],name:Tt.DATABASE_NAME,storeName:Tt.STORE_NAME}))&&t.setItem(e.name,e)}}nn.baseLogTag="MoeApi",nn.onDeviceAdd=new class{constructor(){this.p=null,this.res=null,this.rej=null;try{this.p=new Promise((e,t)=>{this.res=e,this.rej=t})}catch(e){Kt.error(1,"Utils.PromiseObject","Promises not supported")}}},nn.webSdkApiRetries=1,nn.offlineEvents=[],nn.addReportApiRetries=1,nn.isExecutingDeviceAdd=!1;var ye=function(e,t,r,n){return new(r=r||Promise)(function(i,a){function o(e){try{c(n.next(e))}catch(e){a(e)}}function s(e){try{c(n.throw(e))}catch(e){a(e)}}function c(e){var t;e.done?i(e.value):((t=e.value)instanceof r?t:new r(function(e){e(t)})).then(o,s)}c((n=n.apply(e,t||[])).next())})};let an=null;class on{constructor(e){this.attributes=[],this.subscribedToOldSdk=!1,null==e?(this.deviceUuid=(0,se.v4)(),this.attributes=[],this.deviceAdded=!1):(this.deviceUuid=l(e,"deviceUuid",(0,se.v4)()),this.attributes=l(e,"attributes",[]),this.deviceAdded=l(e,"deviceAdded",!1))}addAttribute(e){let t=on.baseLogTag+".addAttribute";return new Promise(r=>ye(this,void 0,void 0,function*(){let n=!0,i=(e.key=on.getMorphedKey(e.key),-1);for(let t=this.attributes.length-1;0<=t;t--)e.key===this.attributes[t].key&&e.level===this.attributes[t].level&&(i=t);0<=i?(_e(this.attributes[i].value,e.value)&&(Kt.log(2,t,"Duplicate attribute found: ",e),n=yield this.isAttibuteTrackingRequired(this.attributes[i].updated_at,this.attributes[i].level)),n&&(this.attributes[i].value=e.value,this.attributes[i].updated_at=(new Date).getTime())):(Kt.log(2,t,"Adding attribute:",e),this.attributes.push(e)),this.save().then(()=>{r(n)})}))}isAttibuteTrackingRequired(e,t=Ur.USER_ATTRIBUTE_LEVEL.PROJECT){return ye(this,void 0,void 0,function*(){var r=yield Pr();return t===Ur.USER_ATTRIBUTE_LEVEL.PORTFOLIO&&null!==r.configs.portfolioUserAttributeCacheTime?Re(e)>r.configs.portfolioUserAttributeCacheTime:null===r.configs.userAttributeCacheTime||Re(e)>r.configs.userAttributeCacheTime})}static getLocalUser(){let e=on.baseLogTag+".getLocalUser";return new Promise(t=>{var r;ar.get(lt.USER_DATA)?(Kt.log(2,e,"Found user in localstorage"),r=ar.get(lt.USER_DATA),t(new on(r))):t(null)})}static getCookieUser(){return new Promise(e=>{var t=on.baseLogTag+".getLocalUser";nr.get(lt.USER_DATA)?(Kt.log(2,t,"Found user in cookie"),t=nr.get(lt.USER_DATA),e(new on(t))):e(null)})}static getMigrationUser(){let e=on.baseLogTag+".getLocalUser";return new Promise(t=>{var r=localStorage.getItem(lt.OLD_SDK.USER_DATA);if(r)try{var n=JSON.parse(r);if(n.is_new_sdk_migrated)t(null);else{var i,a=new on({deviceAdded:l(n,"device_add",!1),deviceUuid:l(n,"uuid",(0,se.v4)())}),o=l(n,"user_attrs",{});for(i in o)o.hasOwnProperty(i)&&a.attributes.push(new Ur(i,o[i]));var s=localStorage.getItem(lt.OLD_SDK.PUSH_TOKEN);null!=s&&"NA"!==s&&"null"!==s&&(a.subscribedToOldSdk=!0),t(a)}}catch(r){Kt.error(1,e,"Error getting the migration user. Resolving as a new user."),Kt.error(1,e,r),t(null)}else t(null)})}static getSync(){return on.instance}static get(){let e=on.baseLogTag+".get";return null!=an?an:an=new Promise((t,r)=>{Cr.getInstance().then(e=>Pr()).then(t=>{var r=on.getLocalUser(),n=t.isDomainLevelStorage?on.getCookieUser():"resolved",i=on.getMigrationUser();return Promise.all([r,n,i]).then(r=>{let n=r[0],i=r[1];return(r=r[2])?r.save().then(t=>{var r=localStorage.getItem(lt.OLD_SDK.USER_DATA);if(r)try{var n=JSON.parse(r);n.is_new_sdk_migrated=!0,localStorage.setItem(lt.OLD_SDK.USER_DATA,JSON.stringify(n))}catch(t){Kt.error(1,e,"Error parsing migration user JSON",t)}return Kt.log(1,e,"User resolved from older SDK: ",t),t}):(()=>{var r;return(i&&"resolved"!==i?(Kt.log(1,e,"User resolved from cookie: ",i),i):(Kt.log(1,e,"Local user: ",n),r=new on(n),t.isPushSubBilling&&(me()||((e,t)=>{let r=[pt.EMAIL,pt.MOBILE,...t];return 0<e.filter(e=>r.includes(e.key)).length||Oe()})(r.attributes,null==t?void 0:t.configs.subscriberBasedBillingAttributes)?(r.deviceAdded=!0,nn.trackDeviceAttributes()):r.deviceAdded=!1),r)).save()})()})}).then(e=>{on.isResolved=!0,t(e)}).catch(t=>{Kt.error(1,e,"Error in fetching/creating user",t),an=null,r(t)})})}static logout(){return new Promise(e=>{an=null,this.instance=null,window.MoeWebP&&(window.MoeWebP.deviceUuid=null),e(!0)})}save(){on.baseLogTag,on.isAmpEnabled()&&(this.deviceUuid=nr.get("moe_uuid")),ar.get("WEB_SETTINGS");var e=ar.get(lt.WEB_SETTINGS);return null!=e&&e.configs.isWebPersonalizationModuleEnabled&&null!=(e=window.MoeWebP)&&e.deviceUuid&&this.deviceUuid!==window.MoeWebP.deviceUuid&&(this.deviceUuid=window.MoeWebP.deviceUuid),on.instance=this,new Promise(e=>{ar.set(lt.USER_DATA,this),nr.setRaw(bt.UUID,on.instance.deviceUuid),e(this)})}static isAmpEnabled(){var e=nr.get(bt.UUID);return e&&e.includes("amp")}getAttribute(e){let t=null;return e=on.getMorphedKey(e),this.attributes.map(r=>{r.key===e&&(t=r.value)}),t}indexOfAttribute(e){let t=-1;return e=on.getMorphedKey(e),this.attributes.map((r,n)=>{r.key===e&&(t=n)}),t}static getMorphedKey(e){switch(e){case"id":e=pt.ID;break;case"email":e=pt.EMAIL;break;case"name":e=pt.NAME;break;case"first_name":e=pt.FIRST_NAME;break;case"last_name":e=pt.LAST_NAME;break;case"mobile":e=pt.MOBILE;break;case"gender":e=pt.GENDER;break;case"birthday":e=pt.BDAY}return e}}function Oe(){var e;return st.get(ct.HAS_USER_LOGGED_OUT)||!(e=Gt(window.location.href)).moe_aid||e.moe_aid.includes("{{")?void 0:e.moe_aid}function De(){var e,t=!!(t=qt.get())&&!!t.disableSdk;let r=!1;return!((r=(null!=(e=ar.get(lt.WEB_SETTINGS))&&e.isDomainLevelStorage?nr:ar).get(lt.SDK_DISABLED))||t&&!1!==r)}function Ne(e){return null!=e&&"NA"!==e&&""!==e&&"null"!==e}function Re(e){return e=(new Date).getTime()-e,Math.round(e/1e3)}on.baseLogTag="UserModel",on.isResolved=!1,on.instance=null;class sn{static getListeners(){return this.listeners}static getTopicListeners(e){return l(sn.topicListeners,e,[])}static addListener(e){sn.listeners.push(e)}static addTopicListener(e,t){sn.topicListeners[e]=sn.getTopicListeners(e),sn.topicListeners[e].push(t)}static broadcast(e){sn.listeners.map(t=>{t(e)}),l(sn.topicListeners,e.topic,[]).map(t=>{t(e)})}static broadcastToWindow(e,t=!1){window&&(t||De())&&window.dispatchEvent(new CustomEvent(e.topic,{detail:{name:e.name,data:e.data||null}}))}static deprecatedSdkCallback(e){window.dispatchEvent(new CustomEvent("MOE_OPT_IN",{detail:e}))}static resetAllListeners(){sn.listeners=[],sn.topicListeners={}}static resetListeners(){sn.listeners=[]}}sn.listeners=[],sn.topicListeners={};let cn=sn;var we=function(e,t,r,n){return new(r=r||Promise)(function(i,a){function o(e){try{c(n.next(e))}catch(e){a(e)}}function s(e){try{c(n.throw(e))}catch(e){a(e)}}function c(e){var t;e.done?i(e.value):((t=e.value)instanceof r?t:new r(function(e){e(t)})).then(o,s)}c((n=n.apply(e,t||[])).next())})};function Le(e){var t=document.createElement("div");return t.innerHTML=e,t.firstElementChild}function Ce(e){return new Date(Date.parse(e))}function Pe(e,t=15){return e=(new Date).getTime()-new Date(e).getTime(),t<=Math.round(e/6e4)}let ln=()=>window.Moengage,un=()=>""!==window.location.search?Tn(window.location.search):Tn(window.location.hash),dn=()=>{var e=un();return e[$e.EDITOR_QUERY_PARAM]&&"1"===e[$e.EDITOR_QUERY_PARAM]&&En()},En=()=>window.self===window.top,gn=e=>e.sort((e,t)=>e.delivery.priority===t.delivery.priority&&(e=e.updated_time,t=t.updated_time,0<Ce(e+"Z").getTime()-Ce(t+"Z").getTime())?-1:1),hn=e=>{let t=[];return e=e.filter(e=>!!(e&&Ce(e.expiry_time+"Z")>new Date)||(t.push(e.id),!1)),0<t.length&&ke("expired_experiences",t),e=e.sort((e,t)=>t.delivery.priority-e.delivery.priority),(e=>{const t={},r={};return{experiences:e=e.filter(e=>{if(e.is_ai&&(r[e.id]=e.context),0===e.payload.length)return!(Number(e.context.moe_variation_id)>1);let n=!1;return e.payload.forEach(r=>{const i=r.widgetId&&"insert_js"===r.type?r.selector+"_"+r.type+"_"+r.widgetId:r.selector+"_"+r.type;r.widgetId&&!r.content||t[i]||(n=!0,t[i]=r,t[i].expId=e.id)}),n}),allOp:t,aiExperienceContext:r}})(gn(e))},pn=e=>we(void 0,void 0,void 0,function*(){yield Promise.all(e.map(e=>{Yt.experiencesStore.setItem(e.id,e)}))}),vn=()=>we(void 0,void 0,void 0,function*(){let e=[];return yield Yt.experiencesStore.iterate(t=>{e.push(t)}),e}),fn=e=>we(void 0,void 0,void 0,function*(){return yield Yt.experiencesStore.getItem(e)}),_n=e=>we(void 0,void 0,void 0,function*(){return yield Yt.tabbedExperiences.getItem(e)}),mn=()=>we(void 0,void 0,void 0,function*(){var e;return yield null==(e=Yt.metaStore)?void 0:e.removeItem(ot.META.LAST_FETCHED_TIME)}),Sn=e=>we(void 0,void 0,void 0,function*(){let t,r=Fe(window.location.href),n=[];var a=e.map(e=>we(void 0,void 0,void 0,function*(){var t=Fe(new URL(e.url).href);if(null!=e&&e.page_attributes){if(yield ge(e))return e}else{if(e.url_filters){if((e=>{var t=br(e);let r=!0;if(t&&0<t.length){let o=new sr("MOE_PAGE_VIEWED",[]);var n=e.url_filters.filter_operator,a=t.map(e=>Ar.doesEventMatchFilters(o,e));r=a[0];for(let e=0;e<a.length;e++)if(n===i.AND){if(!1===(r=r&&a[e]))break}else if(n===i.OR&&!0===(r=r||a[e]))break}return r})(e))return e}else if(t===r)return e;n.push(e.id)}}));a=(yield Promise.all(a)).filter(e=>null==e?void 0:e.id),0<n.length&&(ke("current_url",r),ke("url_failed_experiences",n));let o=!1;var s,c=[];for(s of a)(null==(t=null==s?void 0:s.in_session_behaviour_segment)||!t.included_filters||(yield ue(s)))&&(c.push(s),o=o||xe(s));return o&&window.MoeWebP.clearLastFetchedTime(),c});function Me(){var e,t="Web Personalisation.getMetaInfo",r=document.currentScript;let n,i,a,o,s,c,l,u,d="",E="";return r?(r=new URL(r.src),n=(r=new URLSearchParams(r.search)).get("app_id")||"",i=r.get("env")||"",o=r.get("api_proxy")||"",s=r.get("cdn_proxy")||"",c=r.get("app-cdn_proxy")||"",l=r.get("image_proxy")||"",a="true"===r.get("enable_split_url"),u="true"===r.get("disable_webp"),r.get("cluster")&&(e=r.get("cluster"))&&$e.CLUSTER_ENVIRONMENT_MAP[e.toUpperCase()]&&(d=e.toUpperCase()),"1"!==r.get("debug_logs")||n.includes("_DEBUG")||(n+="_DEBUG"),i?E="https://"+i+"/":d&&(E="https://"+$e.CLUSTER_ENVIRONMENT_MAP[d]+"/"),o&&(E="https://"+o+"/"),i||d||Kt.error(2,t,"Please check WebP integration: data center not present"),n||Kt.error(2,t,"Please check WebP integration: app_id not present"),{APP_ID:n,HOST:E,CLUSTER:d,ENABLE_SPLIT_URL:a,CDN_PROXY_DOMAIN:s,APP_CDN_PROXY_DOMAIN:c,IMAGE_PROXY_DOMAIN:l,DISABLE_WEBP:u}):{}}let Tn=e=>{if(e){var t=e.indexOf("?");if(t<0)return{};t=(e=e.slice(t+1)).replace("?","").split("&");let r={};return t.forEach(e=>{var t=(e=e.split("="))[0];e=decodeURIComponent(e[1]||""),r[t]?"[object Array]"===Object.prototype.toString.call(r[t])?r[t].push(e):r[t]=[r[t],e]:r[t]=e}),JSON.parse(JSON.stringify(r))}return{}};function ke(e,t){window.MoeWebP.statsData[e]=t}function Ue(){var e;try{let t,r;return(t="1"===Be("moe_c_s")||"true"===Be("COOKIE_SHARING")?{deviceUuid:Be($e.MOE_UUID)}:ar.get(nt.USER_DATA))&&t.deviceUuid?r=t.deviceUuid:(r=null==(e=window.MoeWebP)?void 0:e.deviceUuid)||(r=(0,se.v4)(),window.MoeWebP=window.MoeWebP||{},window.MoeWebP.deviceUuid=r),r}catch(e){Kt.error(2,"Web Personalisationutils.getOrSetDeviceUUID","Error fetching or setting device UUID:",e)}}function Be(e){var t=e+"=",r=(()=>{let e=document.cookie.split(";").map(e=>{let t=e.trim();"%"===t.slice(-1)&&(t+="25");try{return decodeURIComponent(t)}catch(e){return Kt.error(2,"Web Personalisation.getDecodedCookies","Error decoding cookie:",t,e),t}});return e})();for(let e=r.length-1;0<=e;e--){let n=r[e];for(;" "===n.charAt(0);)n=n.substring(1);if(0===n.indexOf(t))return n.substring(t.length,n.length)}return null}let In=(e,t)=>{let r;return function(...n){clearTimeout(r),r=setTimeout(()=>{e.apply(this,n),r=void 0},t)}};function xe(e){return"is_ai"in e&&0<e.payload.length}function We(){return window[rt.PAGE_CONTEXT]}function Fe(e){return(e=e.split("?")[0]).replace(/^(https?:\/\/)?(www\.)?/,"https://").replace(/\/$/,"")}function Ve(e){var t=Fe(window.location.href);e&&e.redirection_url&&Fe(e.redirection_url)!==t&&location.replace(e.redirection_url)}let An=(e,t,r=!1)=>we(void 0,void 0,void 0,function*(){var n=yield fn(e);return!!n&&(n.payload=t,r&&(n.is_ai=!0),window.MoeWebP.handleDomManipulator(n),!0)});function je(e){var t=ar.get(nt.INIT_DATA),r=!(null==t||!t.disableSdk),n=ar.get(nt.SDK_DISABLED);if(!(n||r&&!1!==n||!t&&e))return 1;Kt.warn(2,"Web Personalisationutils.isSdkEnabled","Web Personlization is disabled")}function Ke(e,t){var r=$e.DATA_MOE_SELECTOR_ID,n=e.getAttribute(r);n?(n=n.split(",").map(e=>e.trim())).includes(t)||(n.push(t),e.setAttribute(r,n.join(","))):e.setAttribute(r,t)}let bn,yn=(e,t)=>{var r,n;null!=e&&e.setAttribute&&(r=t=>{e.setAttribute(tt.DATA_ATTRIBUTE.LABEL_NAME,t)},(n=e.getAttribute(tt.DATA_ATTRIBUTE.LABEL_NAME)||"")&&!n.includes(tt.LABELS[t])?r(n+" & "+tt.LABELS[t]):r(tt.LABELS[t]))},On=()=>{bn=(()=>{let e=document.createElement("div");function t(t){t.stopPropagation();var r=this.getAttribute(tt.DATA_ATTRIBUTE.LABEL_NAME);e.textContent=r,r=(r=t.clientX)+15,t=t.clientY-35,e.style.left=r+"px",e.style.top=t+"px",e.classList.add("visible")}function r(){e.classList.remove("visible")}return e.classList.add("tooltip"),window.onload=()=>{document.body.appendChild(e)},{enable:function(e=document){e.querySelectorAll(`[${tt.DATA_ATTRIBUTE.LABEL_NAME}]`).forEach(e=>{e.addEventListener("mousemove",t),e.addEventListener("mouseleave",r)})},disable:function(e=document){e.querySelectorAll(`[${tt.DATA_ATTRIBUTE.LABEL_NAME}]`).forEach(e=>{e.removeEventListener("mousemove",t),e.removeEventListener("mouseleave",r)})}}})()};class Dn{static initiate(e,t,r,n){var i=Dn.baseLogTag+".initiate";if(null!=(a=e.content)&&a.length&&(e.content=(e=>{let t=e;var{CDN_PROXY_DOMAIN:e,APP_CDN_PROXY_DOMAIN:r,IMAGE_PROXY_DOMAIN:n}=Me();return"string"==typeof t&&t.length&&(r&&(t=t.replace(/app-cdn\.moengage\.com/gi,r)),e&&(t=t.replace(/cdn\.moengage\.com/gi,e)),n)?t.replace(/image\.moengage\.com/gi,n):t})(e.content)),!e||!e.type)return Kt.error(2,i,"Operation type is missing:",e),{success:!1,reason:"invalid type",operation:e};var a=e.type;let o;switch(a){case"insert":o=Dn.handleInsertOp(e,r);break;case"insert_js":o=Dn.handleInsertJSOp(e,r);break;case"replace":o=Dn.handleReplaceOp(e,r);break;case"update":o=Dn.handleUpdateOp(e,r);break;case"update_outerhtml":o=Dn.handleUpdateHTMLOp(e,r);break;case"delete":o=Dn.handleDeleteOp(e,r);break;case"hide":o=Dn.handleHideOp(e,r);break;case"attribute":o=Dn.handleAttributeOp(e,r);break;case"tracking":o=Dn.handleTrackingOp(e,r,t,n);break;case"rearrange":o=Dn.handleReArrangeOp(e,r);break;default:o={success:!1,reason:"invalid type",operation:e}}return o}static handleInsertOp(e,t){var r,n=Dn.baseLogTag+".handleInsertOp";return e.content&&e.placement?(t=t.querySelector(null==e?void 0:e.selector))?(r=Le(En()||null==(r=e.metaData)||!r.html?e.content:null==(r=e.metaData)?void 0:r.html),yn(r,e.content.trim().startsWith("<img")?"insert_image":e.type),e.dataMoeId&&Ke(r,e.dataMoeId),"after"===e.placement?t.parentNode.insertBefore(r,t.nextSibling):"before"===e.placement&&t.parentNode.insertBefore(r,t),Kt.log(2,n,"Operation applied successfully: ",e),{success:!0}):(Kt.error(1,n,"invalid query selector -> ",e),{success:!1,reason:"invalid query selector",operation:e}):(Kt.error(1,n,"Unable to find content / placement.",e),{success:!1,reason:"unable to find content / placement.",operation:e})}static handleInsertJSOp(e,t){var r=Dn.baseLogTag+".handleInsertJSOp";if(e.content)try{var n=(e=>{try{return JSON.parse(e)}catch(e){return null}})(null==e?void 0:e.content),i=document.createElement("script");return i.textContent=n,(document.body||document.head).appendChild(i),Kt.log(2,r,"Operation applied successfully: ",e),{success:!0}}catch(t){return{success:!1,reason:"Document is not loaded.: "+t,operation:e}}return Kt.error(1,r,"Unable to find content / placement.",e),{success:!1,reason:"unable to find content / placement.",operation:e}}static handleReplaceOp(e,t){var r,n=Dn.baseLogTag+".handleReplaceOp";return e.content?(t=t.querySelector(e.selector),r=Le(e.content),t&&r?(yn(r,e.type),e.dataMoeId&&Ke(r,e.dataMoeId),t.replaceWith(r),Kt.log(2,n,"Operation applied successfully: ",e),{success:!0}):(Kt.error(1,n,"invalid "+(t?"content ->":"query selector -> "),e),{success:!1,reason:"invalid "+(t?"content":"query selector"),operation:e})):(Kt.error(1,n,"Unable to find content.",e),{success:!1,reason:"unable to find  content.",operation:e})}static handleUpdateOp(e,t){var r=Dn.baseLogTag+".handleUpdateOp";return e.content?(t=t.querySelector(e.selector))?(e.dataMoeId&&Ke(t,e.dataMoeId),t.innerHTML=e.content,Kt.log(2,r,"Operation applied successfully: ",e),yn(t,e.type),{success:!0}):(Kt.error(1,r,"invalid query selector ->",e),{success:!1,reason:"unable to find selector / content / placement.",operation:e}):(Kt.error(1,r,"Unable to find content.",e),{success:!1,reason:"unable to find content.",operation:e})}static handleUpdateHTMLOp(e,t){var r,n,i,a=Dn.baseLogTag+".handleUpdateHTMLOp";return e.content?(r=t.querySelector(e.selector))?(n=Le(e.content),e.tab_info&&(yn(n,e.type),i=e.tab_info,t=t.getElementById(i.tab_id))&&t.classList.remove("moe-hide-tab"),e.dataMoeId&&Ke(r,e.dataMoeId),r.outerHTML=n.outerHTML,Kt.log(2,a,"Operation applied successfully: ",e),{success:!0}):(Kt.error(1,a,"invalid query selector ->",e),{success:!1,reason:"unable to find selector / content / placement.",operation:e}):(Kt.error(1,a,"Unable to find content.",e),{success:!1,reason:"unable to find content.",operation:e})}static handleDeleteOp(e,t){var r=Dn.baseLogTag+".handleDeleteOp";return(t=t.querySelector(e.selector))?(t.remove(),Kt.log(2,r,"Operation applied successfully: ",e),{success:!0}):(Kt.error(1,r,"invalid query selector ->",e),{success:!1,reason:"invalid query selector.",operation:e})}static handleHideOp(e,t){var r=Dn.baseLogTag+".handleHideOp";return(t=t.querySelector(e.selector))&&t.style?(t.style.display="none",yn(t,e.type),Kt.log(2,r,"Operation applied successfully: ",e),{success:!0}):(Kt.error(1,r,"invalid query selector -> ",e),{success:!1,reason:"invalid query selector",operation:e})}static handleAttributeOp(e,t){var r=Dn.baseLogTag+".handleAttributeOp";if(e.attributes){let n=t.querySelector(e.selector);return n?(Object.keys(e.attributes).forEach(t=>{var r;"style"===t?(r=(r=n.getAttribute(t)||"")+((e,t)=>{let r=0<t.length&&";"!==t.slice(-1)?";":"";return Object.keys(e).forEach(t=>{r=r+t+":"+e[t]+";"}),r})(e.attributes[t],r),n.setAttribute(t,r)):n.setAttribute(t,e.attributes[t])}),e.dataMoeId&&Ke(n,e.dataMoeId),yn(n,e.type),Kt.log(2,r,"Operation applied successfully: ",e),{success:!0}):(Kt.error(1,r,"invalid "+(n?"attributes":"query selector "),e),{success:!1,reason:n?"unable to find attributes.":"invalid query selector",operation:e})}return Kt.error(1,r,"Unable to find attributes.",e),{success:!1,reason:"unable to find attributes.",operation:e}}static handleTrackingOp(e,t,r,n){var i=Dn.baseLogTag+".handleTrackingOp";return t=t.querySelector(null==e?void 0:e.selector),e.id&&n?t&&e.id?(((t,n)=>{var i,a=t._moeListeners||[];for(i of a)if(i.fn===n&&i.operation===e&&i.context===r)return;var o=t=>{n(t,e,r)};t.addEventListener("click",o),t._moeListeners=a.concat({fn:n,operation:e,context:r,clickHandler:o})})(t,this.eventTracking),yn(t,e.type),Kt.log(2,i,"Operation applied successfully: ",e),{success:!0}):(Kt.error(1,i,"invalid "+(t?"ID ":"query selector "),e),{success:!1,reason:t?"unable to track ID.":"invalid query selector",operation:e}):(e.id&&yn(t,null==e?void 0:e.type),Kt.error(1,i,"Unable to find ID or it is not a Live Experience.",e),{success:!1,reason:"unable to find ID or it is not a Live Experience.",operation:e})}static eventTracking(e,t,r){var n=e.target.dataset.widgetId;e=e.target.dataset.tabContainerId,r=Object.assign({b_id:t.id},r),t.widgetId&&(r.widget_id=t.widgetId),e?r.moe_widget_id=e:n&&(r.moe_widget_id=n),ln().track_event($e.EVENTS.CLICK,r)}static handleReArrangeOp(e,t){var r=Dn.baseLogTag+".handleReArrangeOp";let n=e.selector&&t.querySelector(e.selector);return e.orderList&&n?(t=e.orderList.map(e=>(n.children[e].setAttribute("data-moe-rearrange-id",e.toString()),n.children[e])),n.innerHTML="",t.forEach(e=>{n.appendChild(e)}),e.dataMoeId&&Ke(n,e.dataMoeId),yn(n,null==e?void 0:e.type),Kt.log(2,r,"Operation applied successfully.",e),{success:!0}):(Kt.error(2,r,"unable to find selector / new order list.",e),{success:!1,reason:"unable to find selector / new order list.",operation:e})}}Dn.baseLogTag="DomManipulator";var Ge=function(e,t,r,n){return new(r=r||Promise)(function(i,a){function o(e){try{c(n.next(e))}catch(e){a(e)}}function s(e){try{c(n.throw(e))}catch(e){a(e)}}function c(e){var t;e.done?i(e.value):((t=e.value)instanceof r?t:new r(function(e){e(t)})).then(o,s)}c((n=n.apply(e,t||[])).next())})};class Nn{constructor(){var e=Me();this.appId=e.APP_ID,this.host=e.HOST,this.deviceType=function(){var e=navigator.userAgent.toLowerCase();return(e=>!!/(ipad|tablet|(android(?!.*mobile))|(windows(?!.*phone)(.*touch))|kindle|playbook|silk|(puffin(?!.*(IP|AP|WP))))/i.test(e))(e)?"tablet":(()=>{var e=navigator.userAgent;return!(!/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|ipad|iris|kindle|Android|Silk|lge |maemo|midp|mmp|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows (ce|phone)|xda|xiino/i.test(e)&&!/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(e.substr(0,4)))})()?"mweb":e.includes("mac")&&1<navigator.maxTouchPoints?"tablet":"web"}()}getLiveExperiences(e=!1){return Ge(this,void 0,void 0,function*(){var t=We();let r={};return!e&&t&&(r.page_attributes=t),new Promise((t,n)=>Ge(this,void 0,void 0,function*(){this.makeAPICall(at.LIVE,{all_exp:e},r,!0).then(r=>{var n;t(new cr(r)),r.personalization_used.dpm||e&&(n=new Date,we(void 0,void 0,void 0,function*(){var e;return yield null==(e=Yt.metaStore)?void 0:e.setItem(ot.META.LAST_FETCHED_TIME,n)}))}).catch(e=>{n(e)})}))})}getTestExperiences(){return Ge(this,void 0,void 0,function*(){return new Promise((e,t)=>Ge(this,void 0,void 0,function*(){e(this.makeAPICall(at.TEST))}))})}sendStats(e){return Ge(this,void 0,void 0,function*(){return new Promise((t,r)=>Ge(this,void 0,void 0,function*(){t(this.makeAPICall(at.STATS,void 0,e,!1))}))})}getWebActions(){return Ge(this,void 0,void 0,function*(){return new Promise((e,t)=>Ge(this,void 0,void 0,function*(){e(this.makeAPICall(at.WEB_ACTION))}))})}getLiveRecommendations(e){return Ge(this,void 0,void 0,function*(){return e.platform=this.deviceType,new Promise((t,r)=>Ge(this,void 0,void 0,function*(){t(this.makeAPICall(at.LIVE_RECOMMENDATIONS,e))}))})}isSplitUrlExperince(){return Ge(this,void 0,void 0,function*(){return new Promise((e,t)=>Ge(this,void 0,void 0,function*(){var t=new Date;e(this.makeAPICall(at.SPLIT_URL,{},{user_time:Math.floor(t.getTime()/1e3),user_tz_offset:60*t.getTimezoneOffset()}))}))})}getTabData(e,t){return Ge(this,void 0,void 0,function*(){return new Promise((r,n)=>Ge(this,void 0,void 0,function*(){r(this.makeAPICall(at.TAB_DATA,{},{experience_id:e,tab_id:t}))}))})}fetchExperiences(e,t){return Ge(this,void 0,void 0,function*(){return new Promise((r,n)=>Ge(this,void 0,void 0,function*(){r(this.makeAPICall(at.FETCH,{},Object.assign({experience_key:e},t)))}))})}makeAPICall(e,t,r,n){let i=Nn.baseLogTag+".makeAPICall";return new Promise((a,o)=>{var s={day:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"][(s=new Date).getDay()],hours:String(s.getHours()).padStart(2,"0")},c=function(){var e={};try{var t=ar.get(nt.IDENTITY_MAP),r=Ue();(()=>{var e=ar.get(nt.USER_DATA);if(e){let t;null!=e&&e.attributes.map(e=>{e.key===Xe.ID&&(t=e.value)}),null==t||t.toString()}})(),t&&(t.userIdentities&&(e.user_identifiers=t.userIdentities),t.previousIdentities)&&(e.previous_user_identifiers=t.previousIdentities),r&&(e.unique_id=r)}catch(e){Kt.error(2,"Web Personalisationutils.getUserIdentifier","Error fetching user identifier :",e)}return e}();let u;u=""!==window.location.search?Tn(window.location.search):Tn(window.location.hash);var d=window.location.href.split("?")[0],E=Object.assign(Object.assign(Object.assign({},u),{app_id:this.appId,sdk_ver:"2.61.01",platform:(E=this.deviceType,e===at.STATS&&"tablet"===E?"web":E),payload_id:u.payload_id,USER_TYPE:1<(l(ar.get(nt.SESSION),it.NUMBER_OF_SESSIONS)||0)?"Returning":"New",DAY_OF_THE_WEEK:s.day,TIME_OF_THE_DAY:s.hours,current_url:t?d:void 0,unique_id:c.unique_id}),t);s={headers:{},postData:r,queryParams:{}},[at.LIVE,at.LIVE_RECOMMENDATIONS,at.SPLIT_URL,at.TAB_DATA,at.FETCH].includes(e)?(delete E.unique_id,s.postData=Object.assign(Object.assign(Object.assign({},s.postData),E),{identifiers:c})):s.queryParams=E;try{if(s.postData)s.headers={"MOE-APPKEY":this.appId,"Content-Type":"application/json"},Ht.post(""+this.host+e,s).then(e=>{e=JSON.parse(e.responseText),a(e)}).catch(e=>{Kt.error(1,i,"Error in POST request: ",e),o(e)});else{let t=(new Date).getTime();Kt.log(1,i,`API requested Start Time: ${e} -> `,t),Ht.get(""+this.host+e,s).then(r=>{r=JSON.parse(r.responseText);var o=(Kt.log(1,i,"Get WebP API call success, response: ",r),(new Date).getTime());Kt.log(1,i,`API response received Time : ${e} -> `,o),n&&(ke("api_start_time",t),ke("api_end_time",o)),a(r)}).catch(e=>{Kt.error(1,i,"Error in GET request: ",e),o(e)})}}catch(s){Kt.error(1,i,"Error getting WebP Test Expressions: ",s),r||(d=(new Date).getTime(),n&&ke("api_request_failed_time",d)),o("Error getting WebP Expressions")}})}}Nn.baseLogTag="WebPApi";class Rn{static listenToDomChanges(e,t,r,n,i){let a=Rn.baseLogTag+".listenToDOMChanges";var o=i?document:document.querySelector(e.selector);let s=document.location.href,c=In(Rn.retryFailedExperiences.bind(this,i),$e.FUNCTION_DEBOUNCE_TIME),l=In(function(e){Kt.log(2,a,"Dom Observer is disconnected, Total number of retry: "+Rn.observerCounter),d.disconnect()},$e.FUNCTION_DEBOUNCE_TIME),u=In(this.reApplyRevertedChanges.bind(this),$e.FUNCTION_DEBOUNCE_TIME),d=new MutationObserver(a=>{let o=!0;var d,E=s!==document.location.href;a.forEach(e=>{var t;"childList"===e.type&&(null==(t=e.removedNodes[0])?void 0:t.nodeValue)===(null==(t=e.addedNodes[0])?void 0:t.nodeValue)&&(o=!1)}),o&&(i?(a=Mn.failedOperations.length,d=Object.keys(Mn.moeOperationsWithDataID).length,0<a?c():(Rn.observerCounter>$e.MAX_RETRY_OPERATION_ATTEMPTES&&d<1&&a<1||E)&&l(),0<d&&u()):E||this.selectorObserver(e,t,n,r))});this.observers.push(d),o&&d.observe(o,{childList:!0,subtree:!0,attributes:!1,characterData:!0})}static selectorObserver(e,t,r,n){var i=Rn.baseLogTag+".documentObserver",a=null==t?void 0:t.cid.split("_")[0];(Kt.log(1,i,"Re-applying the operation: ",e),i=Dn.initiate(e,t,n,r)).success&&(a&&!Mn.appliedExperiences.hasOwnProperty(a)&&(Mn.appliedExperiences[a]=!0),Rn.listenToDomChanges(e,t,n,r))}static retryFailedExperiences(e){var t=Rn.baseLogTag+".retryFailedExperiences";Kt.log(2,t,"Retring Failed Operations, Total number of retry attempts: "+Rn.observerCounter),e(),Rn.observerCounter++}static reApplyRevertedChanges(){let e=Mn.moeOperationsWithDataID,t=Rn.baseLogTag+".documentObserver";Kt.log(2,t,"Retring Failed Operations, Total number of retry attempts: "+Rn.observerCounter),Object.keys(e).forEach(r=>{var n=e[r];((e,t)=>{var r;for(r of(e=e.querySelectorAll(`[${$e.DATA_MOE_SELECTOR_ID}]`),Array.from(e)))if((r.getAttribute($e.DATA_MOE_SELECTOR_ID)||"").split(",").map(e=>e.trim()).includes(t))return r;return null})(document,r)||n.forEach(e=>{Dn.initiate(e,void 0,document,!0),Kt.log(2,t,"Re-applying the operation: ",e)})}),Rn.observerCounter++}static disconnectObservers(){this.observers&&0<this.observers.length&&(this.observers.forEach(e=>{e.disconnect()}),this.observers=[])}}Rn.baseLogTag="Webp.Listener",Rn.observerCounter=1,Rn.observers=[];class wn{constructor(e){this.events={},this.listener=null,this.historyManager=window[Ze.PageEventHistoryManager],this.onEvent=e=>{var t=wn.baseLogTag+".onEvent";try{this.events[e.name]&&this.events[e.name].forEach(t=>{(t=this.getAttributeValue(e.attributes,t))&&this.trigger(t)})}catch(e){Kt.error(2,t,"Error occurred during check event trigger experiences: ",e)}},this.events=e}onTrigger(e){this.listener=e}startWatching(){return function(e,t,r,n){return new(r=r||Promise)(function(t,i){function a(e){try{s(n.next(e))}catch(e){i(e)}}function o(e){try{s(n.throw(e))}catch(e){i(e)}}function s(e){var n;e.done?t(e.value):((n=e.value)instanceof r?n:new r(function(e){e(n)})).then(a,o)}s((n=n.apply(e,[])).next())})}(this,0,void 0,function*(){var e=wn.baseLogTag+".startWatching";this.historyManager?(Kt.log(2,e,"Initialized event Trigger Watcher for AI experiences"),this.historyManager.getHistory().forEach(this.onEvent),this.historyManager.addEventListener(this.onEvent)):wn.startWatchingRetries<=et.WEB_P_EVENT_WATCHER_MAX_RETRIES&&setTimeout(()=>{wn.startWatchingRetries++,this.historyManager=window[Ze.PageEventHistoryManager],this.startWatching()},2e3*wn.startWatchingRetries)})}trigger(e){null!=this.listener&&this.listener(e)}getAttributeValue(e,t){let r=null;for(var n of e)if(n.key===t){r=n.value;break}return r}}wn.baseLogTag="experienceTriggerManager",wn.startWatchingRetries=1;var He=function(e,t,r,n){return new(r=r||Promise)(function(i,a){function o(e){try{c(n.next(e))}catch(e){a(e)}}function s(e){try{c(n.throw(e))}catch(e){a(e)}}function c(e){var t;e.done?i(e.value):((t=e.value)instanceof r?t:new r(function(e){e(t)})).then(o,s)}c((n=n.apply(e,t||[])).next())})},Ye=function(e,t,r,n){return new(r=r||Promise)(function(i,a){function o(e){try{c(n.next(e))}catch(e){a(e)}}function s(e){try{c(n.throw(e))}catch(e){a(e)}}function c(e){var t;e.done?i(e.value):((t=e.value)instanceof r?t:new r(function(e){e(t)})).then(o,s)}c((n=n.apply(e,t||[])).next())})};class Ln{constructor(){this.setExperienceTriggerManager=()=>Ye(this,void 0,void 0,function*(){var e=Ln.LogTag+".setExperienceTriggerManager",t=yield this.getWebActionEvents();t=new wn(t),Kt.log(2,e,"Initializing Trigger Manager"),t.onTrigger(this.renderAiExperiences.bind(this)),t.startWatching()}),this.getWebActionEvents=()=>Ye(this,void 0,void 0,function*(){var e,t,r=Ln.LogTag+".getWebActionEvents";let n;return Pe(yield He(void 0,void 0,void 0,function*(){return yield Yt.aiExperiencesStore.getItem(ot.AI_EXPERIENCES.WEB_ACTIONS_LAST_FETCHED_TIME)}),$e.SYNC_TIME_FOR_WEB_ACTION_EVENTS)?(Kt.log(2,r,"synchronizing Web Actions Events data for Real Time Recommendations as time limit exceeded"),n=yield this.WebPApis.getWebActions(),t=n,He(void 0,void 0,void 0,function*(){yield Yt.aiExperiencesStore.setItem(ot.AI_EXPERIENCES.WEB_ACTION_EVENTS,t)}),e=new Date,He(void 0,void 0,void 0,function*(){return yield Yt.aiExperiencesStore.setItem(ot.AI_EXPERIENCES.WEB_ACTIONS_LAST_FETCHED_TIME,e)})):(n=yield He(void 0,void 0,void 0,function*(){return yield Yt.aiExperiencesStore.getItem(ot.AI_EXPERIENCES.WEB_ACTION_EVENTS)}),Kt.log(2,r,"Using the cached Web Actions Events data for Real Time Recommendations:",n)),n}),this.WebPApis=new Nn}renderAiExperiences(e){return Ye(this,void 0,void 0,function*(){let t=Ln.LogTag+".renderAiExperiences",r=(yield He(void 0,void 0,void 0,function*(){return yield Yt.aiExperiencesStore.getItem(ot.AI_EXPERIENCES.AI_EXPERIENCE_CONTEXT)}))||{};var n={experience_context:r,product_id:null==e?void 0:e.toString()};return this.WebPApis.getLiveRecommendations(n).then(e=>(Kt.log(2,t,"AI Live Recommendations experiences payload: "+r),Object.keys(e).forEach(t=>{An(t,null==(t=e[t])?void 0:t.data)}),!0)).catch(e=>{Kt.error(2,t,"AI Live Recommendations experiences failed:",e)})})}}Ln.LogTag="AI Experiences";class Cn{static listenToDomChanges(){if(document.getElementById($e.ANTI_FLICKER_STYLESHEET)){let e=In(function(){10<Cn.observerCounter?t.disconnect():(Cn.observerCounter+=1,Cn.removeOverLay())},200),t=new MutationObserver(t=>{let r=!0;t.forEach(e=>{var t;"childList"===e.type&&(null==(t=e.removedNodes[0])?void 0:t.nodeValue)===(null==(t=e.addedNodes[0])?void 0:t.nodeValue)&&(r=!1)}),r&&e()});document&&t.observe(document,{childList:!0,subtree:!0,attributes:!1,characterData:!0})}else Kt.log(2,Cn.baseLogTag,"Anti Flicker Script not available")}static removeOverLay(){var e=Cn.baseLogTag+".removeOverLay",t=document.querySelectorAll("."+$e.ANTI_FLICKER_HIDE);0<t.length&&t.forEach(e=>{e.classList.add($e.ANTI_FLICKER_SHOW),e.classList.remove($e.ANTI_FLICKER_HIDE)}),document.documentElement.className.includes($e.ANTI_FLICKER_CLASSNAME)&&document.documentElement.classList.remove($e.ANTI_FLICKER_CLASSNAME),Kt.log(2,e,"Removed WebP Anti-Flicker Styles From:",t)}}Cn.baseLogTag="Webp.AntiFlickerListener",Cn.observerCounter=1;var qe=function(e,t,r,n){return new(r=r||Promise)(function(i,a){function o(e){try{c(n.next(e))}catch(e){a(e)}}function s(e){try{c(n.throw(e))}catch(e){a(e)}}function c(e){var t;e.done?i(e.value):((t=e.value)instanceof r?t:new r(function(e){e(t)})).then(o,s)}c((n=n.apply(e,t||[])).next())})};let Pn=Me();class Mn{constructor(){this.statsData={},this.retryExperienceCount=0,this.trackingDelayCounter=1;let e=Mn.baseLogTag+".constructor";var t;new RegExp(["bot","spider","crawler","crawling","Applebot","PetalBot","pingbot","proximic","AdsBot-Google","Googlebot","Cincraw","SnapchatBot","Snapchat-Proxy/1.0","SnapchatAds","Snapchat-Ads/1.0","YandexRenderResourcesBot","bingbot","slurp","MicrosoftPreview","Baiduspider"].join("|"),"i").test(navigator.userAgent)?Kt.error(1,e,"Bot detected, Can't initialise the MoEngage WebP SDK"):(Pn.APP_ID&&Pn.HOST?je(Pn.DISABLE_WEBP)&&(window.addEventListener(Qe.MOE_LIFECYCLE.TOPIC_NAME,e=>{(null==(e=null==e?void 0:e.detail)?void 0:e.name)===Qe.MOE_LIFECYCLE.EVENT_NAMES.SDK_DISABLED&&window.MoeWebP.disableWebPersonalization()}),this.deviceUuid=Ue(),this.AiExperiences=new Ln,t=(new Date).getTime(),this.isLiveExperience=!1,Kt.log(2,e,"WEBP SDK Loaded :",t),this.isSentryEnabled())&&("1"===un()[$e.CHECK_TEST_WEBP]?(Mn.WebPApis.getTestExperiences().then(e=>{this.DomManipulator(e.payload)}),Cn.removeOverLay(),Kt.log(2,e,"Web P Test Campaign Dom Manipulation.")):dn()?(this.getEditorVersion().then(t=>{t===$e.STAGING_ERROR?(this.injectEditorFile($e.STAGING_EDITOR_FILE),Kt.log(2,e,"Web P module initialized in staging editor mode. Version not found, loading default staging editor.")):(this.injectEditorFile($e.EDITOR_FILE(t)),Kt.log(2,e,"Web P module initialized in editor mode."))}),Cn.removeOverLay()):En()?(this.boundIdentityUpdateHandler=this.identityUpdateHandler.bind(this),this.statsData.webP_initialization_time=t,this.getLiveExperiences(),this.handleLogoutListener(),this.handleSPA(),this.handleIdentityChange()):((t=document.createElement("style")).id=tt.STYLE.STYLE_ID,t.innerHTML=tt.STYLE.STYLE_DATA,document.head.appendChild(t),On())):Kt.error(2,e,"WebP is not properly integrated"),null!=(t=window.Moengage)&&t.personalize?cn.broadcastToWindow({topic:Qe.MOE_LIFECYCLE.TOPIC_NAME,name:Qe.MOE_LIFECYCLE.EVENT_NAMES.WEBP_INIT}):window.addEventListener(Qe.MOE_LIFECYCLE.TOPIC_NAME,e=>{(null==(e=null==e?void 0:e.detail)?void 0:e.name)===Qe.MOE_LIFECYCLE.EVENT_NAMES.MOE_INIT&&cn.broadcastToWindow({topic:Qe.MOE_LIFECYCLE.TOPIC_NAME,name:Qe.MOE_LIFECYCLE.EVENT_NAMES.WEBP_INIT})}))}getLiveExperiences(){return qe(this,void 0,void 0,function*(){let e=Mn.baseLogTag+".getLiveExperiences";yield Yt.initialize(),this.syncExperiences().then(t=>qe(this,void 0,void 0,function*(){var r,n;t&&t.experiences&&t.experiences.length&&(r=yield Sn(t.experiences),Mn.appliedExperiences={},Mn.failedOperations=[],r&&0<r.length?(r=hn(r),Mn.allOperations=r.allOp,Mn.experiences=r.experiences,n=r.aiExperienceContext,He(void 0,void 0,void 0,function*(){yield Yt.aiExperiencesStore.setItem(ot.AI_EXPERIENCES.AI_EXPERIENCE_CONTEXT,n)}),r.aiExperienceContext&&0<Object.keys(r.aiExperienceContext).length&&this.AiExperiences.setExperienceTriggerManager(),Mn.experiences&&Mn.experiences.length&&Mn.experiences[0].id&&ke("ids",Mn.experiences.map(e=>e.id)),Kt.log(2,e,"Eligible Experiences found: ",Mn.experiences),Mn.experiences.forEach(e=>{this.handleLiveExperience(e,t.user_in_gcg)})):this.noExperienceFoundStats())})).catch(t=>{Kt.error(1,e,"Error syncing Experiences: ",t)}).finally(()=>{Cn.listenToDomChanges()})})}handleLiveExperience(e,t){var r=Mn.baseLogTag+".handleLiveExperience";e&&e.gcg_enabled&&t?(ke("in_gcg",{experience:e.gcg_enabled,user:t}),Kt.log(2,r,"GCG is Enabled for both User and Experience: ",{experience:e,userIsGCG:t}),new Promise(()=>{Mn.WebPApis.sendStats(Object.assign(Object.assign({},e.context),{gcg_event:!0})),Mn.WebPApis.sendStats(this.statsData).then(e=>{null!=e&&e.success&&(this.statsData={})})})):e?(Kt.log(2,r,"Going to trigger this experience: ",e),e.payload.length?e&&this.handleDomManipulator(e):(this.isLiveExperience=!0,Mn.appliedExperiences[e.id]=!0,this.handleDomManipulationComplete(e,[],!0))):this.noExperienceFoundStats()}noExperienceFoundStats(){return qe(this,void 0,void 0,function*(){var e=Mn.baseLogTag+".noExperienceFoundStats";return Kt.log(2,e,"No eligible experience found"),new Promise(()=>{Mn.WebPApis.sendStats(this.statsData).then(e=>{null!=e&&e.success&&(this.statsData={})})})})}syncExperiences(){return qe(this,void 0,void 0,function*(){let e=Mn.baseLogTag+".syncExperiences";return new Promise((t,r)=>qe(this,void 0,void 0,function*(){try{var n,i,a,o=yield we(void 0,void 0,void 0,function*(){var e;return yield null==(e=Yt.metaStore)?void 0:e.getItem(ot.META.LAST_FETCHED_TIME)});Pe(o)||!o?(Kt.log(2,e,"synchronizing experiences as time limit exceeded"),Pn.ENABLE_SPLIT_URL&&Mn.WebPApis.isSplitUrlExperince().then(e=>{Ve(e)}),yield we(void 0,void 0,void 0,function*(){yield Yt.experiencesStore.clear(),yield Yt.aiExperiencesStore.clear(),yield Yt.metaStore.clear(),yield Yt.splitExperiences.clear(),yield Yt.tabbedExperiences.clear()}),n=yield Mn.WebPApis.getLiveExperiences(),yr(n.experiences),n.experiences&&(yield pn(n.experiences)),t(n),yield Mn.WebPApis.getLiveExperiences(!0).then(e=>qe(this,void 0,void 0,function*(){var t,r;t=e&&e.user_in_gcg,we(void 0,void 0,void 0,function*(){var e;return yield null==(e=Yt.metaStore)?void 0:e.setItem(ot.META.USER_IN_GCG,t)}),yr(e.experiences),pn(e.experiences),r=e.split_experiences,we(void 0,void 0,void 0,function*(){yield Promise.all(r.map(e=>we(void 0,void 0,void 0,function*(){var t=Fe(e.url);yield Yt.splitExperiences.setItem(t,e)})))})}))):(Pn.ENABLE_SPLIT_URL&&(yield function(){return we(this,void 0,void 0,function*(){var e,t=Fe(window.location.href);return e=t,!!((t=yield we(void 0,void 0,void 0,function*(){return yield Yt.splitExperiences.getItem(e)}))&&Ce(t.expiry_time+"Z")>new Date)})}())&&Mn.WebPApis.isSplitUrlExperince().then(e=>{Ve(e)}),i=yield vn(),a=yield we(void 0,void 0,void 0,function*(){var e;return yield null==(e=Yt.metaStore)?void 0:e.getItem(ot.META.USER_IN_GCG)}),t({experiences:i,user_in_gcg:a}),Kt.log(2,e,"Using the cached experiences for Web Personalisation"))}catch(n){r(n)}}))})}handleDomManipulator(e){var t=Mn.baseLogTag+".DomManipulator",r=(this.isLiveExperience=!0,e&&e.payload),n=(this.domManipulatorStartTime=(new Date).getTime(),e).context;Kt.log(2,t,null!=n&&n.cid?`Going to render experience with ID: ${n.cid} and `:" ","Operations: ",r),Kt.log(2,t,"Dom Manipulator start Time: ",this.domManipulatorStartTime);let i=[];!e.is_ai&&Mn.allOperations?Object.keys(Mn.allOperations).forEach(t=>{(t=Mn.allOperations[t]).expId===e.id&&i.push(t)}):i=e.payload,i.length&&this.DomManipulator(i,e.id,document,n),Mn.failedOperations.length?this.completeDomManipulationTimer=setTimeout(()=>{this.handleDomManipulationComplete(e,this.retryFailedOperations)},$e.RETRY_INTERVAL):this.handleDomManipulationComplete(e,[],!0),this.isDomMutationObserverAdded||(Rn.listenToDomChanges(null,null,null,null,this.retryFailedOperations.bind(this,e)),this.isDomMutationObserverAdded=!0)}DomManipulator(e,t,r=document,n){let i=Mn.baseLogTag+".DomManipulator";je(Pn.DISABLE_WEBP)&&e.forEach(e=>{try{Dn.initiate(e,n,r,this.isLiveExperience).success?(e.dataMoeId?this.saveMoeDataIdOperations(e):["insert","rearrange","insert_js"].includes(e.type)||Rn.listenToDomChanges(e,n,r,this.isLiveExperience),Mn.appliedExperiences.hasOwnProperty(t)||(Mn.appliedExperiences[t]=!0),Mn.isAnyOperationSuccessfull||(Mn.isAnyOperationSuccessfull=!0)):Mn.failedOperations=Mn.failedOperations.concat([[e,n,r,this.isLiveExperience]])}catch(e){Kt.error(2,i,"Error in Dom Manipulation",e)}})}retryFailedOperations(e){var t=Mn.baseLogTag+".startRetry",r=(Kt.log(2,t,"Retrying failed operations: ",Mn.failedOperations),Mn.failedOperations.concat([]));Mn.failedOperations=[],r=this.handleRetry(r,e.id),this.retryExperienceCount++,0===Mn.failedOperations.length&&(Kt.log(2,t,"Total number of times retried applying webP changes: ",this.retryExperienceCount-1),clearTimeout(this.completeDomManipulationTimer),this.handleDomManipulationComplete(e,r)),Cn.removeOverLay()}handleRetry(e,t){for(var r=[];0<e.length;){var n=e.pop(),i=Dn.initiate.apply(null,n);i.success?"insert_js"!==n[0].type&&(n[0].dataMoeId?this.saveMoeDataIdOperations(n[0]):["insert","rearrange"].includes(n[0].type)||Rn.listenToDomChanges.apply(Rn,n),Mn.appliedExperiences.hasOwnProperty(t)||(Mn.appliedExperiences[t]=!0),Mn.isAnyOperationSuccessfull||(Mn.isAnyOperationSuccessfull=!0)):(r.push(i),Mn.failedOperations=Mn.failedOperations.concat([n]))}return r}handleDomManipulationComplete(e,t,r){var n=Mn.baseLogTag+".handleDomManipulationComplete",i=(e=e.context,(new Date).getTime());Kt.log(2,n,"Dom end Time: ",i),this.domManipulatorStartTime&&Kt.log(1,n,`Total time taken to manipulate the DOM: ${(i-this.domManipulatorStartTime)/1e3}s`),this.isLiveExperience&&(t&&t.length&&ke("payload_failer",{reason:"Experiences payload Failed to Execute",campaign_id:null==e?void 0:e.cid,data:t}),this.domManipulatorStartTime&&(ke("dom_manipulator_start_time",this.domManipulatorStartTime),ke("dom_manipulator_end_time",i)),new Promise(()=>{Mn.WebPApis.sendStats(this.statsData).then(e=>{null!=e&&e.success&&(this.statsData={})})}),Mn.isAnyOperationSuccessfull||r)&&(setTimeout(()=>Object.keys(Mn.appliedExperiences).map(e=>qe(this,void 0,void 0,function*(){Mn.appliedExperiences[e]&&(yield this.track(e))})),this.trackingDelayCounter),this.trackingDelayCounter++)}getEditorVersion(){return qe(this,void 0,void 0,function*(){let e=Mn.baseLogTag+".getEditorVersion";return new Promise((t,r)=>qe(this,void 0,void 0,function*(){var n=Tn(window.location.search);if((i=Me().HOST)&&i.includes("moestaging"))n.webPStagingVersion&&t(n.webPStagingVersion),t($e.STAGING_ERROR);else{var i=yield Ht.get(""+$e.VERSION_FILE);if(200===i.status)try{var a=JSON.parse(i.responseText);"1"===n.pre_prod&&t(a[$e.PRE_PROD]),t(a[Pn.CLUSTER]||"")}catch(n){Kt.error(2,e,"Error in getting editor version file",n),r(n)}t("")}}))})}injectEditorFile(e){return qe(this,void 0,void 0,function*(){return new Promise((t,r)=>qe(this,void 0,void 0,function*(){var t=document.createElement("script");t.src=e,document.getElementsByTagName("head")[0].appendChild(t)}))})}track(e){return qe(this,void 0,void 0,function*(){Mn.appliedExperiences[e]=!1;let t=yield fn(e);(t=t||Mn.experiences.find(t=>t.id===e))&&(this.eventTracking($e.EVENTS.IMPRESSION,t.id,t.context),t.tab_list)&&this.renderTabbedExperience(e,t.tab_list)})}isSentryEnabled(){var e=Mn.baseLogTag+".isSentryEnabled";try{var t=JSON.parse(localStorage.getItem("MOE_DATA"));return!(t&&t.WEB_SETTINGS&&t.WEB_SETTINGS.configs)||t.WEB_SETTINGS.configs.isWebPersonalizationModuleEnabled}catch(t){Kt.error(1,e,"Error in getting sentry flag for webp: ",t)}}clearLastFetchedTime(e){return qe(this,void 0,void 0,function*(){return Kt.log(2,"MoeWebP.clearLastFetchedTime","Clearing cache for Web Personalisation"),e&&(Mn.failedOperations=[]),yield mn()})}isEditorModeEnabled(){return dn()||!En()}setLogLevel(e){Kt.setLogLevel(e,!1),Kt.setLogTabStyle("#85586F")}handleInSessionEvent(e){return qe(this,void 0,void 0,function*(){var t,r=Mn.baseLogTag+".handleInSessionEvent";(yield ce(void 0,void 0,void 0,function*(){return Yt&&Yt.inSessionStore&&(yield Yt.inSessionStore.getItem(ot.IN_SESSION.IN_SESSION_EVENTS))||[]})).includes(e.name)&&(Kt.log(2,r,"Event found in Web personalization experience: ",e.name),t=e,ce(void 0,void 0,void 0,function*(){var e=yield Dr();e.unshift(t),e.length>$e.MAX_EVENTS_FOR_IN_SESSION&&e.pop(),Yt.inSessionStore.setItem(ot.IN_SESSION.IN_SESSION_EVENTS_HISTORY,e)}))})}saveMoeDataIdOperations(e){Mn.moeOperationsWithDataID[e.dataMoeId]?Mn.moeOperationsWithDataID[e.dataMoeId].push(e):Mn.moeOperationsWithDataID[e.dataMoeId]=[e]}eventTracking(e,t,r,n){var i=Mn.baseLogTag+".eventTracking";try{return ln()?(Kt.log(1,i,e+": Event Tracked"),ln().track_event(e,Object.assign({campaign_id:t},r))):(window.moengage_q=window.moengage_q||[]).push({f:"track_event",a:[e,Object.assign(Object.assign({campaign_id:t},r),n)]}),Promise.resolve()}catch(e){Kt.error(2,i,"Failed Tracking expression",e)}}trackClick(e,t,r){return this.eventTracking($e.EVENTS.CLICK,e,t,r)}previewExperiences(e,t){var r=Mn.baseLogTag+".previewExperiences";return Kt.log(2,r,(e?"Adding":"Removing")+" border and label to personalized experiences"),e?([r=document]=[t],e="Web Personalisation.previewExperiences",bn.enable||Kt.error(2,e,"Preview mode is not enabled"),r.querySelectorAll(`[${tt.DATA_ATTRIBUTE.LABEL_NAME}]`).forEach(e=>{e.classList.add(tt.ELEMENT_BORDER_CLASS),e.getAttribute("title")&&e.setAttribute(tt.DATA_ATTRIBUTE.BACKUP_TITLE,e.getAttribute("title")),e.setAttribute("title","")}),bn.enable(r),void Kt.log(2,e,"Border and label's added to personalized experiences")):([r=document]=[t],e="Web Personalisation.previewExperiences",bn.disable||Kt.error(2,e,"Preview mode is not enabled"),r.querySelectorAll(`[${tt.DATA_ATTRIBUTE.LABEL_NAME}]`).forEach(e=>{e.classList.remove(tt.ELEMENT_BORDER_CLASS),e.removeAttribute("title"),e.getAttribute(tt.DATA_ATTRIBUTE.BACKUP_TITLE)&&(e.setAttribute("title",e.getAttribute(tt.DATA_ATTRIBUTE.BACKUP_TITLE)),e.removeAttribute(tt.DATA_ATTRIBUTE.BACKUP_TITLE))}),bn.disable(r),void Kt.log(2,e,"Border and label's removed from personalized experiences"))}renderTabbedExperience(e,t){return qe(this,void 0,void 0,function*(){let r=Mn.baseLogTag+".renderTabbedExperience";try{var n,i=yield _n(e);if(!i)return n=t.map(t=>t.is_ai?Promise.resolve():Mn.WebPApis.getTabData(e,t.tab_id).then(t=>qe(this,void 0,void 0,function*(){var n,i,a;return t&&t[e]?(n=t[e]&&t[e].data,i=e,a=n,we(void 0,void 0,void 0,function*(){let e;return _n(i).then(t=>we(void 0,void 0,void 0,function*(){t&&(a=a.concat(t)),e=yield Yt.tabbedExperiences.setItem(i,a)})),e}),An(e,n,!0)):(Kt.error(2,r,"No payload found for tabbed experience",e),!1)})).catch(t=>{Kt.error(2,r,`Failed to get tabbed experience data ${e}:`,t)})),Promise.all(n);yield An(e,i,!0)}catch(n){throw Kt.error(2,r,`Error in getTabbedData ${e}:`,n),n}})}renderPageTypeExperience(e){return qe(this,void 0,void 0,function*(){var t,r=Mn.baseLogTag+".renderPageTypeExperience";if(e){t=e,window[rt.PAGE_CONTEXT]=t;try{var n=yield function(){return we(this,void 0,void 0,function*(){let e="Web Personalisationutils.getPageTypeExperiences";try{var t=(yield vn())||[];return t.length?(yield Promise.all(t.map(t=>we(this,void 0,void 0,function*(){try{if(t.page_attributes)return(yield ge(t))?t:null}catch(r){Kt.error(2,e,"Error evaluating page context for experience:",t,r)}return null})))).filter(Boolean):[]}catch(t){throw Kt.error(2,e,"Error getting pageType experiences:",t),t}})}();let e=!1;return n&&n.forEach(t=>{t&&!Mn.appliedExperiences.hasOwnProperty(t.id)&&(t.is_ai=!0,this.handleDomManipulator(t),e=!0)}),e}catch(t){return Kt.error(2,r,"Error getting pageType experiences:",t),!1}}return Kt.error(2,r,"No pageContext provided"),!1})}handleLogoutListener(){window.addEventListener("USER_ACTIONS",e=>{"FORCED_LOGOUT"===e.detail.name&&this.handleWebPLogout(!0)}),window.addEventListener(Qe.USER_LIFECYCLE.TOPIC_NAME,e=>{e.detail.name===Qe.USER_LIFECYCLE.EVENT_NAMES.LOGOUT&&this.handleWebPLogout()})}handleWebPLogout(e){Yt.clear(),e&&this.getLiveExperiences()}handleSPA(){window.addEventListener(Qe.SPA_LIFECYCLE.TOPIC_NAME,e=>{e.detail.name===Qe.SPA_LIFECYCLE.EVENT_NAMES.PAGE_CHANGED&&je(Pn.DISABLE_WEBP)&&this.getLiveExperiences()})}disableWebPersonalization(){window.removeEventListener(Qe.SPA_LIFECYCLE.TOPIC_NAME,this.getLiveExperiences),window.removeEventListener(Qe.USER_LIFECYCLE.TOPIC_NAME,this.boundIdentityUpdateHandler),Mn.failedOperations=[],Rn.disconnectObservers(),this.isDomMutationObserverAdded=!1}handleIdentityChange(){window.removeEventListener(Qe.USER_LIFECYCLE.TOPIC_NAME,this.boundIdentityUpdateHandler),window.addEventListener(Qe.USER_LIFECYCLE.TOPIC_NAME,this.boundIdentityUpdateHandler)}identityUpdateHandler(e){return qe(this,void 0,void 0,function*(){e.detail.name===Qe.USER_LIFECYCLE.EVENT_NAMES.USER_IDENTITY_UPDATE&&(mn(),this.syncExperiences())})}fetchExperiences(e=[],t={}){return qe(this,void 0,void 0,function*(){var r=Mn.baseLogTag+".fetchExperiences";Kt.log(2,r,"Fetching experiences from remote");try{var n=yield Mn.WebPApis.fetchExperiences(e,t);return null!=n&&n.experiences?n.experiences:(Kt.error(2,r,"No self-handle experiences found"),{})}catch(n){throw Kt.error(2,r,"Error fetching self handle experiences: ",n),n}})}}Mn.baseLogTag="Web Personalisation",Mn.WebPApis=new Nn,Mn.failedOperations=[],Mn.isAnyOperationSuccessfull=!1,Mn.appliedExperiences={},Mn.moeOperationsWithDataID={},window.MoeWebP=new Mn}})();